<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BookIt</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#fff;--text:#000;--hint:#999;--btn:#2481cc;--btn-text:#fff;--sec:#f0f0f0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding-bottom:80px}
.page{display:none}.page.active{display:block}
.header{padding:16px 20px;background:var(--bg);position:sticky;top:0;z-index:100;border-bottom:1px solid var(--sec);display:flex;justify-content:space-between;align-items:center}
.header h1{font-size:20px;font-weight:700}
.header-back{background:none;border:none;font-size:24px;cursor:pointer}
.header-profile{background:var(--sec);border:none;width:40px;height:40px;border-radius:50%;font-size:20px;cursor:pointer}
.header-menu-btn{background:var(--sec);border:none;padding:8px 12px;border-radius:8px;font-size:13px;cursor:pointer}
.register-container{padding:40px 20px;text-align:center}
.register-icon{font-size:64px;margin-bottom:24px}
.register-title{font-size:24px;font-weight:700;margin-bottom:12px}
.register-text{color:var(--hint);margin-bottom:32px}
.input-group{margin-bottom:20px;text-align:left}
.input-label{font-size:14px;color:var(--hint);margin-bottom:8px;display:block}
.input-field{width:100%;padding:16px;font-size:18px;border:2px solid var(--sec);border-radius:12px;background:var(--bg);color:var(--text);outline:none}
.input-field:focus{border-color:var(--btn)}
.btn-primary{width:100%;padding:16px;font-size:17px;font-weight:600;background:var(--btn);color:var(--btn-text);border:none;border-radius:12px;cursor:pointer}
.btn-primary:disabled{opacity:0.5}
.businesses-grid{padding:16px;display:flex;flex-direction:column;gap:12px}
.business-card{border-radius:16px;position:relative;height:140px;cursor:pointer;overflow:hidden}
.business-card-content{position:absolute;bottom:0;left:0;right:0;padding:16px;color:white}
.business-emoji{font-size:28px;margin-bottom:4px}
.business-name{font-size:20px;font-weight:700;margin-bottom:2px}
.business-desc{font-size:13px;opacity:0.9}
.profile-header{padding:24px 20px;text-align:center;background:var(--sec)}
.profile-avatar{width:70px;height:70px;border-radius:50%;background:var(--btn);color:white;font-size:32px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px}
.profile-name{font-size:20px;font-weight:700;margin-bottom:4px}
.profile-phone{color:var(--hint);font-size:14px}
.profile-tabs{display:flex;border-bottom:1px solid var(--sec)}
.profile-tab{flex:1;padding:12px;text-align:center;font-size:13px;font-weight:600;color:var(--hint);background:none;border:none;cursor:pointer;border-bottom:2px solid transparent}
.profile-tab.active{color:var(--btn);border-bottom-color:var(--btn)}
.profile-content{padding:16px}
.booking-card{background:var(--sec);border-radius:12px;padding:14px;margin-bottom:10px}
.booking-card.past{opacity:0.6}
.booking-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.booking-date{font-size:16px;font-weight:700}
.booking-status{font-size:11px;padding:4px 8px;border-radius:12px;background:#4CAF50;color:white}
.booking-status.cancelled{background:#f44336}
.booking-status.past{background:var(--hint)}
.booking-service{font-size:15px;margin-bottom:4px}
.booking-master{font-size:13px;color:var(--hint);margin-bottom:10px}
.booking-cancel{background:none;border:1px solid #f44336;color:#f44336;padding:6px 12px;border-radius:8px;font-size:13px;cursor:pointer}
.empty-state{text-align:center;padding:40px 20px;color:var(--hint)}
.empty-state-icon{font-size:48px;margin-bottom:16px}
.section-title{font-size:13px;font-weight:600;color:var(--hint);padding:16px;text-transform:uppercase}
.branch-list{padding:0 16px}
.branch-card{background:var(--sec);border-radius:12px;padding:16px;margin-bottom:10px;cursor:pointer;border:2px solid transparent}
.branch-card.selected{border-color:var(--btn)}
.branch-name{font-size:16px;font-weight:700;margin-bottom:4px}
.branch-address{font-size:13px;color:var(--hint);margin-bottom:4px}
.branch-hours{font-size:12px;color:var(--hint)}
.category-list{padding:0 16px}
.category-card{display:flex;align-items:center;gap:12px;background:var(--sec);border-radius:12px;padding:16px;margin-bottom:10px;cursor:pointer;border:2px solid transparent}
.category-card.selected{border-color:var(--btn)}
.category-icon{font-size:28px}
.category-name{font-size:16px;font-weight:600}
.doctors-list{display:flex;gap:10px;padding:0 16px 16px;overflow-x:auto}
.doctor-card{flex-shrink:0;width:130px;padding:14px;background:var(--sec);border-radius:12px;text-align:center;cursor:pointer;border:2px solid transparent}
.doctor-card.selected{border-color:var(--btn)}
.doctor-avatar{width:50px;height:50px;border-radius:50%;background:var(--btn);margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white}
.doctor-name{font-weight:600;font-size:13px;margin-bottom:2px}
.doctor-specialty{font-size:11px;color:var(--hint);margin-bottom:4px}
.doctor-rating{font-size:11px;color:var(--hint)}
.services-list{padding:0 16px}
.service-item{display:flex;justify-content:space-between;align-items:center;padding:14px;background:var(--sec);border-radius:10px;margin-bottom:8px;cursor:pointer;border:2px solid transparent}
.service-item.selected{border-color:var(--btn)}
.service-info h3{font-size:15px;margin-bottom:2px}
.service-info span{font-size:12px;color:var(--hint)}
.service-price{font-size:15px;font-weight:700;color:var(--btn)}
.dates-list{display:flex;gap:8px;padding:16px;overflow-x:auto}
.date-chip{flex-shrink:0;width:55px;padding:10px 6px;background:var(--sec);border-radius:10px;text-align:center;cursor:pointer;border:2px solid transparent}
.date-chip.selected{border-color:var(--btn);background:var(--btn);color:white}
.date-chip.disabled{opacity:0.3;cursor:not-allowed}
.date-chip-day{font-size:18px;font-weight:700}
.date-chip-weekday{font-size:10px;margin-top:2px}
.times-list{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:0 16px}
.time-slot{padding:10px;background:var(--sec);border-radius:8px;text-align:center;font-size:14px;cursor:pointer;border:2px solid transparent}
.time-slot.selected{border-color:var(--btn);background:var(--btn);color:white}
.time-slot.disabled{opacity:0.3;cursor:not-allowed}
.no-slots{text-align:center;padding:20px;color:var(--hint);font-size:14px}
.bottom-btn{position:fixed;bottom:0;left:0;right:0;padding:16px;background:var(--bg);border-top:1px solid var(--sec)}
.bottom-btn button{width:100%;padding:14px;font-size:16px;font-weight:600;background:var(--btn);color:var(--btn-text);border:none;border-radius:12px;cursor:pointer}
.bottom-btn button:disabled{opacity:0.5}
.success-container{padding:60px 20px;text-align:center}
.success-icon{font-size:70px;margin-bottom:20px}
.success-title{font-size:24px;font-weight:700;margin-bottom:8px}
.success-text{font-size:16px;margin-bottom:8px}
.success-details{color:var(--hint);margin-bottom:16px;font-size:14px;white-space:pre-line}
.menu-categories{display:flex;gap:8px;padding:16px;overflow-x:auto}
.menu-chip{flex-shrink:0;padding:10px 16px;background:var(--sec);border-radius:20px;font-size:13px;cursor:pointer;border:none;white-space:nowrap}
.menu-chip.active{background:var(--btn);color:var(--btn-text)}
.menu-items{padding:0 16px 100px;display:grid;gap:10px}
.menu-item{display:flex;gap:12px;padding:12px;background:var(--sec);border-radius:12px}
.menu-item-image{width:70px;height:70px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
.menu-item-info{flex:1;display:flex;flex-direction:column;justify-content:center}
.menu-item-name{font-size:15px;font-weight:600;margin-bottom:2px}
.menu-item-volume{font-size:12px;color:var(--hint);margin-bottom:6px}
.menu-item-price{font-size:15px;font-weight:700;color:var(--btn)}
.menu-item-add{width:34px;height:34px;border-radius:50%;background:var(--btn);color:var(--btn-text);border:none;font-size:18px;cursor:pointer;align-self:center}
.cart-fab{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--btn);color:var(--btn-text);border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.2);display:none;align-items:center;justify-content:center}
.cart-fab.show{display:flex}
.cart-badge{position:absolute;top:-4px;right:-4px;background:#f44336;color:white;width:22px;height:22px;border-radius:50%;font-size:11px;display:flex;align-items:center;justify-content:center}
.cart-items{padding:16px}
.cart-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--sec);border-radius:10px;margin-bottom:8px}
.cart-item-info{flex:1}
.cart-item-name{font-weight:600;margin-bottom:2px;font-size:14px}
.cart-item-price{color:var(--hint);font-size:13px}
.cart-item-controls{display:flex;align-items:center;gap:10px}
.cart-item-controls button{width:30px;height:30px;border-radius:50%;border:none;background:var(--btn);color:white;font-size:16px;cursor:pointer}
.cart-total{padding:16px;border-top:1px solid var(--sec)}
.cart-total-row{display:flex;justify-content:space-between;font-size:17px;font-weight:700;margin-bottom:16px}
.masters-list{display:flex;gap:10px;padding:0 16px 16px;overflow-x:auto}
.master-card{flex-shrink:0;width:90px;padding:14px;background:var(--sec);border-radius:12px;text-align:center;cursor:pointer;border:2px solid transparent}
.master-card.selected{border-color:var(--btn)}
.master-avatar{width:50px;height:50px;border-radius:50%;background:var(--btn);margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:24px}
.master-name{font-weight:600;font-size:13px;margin-bottom:2px}
.master-rating{font-size:11px;color:var(--hint)}
.menu-image-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:1000;display:none;flex-direction:column}
.menu-image-modal.show{display:flex}
.menu-image-header{padding:16px;display:flex;justify-content:space-between;align-items:center;color:white}
.menu-image-close{background:none;border:none;color:white;font-size:28px;cursor:pointer}
.menu-image-nav{display:flex;gap:10px}
.menu-image-nav button{background:rgba(255,255,255,0.2);border:none;color:white;padding:8px 16px;border-radius:8px;cursor:pointer}
.menu-image-nav button.active{background:var(--btn)}
.menu-image-container{flex:1;overflow:auto;padding:10px}
.menu-image-container img{width:100%;border-radius:8px}
</style>
</head>
<body>
<div id="page-register" class="page">
<div class="register-container">
<div class="register-icon">üì±</div>
<div class="register-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
<div class="register-text">–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –∏ –∑–∞–ø–∏—Å–µ–π</div>
<div class="input-group">
<label class="input-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
<input type="tel" id="phone-input" class="input-field" placeholder="+7 (999) 123-45-67" oninput="validatePhone()">
</div>
<button class="btn-primary" id="register-btn" onclick="register()" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
</div>
</div>

<div id="page-home" class="page">
<div class="header"><h1>BookIt</h1><button class="header-profile" onclick="openProfile()">üë§</button></div>
<div class="businesses-grid" id="businesses-list"></div>
</div>

<div id="page-profile" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">‚Üê</button><h1>–ü—Ä–æ—Ñ–∏–ª—å</h1><div style="width:40px"></div></div>
<div class="profile-header">
<div class="profile-avatar">üë§</div>
<div class="profile-name" id="profile-name">–ò–º—è</div>
<div class="profile-phone" id="profile-phone">+7</div>
</div>
<div class="profile-tabs">
<button class="profile-tab active" id="tab-bookings" onclick="switchTab('bookings')">–ó–∞–ø–∏—Å–∏</button>
<button class="profile-tab" id="tab-orders" onclick="switchTab('orders')">–ó–∞–∫–∞–∑—ã</button>
</div>
<div class="profile-content" id="profile-content"></div>
</div>

<div id="page-cafe" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">‚Üê</button><h1>Pink Purple</h1><button class="header-menu-btn" onclick="showMenuImages()">üìã –ú–µ–Ω—é</button></div>
<div class="menu-categories" id="menu-categories"></div>
<div class="menu-items" id="menu-items"></div>
<button class="cart-fab" id="cart-fab" onclick="showPage('page-cart')">üõí<span class="cart-badge" id="cart-badge">0</span></button>
</div>

<div id="page-cart" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-cafe')">‚Üê</button><h1>–ö–æ—Ä–∑–∏–Ω–∞</h1><div style="width:40px"></div></div>
<div class="cart-items" id="cart-items"></div>
<div class="cart-total">
<div class="cart-total-row"><span>–ò—Ç–æ–≥–æ</span><span id="cart-total">0‚ÇΩ</span></div>
<button class="btn-primary" onclick="submitOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>
</div>

<div id="page-barber" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">‚Üê</button><h1>PORTOS</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞</div>
<div class="masters-list" id="masters-list"></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</div>
<div class="services-list" id="barber-services"></div>
<div class="bottom-btn"><button id="barber-next-btn" onclick="goToBarberDateTime()" disabled>–í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è</button></div>
</div>

<div id="page-barber-datetime" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-barber')">‚Üê</button><h1>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</div>
<div class="dates-list" id="barber-dates"></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</div>
<div class="times-list" id="barber-times"></div>
<div class="bottom-btn"><button id="barber-book-btn" onclick="submitBarberBooking()" disabled>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button></div>
</div>

<div id="page-clinic-branches" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">‚Üê</button><h1>–ó–¥–æ—Ä–æ–≤—å–µ —Å–µ–º—å–∏</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª–∏–∞–ª</div>
<div class="branch-list" id="branch-list"></div>
</div>

<div id="page-clinic-categories" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-branches')">‚Üê</button><h1 id="clinic-branch-title">–§–∏–ª–∏–∞–ª</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
<div class="category-list" id="category-list"></div>
</div>

<div id="page-clinic-doctor" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-categories')">‚Üê</button><h1 id="clinic-category-title">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</div>
<div class="services-list" id="clinic-services"></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–∞—á–∞</div>
<div class="doctors-list" id="doctors-list"></div>
<div class="bottom-btn"><button id="clinic-next-btn" onclick="goToClinicDateTime()" disabled>–í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è</button></div>
</div>

<div id="page-clinic-datetime" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-doctor')">‚Üê</button><h1>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</h1><div style="width:40px"></div></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</div>
<div class="dates-list" id="clinic-dates"></div>
<div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</div>
<div id="clinic-times-container"><div class="times-list" id="clinic-times"></div></div>
<div class="bottom-btn"><button id="clinic-book-btn" onclick="submitClinicBooking()" disabled>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button></div>
</div>

<div id="page-success" class="page">
<div class="success-container">
<div class="success-icon" id="success-icon">‚úÖ</div>
<div class="success-title" id="success-title">–ì–æ—Ç–æ–≤–æ!</div>
<div class="success-text" id="success-text"></div>
<div class="success-details" id="success-details"></div>
<br><br>
<button class="btn-primary" onclick="showPage('page-home')">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
</div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ –º–µ–Ω—é -->
<div id="menu-image-modal" class="menu-image-modal">
<div class="menu-image-header">
<button class="menu-image-close" onclick="hideMenuImages()">‚úï</button>
<div class="menu-image-nav">
<button id="menu-img-btn-1" class="active" onclick="showMenuPage(1)">–°—Ç—Ä. 1</button>
<button id="menu-img-btn-2" onclick="showMenuPage(2)">–°—Ç—Ä. 2</button>
</div>
</div>
<div class="menu-image-container">
<img id="menu-full-image" src="" alt="–ú–µ–Ω—é Pink Purple">
</div>
</div>

<script>
const tg=window.Telegram.WebApp;tg.ready();tg.expand();
if(tg.themeParams.bg_color){document.documentElement.style.setProperty('--bg',tg.themeParams.bg_color);document.documentElement.style.setProperty('--text',tg.themeParams.text_color);document.documentElement.style.setProperty('--hint',tg.themeParams.hint_color);document.documentElement.style.setProperty('--btn',tg.themeParams.button_color);document.documentElement.style.setProperty('--btn-text',tg.themeParams.button_text_color);document.documentElement.style.setProperty('--sec',tg.themeParams.secondary_bg_color)}

const API_URL='https://bookit-api-camelot770.amvera.io';
let user=tg.initDataUnsafe?.user||{id:12345,first_name:'–¢–µ—Å—Ç'};
let userProfile=null,cart=[];

// –ö–∞—Ä—Ç–∏–Ω–∫–∏ –º–µ–Ω—é Pink Purple
const MENU_IMAGES=[
'https://i.imgur.com/Yprglgl.png',
'https://i.imgur.com/H7GdT6l.png'
];

let selectedMaster=null,selectedBarberService=null,selectedBarberDate=null,selectedBarberTime=null;
let barberServices={};
let selectedBranch=null,selectedCategory=null,selectedDoctor=null,selectedClinicService=null,selectedClinicDate=null,selectedClinicTime=null;
let branches=[],clinicServices={},categoryDoctors=[];

const FALLBACK_BRANCHES=[
{id:'branch_central',name:'–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–∏–ª–∏–∞–ª',address:'—É–ª. –õ–µ–Ω–∏–Ω–∞, 42',phone:'+7 (999) 111-22-33',work_hours:'8:00 - 20:00'},
{id:'branch_north',name:'–°–µ–≤–µ—Ä–Ω—ã–π —Ñ–∏–ª–∏–∞–ª',address:'–ø—Ä. –ú–∏—Ä–∞, 128',phone:'+7 (999) 222-33-44',work_hours:'9:00 - 21:00'},
{id:'branch_south',name:'–Æ–∂–Ω—ã–π —Ñ–∏–ª–∏–∞–ª',address:'—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 15',phone:'+7 (999) 333-44-55',work_hours:'8:00 - 19:00'}
];

const FALLBACK_SERVICES={
branch_central:{
therapy:{name:'ü©∫ –¢–µ—Ä–∞–ø–∏—è',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',items:[{id:'consult_therapy',name:'–ü—Ä–∏—ë–º —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞',price:1500,duration:30},{id:'checkup_basic',name:'–ë–∞–∑–æ–≤—ã–π –æ—Å–º–æ—Ç—Ä',price:2000,duration:45}]},
cardio:{name:'‚ù§Ô∏è –ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è',specialty:'–ö–∞—Ä–¥–∏–æ–ª–æ–≥',items:[{id:'consult_cardio',name:'–ü—Ä–∏—ë–º –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞',price:2000,duration:40},{id:'ecg',name:'–≠–ö–ì',price:1200,duration:20}]},
neuro:{name:'üß† –ù–µ–≤—Ä–æ–ª–æ–≥–∏—è',specialty:'–ù–µ–≤—Ä–æ–ª–æ–≥',items:[{id:'consult_neuro',name:'–ü—Ä–∏—ë–º –Ω–µ–≤—Ä–æ–ª–æ–≥–∞',price:1800,duration:30}]},
pediatrics:{name:'üë∂ –ü–µ–¥–∏–∞—Ç—Ä–∏—è',specialty:'–ü–µ–¥–∏–∞—Ç—Ä',items:[{id:'consult_child',name:'–ü—Ä–∏—ë–º –ø–µ–¥–∏–∞—Ç—Ä–∞',price:1600,duration:30}]}
},
branch_north:{
therapy:{name:'ü©∫ –¢–µ—Ä–∞–ø–∏—è',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',items:[{id:'consult_therapy',name:'–ü—Ä–∏—ë–º —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞',price:1400,duration:30}]},
gyneco:{name:'üë© –ì–∏–Ω–µ–∫–æ–ª–æ–≥–∏—è',specialty:'–ì–∏–Ω–µ–∫–æ–ª–æ–≥',items:[{id:'consult_gyn',name:'–ü—Ä–∏—ë–º –≥–∏–Ω–µ–∫–æ–ª–æ–≥–∞',price:2200,duration:40},{id:'uzi_gyn',name:'–£–ó–ò –æ—Ä–≥–∞–Ω–æ–≤ –º–∞–ª–æ–≥–æ —Ç–∞–∑–∞',price:2500,duration:30}]},
surgery:{name:'üî™ –•–∏—Ä—É—Ä–≥–∏—è',specialty:'–•–∏—Ä—É—Ä–≥',items:[{id:'consult_surg',name:'–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Ö–∏—Ä—É—Ä–≥–∞',price:1800,duration:30}]}
},
branch_south:{
therapy:{name:'ü©∫ –¢–µ—Ä–∞–ø–∏—è',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',items:[{id:'consult_therapy',name:'–ü—Ä–∏—ë–º —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞',price:1300,duration:30}]},
derma:{name:'üß¥ –î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è',specialty:'–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥',items:[{id:'consult_derma',name:'–ü—Ä–∏—ë–º –¥–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∞',price:1700,duration:30}]},
ortho:{name:'ü¶¥ –û—Ä—Ç–æ–ø–µ–¥–∏—è',specialty:'–û—Ä—Ç–æ–ø–µ–¥',items:[{id:'consult_ortho',name:'–ü—Ä–∏—ë–º –æ—Ä—Ç–æ–ø–µ–¥–∞',price:1900,duration:40}]},
eye:{name:'üëÅÔ∏è –û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è',specialty:'–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥',items:[{id:'consult_eye',name:'–ü—Ä–∏—ë–º –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∞',price:1600,duration:30}]}
}
};

const FALLBACK_DOCTORS={
branch_central:[
{id:'doc_ivanov',name:'–ò–≤–∞–Ω–æ–≤ –ê.–ò.',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',experience:'15 –ª–µ—Ç',rating:4.9},
{id:'doc_petrova',name:'–ü–µ—Ç—Ä–æ–≤–∞ –ú.–°.',specialty:'–ö–∞—Ä–¥–∏–æ–ª–æ–≥',experience:'12 –ª–µ—Ç',rating:4.8},
{id:'doc_sidorov',name:'–°–∏–¥–æ—Ä–æ–≤ –ö.–í.',specialty:'–ù–µ–≤—Ä–æ–ª–æ–≥',experience:'10 –ª–µ—Ç',rating:4.7},
{id:'doc_kozlova',name:'–ö–æ–∑–ª–æ–≤–∞ –ï.–ê.',specialty:'–ü–µ–¥–∏–∞—Ç—Ä',experience:'8 –ª–µ—Ç',rating:4.9}
],
branch_north:[
{id:'doc_smirnov',name:'–°–º–∏—Ä–Ω–æ–≤ –î.–ü.',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',experience:'20 –ª–µ—Ç',rating:4.9},
{id:'doc_volkova',name:'–í–æ–ª–∫–æ–≤–∞ –ò.–ù.',specialty:'–ì–∏–Ω–µ–∫–æ–ª–æ–≥',experience:'14 –ª–µ—Ç',rating:4.8},
{id:'doc_morozov',name:'–ú–æ—Ä–æ–∑–æ–≤ –ê.–°.',specialty:'–•–∏—Ä—É—Ä–≥',experience:'18 –ª–µ—Ç',rating:4.9}
],
branch_south:[
{id:'doc_novikov',name:'–ù–æ–≤–∏–∫–æ–≤ –ü.–ê.',specialty:'–¢–µ—Ä–∞–ø–µ–≤—Ç',experience:'11 –ª–µ—Ç',rating:4.7},
{id:'doc_fedorova',name:'–§—ë–¥–æ—Ä–æ–≤–∞ –û.–í.',specialty:'–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥',experience:'9 –ª–µ—Ç',rating:4.8},
{id:'doc_alexeev',name:'–ê–ª–µ–∫—Å–µ–µ–≤ –í.–ú.',specialty:'–û—Ä—Ç–æ–ø–µ–¥',experience:'16 –ª–µ—Ç',rating:4.9},
{id:'doc_egorova',name:'–ï–≥–æ—Ä–æ–≤–∞ –¢.–°.',specialty:'–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥',experience:'7 –ª–µ—Ç',rating:4.6}
]
};

function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');if(id==='page-cart')renderCart();try{tg.HapticFeedback.impactOccurred('light')}catch(e){}}

// –ú–æ–¥–∞–ª–∫–∞ –º–µ–Ω—é
function showMenuImages(){document.getElementById('menu-image-modal').classList.add('show');showMenuPage(1)}
function hideMenuImages(){document.getElementById('menu-image-modal').classList.remove('show')}
function showMenuPage(n){
document.getElementById('menu-img-btn-1').classList.toggle('active',n===1);
document.getElementById('menu-img-btn-2').classList.toggle('active',n===2);
document.getElementById('menu-full-image').src=MENU_IMAGES[n-1];
}

async function checkRegistration(){
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/profile');const d=await r.json();if(d.registered){userProfile=d;loadBusinesses();showPage('page-home')}else{showPage('page-register')}}catch(e){userProfile={phone:'',first_name:user.first_name};loadBusinesses();showPage('page-home')}
}

function validatePhone(){const p=document.getElementById('phone-input').value.replace(/\D/g,'');document.getElementById('register-btn').disabled=p.length<10}

async function register(){
const phone=document.getElementById('phone-input').value;
try{await fetch(API_URL+'/api/user/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,phone:phone,first_name:user.first_name,username:user.username})})}catch(e){}
userProfile={phone:phone,first_name:user.first_name};loadBusinesses();showPage('page-home');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

function loadBusinesses(){
const b=[
{id:'pink_purple',name:'Pink Purple',desc:'–°–º—É–∑–∏, –º–∏–ª–∫–∏, –≤–∞—Ñ–ª–∏',emoji:'üçπ',grad:'linear-gradient(135deg,#9C27B0,#E91E63)'},
{id:'portos',name:'PORTOS',desc:'–ú—É–∂—Å–∫–∏–µ —Å—Ç—Ä–∏–∂–∫–∏',emoji:'üíà',grad:'linear-gradient(135deg,#1a1a2e,#16213e)'},
{id:'clinic',name:'–ó–¥–æ—Ä–æ–≤—å–µ —Å–µ–º—å–∏',desc:'–°–µ—Ç—å –∫–ª–∏–Ω–∏–∫',emoji:'üè•',grad:'linear-gradient(135deg,#00b894,#00cec9)'}
];
document.getElementById('businesses-list').innerHTML=b.map(x=>'<div class="business-card" onclick="openBusiness(\''+x.id+'\')" style="background:'+x.grad+'"><div class="business-card-content"><div class="business-emoji">'+x.emoji+'</div><div class="business-name">'+x.name+'</div><div class="business-desc">'+x.desc+'</div></div></div>').join('');
}

function openBusiness(id){
if(id==='pink_purple'){loadCafeMenu();showPage('page-cafe')}
else if(id==='portos'){loadBarberData();showPage('page-barber')}
else if(id==='clinic'){loadClinicBranches();showPage('page-clinic-branches')}
}

function openProfile(){document.getElementById('profile-name').textContent=userProfile?.first_name||user.first_name||'–ì–æ—Å—Ç—å';document.getElementById('profile-phone').textContent=userProfile?.phone||'';switchTab('bookings');showPage('page-profile')}
function switchTab(t){document.querySelectorAll('.profile-tab').forEach(x=>x.classList.remove('active'));document.getElementById('tab-'+t).classList.add('active');if(t==='bookings')loadUserBookings();else loadUserOrders()}

async function loadUserBookings(){
const c=document.getElementById('profile-content');
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/bookings');const b=await r.json();
if(!b.length){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìÖ</div><div>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div></div>';return}
c.innerHTML=b.map(x=>{const d=new Date(x.date).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});const sc=x.status==='cancelled'?'cancelled':(x.is_past?'past':'');const st=x.status==='cancelled'?'–û—Ç–º–µ–Ω–µ–Ω–∞':(x.is_past?'–ó–∞–≤–µ—Ä—à–µ–Ω–∞':'–ê–∫—Ç–∏–≤–Ω–∞');const icon=x.business_id==='clinic'?'üë®‚Äç‚öïÔ∏è':'üë®‚Äçü¶±';return'<div class="booking-card '+(x.is_past?'past':'')+'"><div class="booking-header"><div class="booking-date">'+d+', '+x.time+'</div><div class="booking-status '+sc+'">'+st+'</div></div><div class="booking-service">'+x.service_name+'</div><div class="booking-master">'+icon+' '+x.master_name+'</div>'+(!x.is_past&&x.status!=='cancelled'?'<button class="booking-cancel" onclick="cancelBooking(\''+x.booking_id+'\')">–û—Ç–º–µ–Ω–∏—Ç—å</button>':'')+'</div>'}).join('')}catch(e){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìÖ</div><div>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div></div>'}
}

async function loadUserOrders(){
const c=document.getElementById('profile-content');
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/orders');const o=await r.json();
if(!o.length){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">üõí</div><div>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div>';return}
c.innerHTML=o.map(x=>{const d=new Date(x.created_at).toLocaleDateString('ru-RU',{day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'});return'<div class="booking-card"><div class="booking-header"><div class="booking-date">'+d+'</div><div class="booking-status">'+x.total+'‚ÇΩ</div></div><div class="booking-service">'+x.items.map(i=>i.name).join(', ')+'</div></div>'}).join('')}catch(e){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">üõí</div><div>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div>'}
}

async function cancelBooking(id){if(!confirm('–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?'))return;try{await fetch(API_URL+'/api/bookings/'+id+'/cancel?user_id='+user.id,{method:'POST'});try{tg.HapticFeedback.notificationOccurred('success')}catch(e){};loadUserBookings()}catch(e){alert('–û—à–∏–±–∫–∞')}}

// === CAFE - –ü–û–õ–ù–û–ï –ú–ï–ù–Æ PINK PURPLE ===
let currentMenu={};
function loadCafeMenu(){
currentMenu={
top:{name:'üî• –¢–æ–ø',items:[
{id:'pink_matcha',name:'–ü–∏–Ω–∫ –ú–∞—Ç—á–∞',price:409,vol:'400–º–ª',e:'üçµ',bg:'linear-gradient(135deg,#a8e6cf,#dcedc1)'},
{id:'pina_colada',name:'–ü–∏–Ω–∞ –ö–æ–ª–∞–¥–∞',price:349,vol:'400–º–ª',e:'ü••',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)'},
{id:'coco_pink',name:'–ö–æ–∫–æ –ü–∏–Ω–∫',price:499,vol:'500–º–ª',e:'ü••',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)'},
{id:'dubai_choco',name:'–î—É–±–∞–π—Å–∫–∏–π —à–æ–∫–æ–ª–∞–¥',price:599,vol:'500–º–ª',e:'üç´',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'dubai_chill',name:'–î—É–±–∞–π –ß–∏–ª',price:599,vol:'500–º–ª',e:'‚ùÑÔ∏è',bg:'linear-gradient(135deg,#667eea,#764ba2)'}
]},
smoothie:{name:'ü•§ –°–º—É–∑–∏',items:[
{id:'berry_smoothie',name:'–Ø–≥–æ–¥–Ω—ã–π —Å–º—É–∑–∏',price:489,vol:'500–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff6b6b,#c44569)'},
{id:'kiwi_cucumber',name:'–ö–∏–≤–∏-–û–≥—É—Ä–µ—Ü',price:489,vol:'500–º–ª',e:'ü•ù',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'mango_banana',name:'–ú–∞–Ω–≥–æ-–ë–∞–Ω–∞–Ω',price:489,vol:'500–º–ª',e:'ü•≠',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'cherry_cacao',name:'–í–∏—à–Ω—è-–ö–∞–∫–∞–æ',price:489,vol:'500–º–ª',e:'üçí',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)'},
{id:'strawberry_banana',name:'–ö–ª—É–±–Ω–∏–∫–∞-–ë–∞–Ω–∞–Ω',price:489,vol:'500–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'},
{id:'cucumber_mint',name:'–û–≥—É—Ä–µ—Ü-–ú—è—Ç–∞',price:489,vol:'500–º–ª',e:'ü•í',bg:'linear-gradient(135deg,#11998e,#38ef7d)'},
{id:'blueberry_banana',name:'–ß–µ—Ä–Ω–∏–∫–∞-–ë–∞–Ω–∞–Ω',price:489,vol:'500–º–ª',e:'ü´ê',bg:'linear-gradient(135deg,#4776e6,#8e54e9)'},
{id:'raspberry_apple',name:'–ú–∞–ª–∏–Ω–∞-–Ø–±–ª–æ–∫–æ',price:489,vol:'500–º–ª',e:'üçé',bg:'linear-gradient(135deg,#eb3349,#f45c43)'}
]},
bloom:{name:'üå∏ –ë–ª—É–º—ã',items:[
{id:'kiwi_maracuya',name:'–ö–∏–≤–∏-–ú–∞—Ä–∞–∫—É–π—è',price:349,vol:'400–º–ª',e:'ü•ù',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'guava_cherry',name:'–ì—É–∞–≤–∞-–í–∏—à–Ω—è',price:349,vol:'400–º–ª',e:'üçí',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'},
{id:'malina_bloom',name:'–ú–∞–ª–∏–Ω–∞–ë–ª—É–º',price:349,vol:'400–º–ª',e:'ü´ê',bg:'linear-gradient(135deg,#c31432,#240b36)'},
{id:'cherry_pomegranate',name:'–í–∏—à–Ω—è-–ì—Ä–∞–Ω–∞—Ç',price:349,vol:'400–º–ª',e:'üçí',bg:'linear-gradient(135deg,#8e0e00,#1f1c18)'},
{id:'peach_bloom',name:'–ü–µ—Ä—Å–∏–∫–æ–≤—ã–π –ë–ª—É–º',price:349,vol:'400–º–ª',e:'üçë',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)'},
{id:'strawberry_yuzu',name:'–ö–ª—É–±–Ω–∏–∫–∞-–Æ–¥–∑—É',price:349,vol:'400–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'},
{id:'blueberry_lavender',name:'–ß–µ—Ä–Ω–∏–∫–∞-–õ–∞–≤–∞–Ω–¥–∞',price:349,vol:'400–º–ª',e:'ü´ê',bg:'linear-gradient(135deg,#4776e6,#8e54e9)'},
{id:'strawberry_maracuya',name:'–ö–ª—É–±–Ω–∏–∫–∞-–ú–∞—Ä–∞–∫—É–π—è',price:349,vol:'400–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'},
{id:'mango_maracuya',name:'–ú–∞–Ω–≥–æ-–ú–∞—Ä–∞–∫—É–π—è',price:399,vol:'400–º–ª',e:'ü•≠',bg:'linear-gradient(135deg,#f7971e,#ffd200)'}
]},
milky:{name:'ü•õ –ú–∏–ª–∫–∏',items:[
{id:'milk_original',name:'–ú–∏–ª–∫–û—Ä–∏–¥–∂–∏–Ω–∞–ª',price:329,vol:'400–º–ª',e:'üßã',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'minty_milk',name:'–ú–∏–Ω—Ç–∏–ú–∏–ª–∫',price:349,vol:'400–º–ª',e:'üåø',bg:'linear-gradient(135deg,#11998e,#38ef7d)'},
{id:'green_milk',name:'–ì—Ä–∏–Ω–ú–∏–ª–∫',price:429,vol:'400–º–ª',e:'üçµ',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'caramel_milk',name:'–ö–∞—Ä–∞–º–µ–ª—å–ú–∏–ª–∫',price:399,vol:'400–º–ª',e:'üçØ',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'purple_milk',name:'–ü–µ—Ä–ø–ª–ú–∏–ª–∫',price:399,vol:'400–º–ª',e:'üçá',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)'},
{id:'pink_milk',name:'–ü–∏–Ω–∫–ú–∏–ª–∫',price:399,vol:'400–º–ª',e:'üå∏',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)'},
{id:'taro_milk',name:'–¢–∞—Ä–æ–ú–∏–ª–∫',price:409,vol:'400–º–ª',e:'üç†',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)'},
{id:'banana_milk',name:'–ë–∞–Ω–∞–Ω–∞–ú–∏–ª–∫',price:409,vol:'400–º–ª',e:'üçå',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'coco_milk',name:'–ö–æ–∫–æ–ú–∏–ª–∫',price:409,vol:'400–º–ª',e:'ü••',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'}
]},
freeze:{name:'üßä –§—Ä–∏–∑—ã',items:[
{id:'choco_oreo',name:'–®–æ–∫–æ–ª–∞–¥ –û—Ä–µ–æ',price:449,vol:'500–º–ª',e:'üç´',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'mango_freeze',name:'–ú–∞–Ω–≥–æ',price:499,vol:'500–º–ª',e:'ü•≠',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'blueberry_freeze',name:'–ß–µ—Ä–Ω–∏–∫–∞',price:449,vol:'500–º–ª',e:'ü´ê',bg:'linear-gradient(135deg,#4776e6,#8e54e9)'},
{id:'cherry_freeze',name:'–í–∏—à–Ω—è',price:449,vol:'500–º–ª',e:'üçí',bg:'linear-gradient(135deg,#c31432,#240b36)'},
{id:'grape_freeze',name:'–í–∏–Ω–æ–≥—Ä–∞–¥',price:449,vol:'500–º–ª',e:'üçá',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)'},
{id:'strawberry_freeze',name:'–ö–ª—É–±–Ω–∏–∫–∞',price:449,vol:'500–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'}
]},
sparkly:{name:'‚ú® –°–ø–∞—Ä–∫–ª—ã',items:[
{id:'mango_ginger',name:'–ú–∞–Ω–≥–æ-–ò–º–±–∏—Ä—å',price:349,vol:'500–º–ª',e:'ü•≠',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'pineapple_lychee',name:'–ê–Ω–∞–Ω–∞—Å-–õ–∏—á–∏',price:449,vol:'500–º–ª',e:'üçç',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)'},
{id:'apple_lime',name:'–Ø–±–ª–æ–∫–æ-–õ–∏–º–æ–Ω-–õ–∞–π–º',price:349,vol:'500–º–ª',e:'üçè',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'mint_malina',name:'–ú—è—Ç–∞-–ú–∞–ª–∏–Ω–∞',price:349,vol:'500–º–ª',e:'üåø',bg:'linear-gradient(135deg,#11998e,#38ef7d)'},
{id:'kiwi_lime',name:'–ö–∏–≤–∏-–õ–∞–π–º',price:349,vol:'500–º–ª',e:'ü•ù',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'lime_curacao',name:'–õ–∞–π–º-–ö—é—Ä–∞—Å–∞–æ',price:349,vol:'500–º–ª',e:'üçã',bg:'linear-gradient(135deg,#11998e,#38ef7d)'},
{id:'citrus_sparkly',name:'–¶–∏—Ç—Ä—É—Å',price:349,vol:'500–º–ª',e:'üçä',bg:'linear-gradient(135deg,#f7971e,#ffd200)'}
]},
milkshake:{name:'ü•§ –ú–∏–ª–∫—à–µ–π–∫–∏',items:[
{id:'classic_shake',name:'–ö–ª–∞—Å—Å–∏–∫–∞',price:449,vol:'500–º–ª',e:'ü•õ',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'choco_shake',name:'–®–æ–∫–æ–ª–∞–¥',price:449,vol:'500–º–ª',e:'üç´',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'strawberry_shake',name:'–ö–ª—É–±–Ω–∏–∫–∞',price:449,vol:'500–º–ª',e:'üçì',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)'},
{id:'caramel_shake',name:'–ö–∞—Ä–∞–º–µ–ª—å',price:449,vol:'500–º–ª',e:'üçØ',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'blueberry_shake',name:'–ß–µ—Ä–Ω–∏–∫–∞',price:449,vol:'500–º–ª',e:'ü´ê',bg:'linear-gradient(135deg,#4776e6,#8e54e9)'},
{id:'coffee_shake',name:'–ö–æ—Ñ–µ–π–Ω—ã–π',price:449,vol:'500–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'}
]},
coffee:{name:'‚òï –ö–æ—Ñ–µ',items:[
{id:'banana_caramel_latte',name:'–ë–∞–Ω–∞–Ω–æ–≤–æ-–∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π –ª–∞—Ç—Ç–µ',price:389,vol:'400–º–ª',e:'üçå',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'ice_latte',name:'–ê–π—Å–õ–∞—Ç—Ç–µ',price:389,vol:'400–º–ª',e:'üßä',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'pistachio_latte',name:'–§–∏—Å—Ç–∞—à–∫–æ–≤—ã–π –ª–∞—Ç—Ç–µ',price:449,vol:'400–º–ª',e:'ü•ú',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'matcha_latte',name:'–ú–∞—Ç—á–∞ –ª–∞—Ç—Ç–µ',price:429,vol:'400–º–ª',e:'üçµ',bg:'linear-gradient(135deg,#56ab2f,#a8e063)'},
{id:'cream_latte',name:'–°–ª–∏–≤–æ—á–Ω—ã–π –ª–∞—Ç—Ç–µ',price:429,vol:'400–º–ª',e:'ü•õ',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'cappuccino',name:'–ö–∞–ø—É—á–∏–Ω–æ',price:249,vol:'300–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'latte',name:'–õ–∞—Ç—Ç–µ',price:249,vol:'300–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'raf',name:'–†–∞—Ñ',price:249,vol:'300–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)'},
{id:'espresso',name:'–≠—Å–ø—Ä–µ—Å—Å–æ',price:190,vol:'50–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'americano',name:'–ê–º–µ—Ä–∏–∫–∞–Ω–æ',price:190,vol:'200–º–ª',e:'‚òï',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'}
]},
waffles:{name:'üßá –í–∞—Ñ–ª–∏',items:[
{id:'choco_mix',name:'–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –ú–∏–∫—Å',price:489,vol:'',e:'üç´',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'chicken_waffle',name:'–í–∞—Ñ–ª—è —Å –∫—É—Ä–∏—Ü–µ–π',price:489,vol:'',e:'üçó',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'choco_oreo_waffle',name:'–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –û—Ä–µ–æ',price:509,vol:'',e:'üç™',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'pink_purple_waffle',name:'–ü–∏–Ω–∫ –ü–µ—Ä–ø–ª',price:449,vol:'',e:'üå∏',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)'},
{id:'banana_nutella',name:'–ë–∞–Ω–∞–Ω –ù—É—Ç–µ–ª–ª–∞',price:449,vol:'',e:'üçå',bg:'linear-gradient(135deg,#f7971e,#ffd200)'}
]},
extra:{name:'‚ûï –î–æ–ø—ã',items:[
{id:'juice_balls',name:'–î–∂—É—Å –ë–æ–ª–ª—ã',price:99,vol:'',e:'ü´ß',bg:'linear-gradient(135deg,#667eea,#764ba2)'},
{id:'tapioca',name:'–¢–∞–ø–∏–æ–∫–∞',price:79,vol:'',e:'‚ö´',bg:'linear-gradient(135deg,#232526,#414345)'},
{id:'espresso_shot',name:'–®–æ—Ç —ç—Å–ø—Ä–µ—Å—Å–æ',price:89,vol:'',e:'‚òï',bg:'linear-gradient(135deg,#3a1c71,#d76d77)'},
{id:'syrup',name:'–°–∏—Ä–æ–ø',price:30,vol:'',e:'üçØ',bg:'linear-gradient(135deg,#f7971e,#ffd200)'},
{id:'cream_cap',name:'–°—ã—Ä–Ω–∞—è —à–∞–ø–∫–∞',price:99,vol:'',e:'üßÄ',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)'},
{id:'coconut_jelly',name:'–ö–æ–∫–æ—Å–æ–≤–æ–µ –∂–µ–ª–µ',price:79,vol:'',e:'ü••',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'},
{id:'alt_milk',name:'–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –º–æ–ª–æ–∫–æ',price:90,vol:'',e:'ü•õ',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)'}
]}
};
const c=Object.entries(currentMenu);
document.getElementById('menu-categories').innerHTML=c.map(([k,v],i)=>'<button class="menu-chip '+(i===0?'active':'')+'" onclick="selectMenuCat(\''+k+'\',this)">'+v.name+'</button>').join('');
renderMenu('top');
}
function selectMenuCat(k,el){document.querySelectorAll('.menu-chip').forEach(x=>x.classList.remove('active'));el.classList.add('active');renderMenu(k)}
function renderMenu(k){document.getElementById('menu-items').innerHTML=currentMenu[k].items.map(x=>'<div class="menu-item"><div class="menu-item-image" style="background:'+x.bg+'">'+x.e+'</div><div class="menu-item-info"><div class="menu-item-name">'+x.name+'</div>'+(x.vol?'<div class="menu-item-volume">'+x.vol+'</div>':'')+'<div class="menu-item-price">'+x.price+'‚ÇΩ</div></div><button class="menu-item-add" onclick="addToCart(\''+x.id+'\',\''+x.name+'\','+x.price+')">+</button></div>').join('')}
function addToCart(id,name,price){const e=cart.find(x=>x.id===id);if(e)e.qty++;else cart.push({id,name,price,qty:1});updateBadge();try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}}
function updateBadge(){const t=cart.reduce((s,x)=>s+x.qty,0);document.getElementById('cart-badge').textContent=t;document.getElementById('cart-fab').classList.toggle('show',t>0)}
function renderCart(){document.getElementById('cart-items').innerHTML=cart.map(x=>'<div class="cart-item"><div class="cart-item-info"><div class="cart-item-name">'+x.name+'</div><div class="cart-item-price">'+x.price+'‚ÇΩ</div></div><div class="cart-item-controls"><button onclick="changeQty(\''+x.id+'\',-1)">‚àí</button><span>'+x.qty+'</span><button onclick="changeQty(\''+x.id+'\',1)">+</button></div></div>').join('');document.getElementById('cart-total').textContent=cart.reduce((s,x)=>s+x.price*x.qty,0)+'‚ÇΩ'}
function changeQty(id,d){const x=cart.find(i=>i.id===id);if(x){x.qty+=d;if(x.qty<=0)cart=cart.filter(i=>i.id!==id)}renderCart();updateBadge()}
async function submitOrder(){const t=cart.reduce((s,x)=>s+x.price*x.qty,0);try{const r=await fetch(API_URL+'/api/orders',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username,first_name:user.first_name,business_id:'pink_purple',items:cart,total:t,phone:userProfile?.phone})});const d=await r.json();document.getElementById('success-icon').textContent='‚úÖ';document.getElementById('success-title').textContent='–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!';document.getElementById('success-text').textContent='#'+d.order_id;document.getElementById('success-details').textContent='–°—É–º–º–∞: '+t+'‚ÇΩ';cart=[];updateBadge();showPage('page-success');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}}catch(e){alert('–û—à–∏–±–∫–∞')}}

// === BARBER ===
let masters=[];
function loadBarberData(){masters=[{id:'artem',name:'–ê—Ä—Ç—ë–º',r:4.9},{id:'dmitry',name:'–î–º–∏—Ç—Ä–∏–π',r:4.8},{id:'rustam',name:'–†—É—Å—Ç–∞–º',r:4.9},{id:'vlad',name:'–í–ª–∞–¥–∏—Å–ª–∞–≤',r:4.7}];barberServices={haircut:{name:'‚úÇÔ∏è –°—Ç—Ä–∏–∂–∫–∏',items:[{id:'mens',name:'–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞',price:1200,dur:45},{id:'kids',name:'–î–µ—Ç—Å–∫–∞—è',price:800,dur:30}]},beard:{name:'üßî –ë–æ—Ä–æ–¥–∞',items:[{id:'trim',name:'–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ',price:700,dur:30}]},combo:{name:'üéØ –ö–æ–º–±–æ',items:[{id:'full',name:'–°—Ç—Ä–∏–∂–∫–∞+–ë–æ—Ä–æ–¥–∞',price:1700,dur:75}]}};renderMasters();renderBarberServices()}
function renderMasters(){document.getElementById('masters-list').innerHTML=masters.map(m=>'<div class="master-card '+(selectedMaster?.id===m.id?'selected':'')+'" onclick="selectMaster(\''+m.id+'\')"><div class="master-avatar">üíà</div><div class="master-name">'+m.name+'</div><div class="master-rating">‚≠ê '+m.r+'</div></div>').join('')}
function selectMaster(id){selectedMaster=masters.find(m=>m.id===id);renderMasters();updateBarberBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function renderBarberServices(){let h='';for(const[k,v]of Object.entries(barberServices)){h+=v.items.map(s=>'<div class="service-item '+(selectedBarberService?.id===s.id?'selected':'')+'" onclick="selectBarberSvc(\''+k+'\',\''+s.id+'\')"><div class="service-info"><h3>'+s.name+'</h3><span>'+s.dur+' –º–∏–Ω</span></div><div class="service-price">'+s.price+'‚ÇΩ</div></div>').join('')}document.getElementById('barber-services').innerHTML=h}
function selectBarberSvc(k,id){selectedBarberService=barberServices[k].items.find(s=>s.id===id);renderBarberServices();updateBarberBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function updateBarberBtn(){document.getElementById('barber-next-btn').disabled=!(selectedMaster&&selectedBarberService)}
async function goToBarberDateTime(){selectedBarberDate=null;selectedBarberTime=null;await renderBarberDates();showPage('page-barber-datetime')}
async function renderBarberDates(){const dates=[];const wd=['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];const t=new Date();for(let i=0;i<14;i++){const d=new Date(t);d.setDate(t.getDate()+i);dates.push({date:d.toISOString().split('T')[0],day:d.getDate(),wd:wd[d.getDay()],today:i===0})}document.getElementById('barber-dates').innerHTML=dates.map(d=>'<div class="date-chip '+(selectedBarberDate===d.date?'selected':'')+'" onclick="selectBarberDate(\''+d.date+'\')"><div class="date-chip-day">'+d.day+'</div><div class="date-chip-weekday">'+(d.today?'–°–µ–≥–æ–¥–Ω—è':d.wd)+'</div></div>').join('');if(!selectedBarberDate)selectBarberDate(dates[0].date)}
async function selectBarberDate(d){selectedBarberDate=d;selectedBarberTime=null;document.getElementById('barber-book-btn').disabled=true;renderBarberDates();await loadBarberSlots();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadBarberSlots(){const all=['10:00','10:30','11:00','11:30','12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00','19:30','20:00'];let av=all;try{const r=await fetch(API_URL+'/api/portos/slots/'+selectedMaster.id+'/'+selectedBarberDate);if(r.ok){const d=await r.json();av=d.slots||all}}catch(e){}if(av.length===0){document.getElementById('barber-times').innerHTML='<div class="no-slots">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</div>';return}document.getElementById('barber-times').innerHTML=av.map(s=>'<div class="time-slot '+(selectedBarberTime===s?'selected':'')+'" onclick="selectBarberTime(\''+s+'\')">'+s+'</div>').join('')}
function selectBarberTime(t){selectedBarberTime=t;loadBarberSlots();document.getElementById('barber-book-btn').disabled=false;try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function submitBarberBooking(){if(!selectedMaster||!selectedBarberService||!selectedBarberDate||!selectedBarberTime)return;try{await fetch(API_URL+'/api/bookings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username,first_name:user.first_name,business_id:'portos',service_id:selectedBarberService.id,service_name:selectedBarberService.name,service_price:selectedBarberService.price,master_id:selectedMaster.id,master_name:selectedMaster.name,date:selectedBarberDate,time:selectedBarberTime,phone:userProfile?.phone})});const dd=new Date(selectedBarberDate).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});document.getElementById('success-icon').textContent='üíà';document.getElementById('success-title').textContent='–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã!';document.getElementById('success-text').textContent=selectedBarberService.name+' —É '+selectedMaster.name;document.getElementById('success-details').textContent=dd+' –≤ '+selectedBarberTime;selectedMaster=null;selectedBarberService=null;selectedBarberDate=null;selectedBarberTime=null;showPage('page-success');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}}catch(e){alert('–û—à–∏–±–∫–∞')}}

// === CLINIC ===
async function loadClinicBranches(){try{const r=await fetch(API_URL+'/api/clinic/branches');if(r.ok){branches=await r.json()}else{branches=FALLBACK_BRANCHES}}catch(e){branches=FALLBACK_BRANCHES}renderBranches()}
function renderBranches(){document.getElementById('branch-list').innerHTML=branches.map(b=>'<div class="branch-card" onclick="selectBranch(\''+b.id+'\')"><div class="branch-name">'+b.name+'</div><div class="branch-address">üìç '+b.address+'</div><div class="branch-hours">üïê '+b.work_hours+'</div></div>').join('')}
async function selectBranch(id){selectedBranch=branches.find(b=>b.id===id);selectedCategory=null;selectedDoctor=null;selectedClinicService=null;document.getElementById('clinic-branch-title').textContent=selectedBranch.name;await loadBranchServices();showPage('page-clinic-categories');try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadBranchServices(){try{const r=await fetch(API_URL+'/api/clinic/branch/'+selectedBranch.id+'/services');if(r.ok){clinicServices=await r.json()}else{clinicServices=FALLBACK_SERVICES[selectedBranch.id]||{}}}catch(e){clinicServices=FALLBACK_SERVICES[selectedBranch.id]||{}}renderCategories()}
function renderCategories(){const cats=Object.entries(clinicServices);document.getElementById('category-list').innerHTML=cats.map(([k,v])=>'<div class="category-card" onclick="selectCategory(\''+k+'\')"><div class="category-icon">'+v.name.split(' ')[0]+'</div><div class="category-name">'+v.name.substring(v.name.indexOf(' ')+1)+'</div></div>').join('')}
async function selectCategory(catKey){selectedCategory=clinicServices[catKey];selectedDoctor=null;selectedClinicService=null;document.getElementById('clinic-category-title').textContent=selectedCategory.name;await loadCategoryDoctors();renderClinicServices();renderDoctors();showPage('page-clinic-doctor');try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadCategoryDoctors(){const specialty=selectedCategory.specialty;try{const r=await fetch(API_URL+'/api/clinic/branch/'+selectedBranch.id+'/doctors?specialty='+encodeURIComponent(specialty));if(r.ok){categoryDoctors=await r.json()}else{const all=FALLBACK_DOCTORS[selectedBranch.id]||[];categoryDoctors=all.filter(d=>d.specialty===specialty)}}catch(e){const all=FALLBACK_DOCTORS[selectedBranch.id]||[];categoryDoctors=all.filter(d=>d.specialty===specialty)}}
function renderClinicServices(){document.getElementById('clinic-services').innerHTML=selectedCategory.items.map(s=>'<div class="service-item '+(selectedClinicService?.id===s.id?'selected':'')+'" onclick="selectClinicService(\''+s.id+'\')"><div class="service-info"><h3>'+s.name+'</h3><span>'+s.duration+' –º–∏–Ω</span></div><div class="service-price">'+s.price+'‚ÇΩ</div></div>').join('')}
function selectClinicService(id){selectedClinicService=selectedCategory.items.find(s=>s.id===id);renderClinicServices();updateClinicBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function renderDoctors(){document.getElementById('doctors-list').innerHTML=categoryDoctors.map(d=>'<div class="doctor-card '+(selectedDoctor?.id===d.id?'selected':'')+'" onclick="selectDoctor(\''+d.id+'\')"><div class="doctor-avatar">üë®‚Äç‚öïÔ∏è</div><div class="doctor-name">'+d.name+'</div><div class="doctor-specialty">'+d.experience+'</div><div class="doctor-rating">‚≠ê '+d.rating+'</div></div>').join('')}
function selectDoctor(id){selectedDoctor=categoryDoctors.find(d=>d.id===id);renderDoctors();updateClinicBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function updateClinicBtn(){document.getElementById('clinic-next-btn').disabled=!(selectedDoctor&&selectedClinicService)}
async function goToClinicDateTime(){selectedClinicDate=null;selectedClinicTime=null;await renderClinicDates();showPage('page-clinic-datetime')}
async function renderClinicDates(){const dates=[];const wd=['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];const t=new Date();for(let i=0;i<14;i++){const d=new Date(t);d.setDate(t.getDate()+i);dates.push({date:d.toISOString().split('T')[0],day:d.getDate(),wd:wd[d.getDay()],today:i===0})}document.getElementById('clinic-dates').innerHTML=dates.map(d=>'<div class="date-chip '+(selectedClinicDate===d.date?'selected':'')+'" onclick="selectClinicDate(\''+d.date+'\')"><div class="date-chip-day">'+d.day+'</div><div class="date-chip-weekday">'+(d.today?'–°–µ–≥–æ–¥–Ω—è':d.wd)+'</div></div>').join('');if(!selectedClinicDate)selectClinicDate(dates[0].date)}
async function selectClinicDate(d){selectedClinicDate=d;selectedClinicTime=null;document.getElementById('clinic-book-btn').disabled=true;renderClinicDates();await loadClinicSlots();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadClinicSlots(){const all=['09:00','09:30','10:00','10:30','11:00','11:30','12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00'];let av=all;try{const r=await fetch(API_URL+'/api/clinic/slots/'+selectedBranch.id+'/'+selectedDoctor.id+'/'+selectedClinicDate);if(r.ok){const d=await r.json();av=d.slots||all}}catch(e){}const container=document.getElementById('clinic-times-container');if(av.length===0){container.innerHTML='<div class="no-slots">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</div>';return}container.innerHTML='<div class="times-list" id="clinic-times">'+av.map(s=>'<div class="time-slot '+(selectedClinicTime===s?'selected':'')+'" onclick="selectClinicTime(\''+s+'\')">'+s+'</div>').join('')+'</div>'}
function selectClinicTime(t){selectedClinicTime=t;loadClinicSlots();document.getElementById('clinic-book-btn').disabled=false;try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function submitClinicBooking(){if(!selectedBranch||!selectedDoctor||!selectedClinicService||!selectedClinicDate||!selectedClinicTime)return;try{await fetch(API_URL+'/api/bookings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username,first_name:user.first_name,business_id:'clinic',branch_id:selectedBranch.id,service_id:selectedClinicService.id,service_name:selectedClinicService.name,service_price:selectedClinicService.price,master_id:selectedDoctor.id,master_name:selectedDoctor.name,date:selectedClinicDate,time:selectedClinicTime,phone:userProfile?.phone})});const dd=new Date(selectedClinicDate).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});document.getElementById('success-icon').textContent='üè•';document.getElementById('success-title').textContent='–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã!';document.getElementById('success-text').textContent=selectedClinicService.name;document.getElementById('success-details').textContent='–í—Ä–∞—á: '+selectedDoctor.name+'\n'+selectedBranch.name+'\n'+dd+' –≤ '+selectedClinicTime;selectedBranch=null;selectedCategory=null;selectedDoctor=null;selectedClinicService=null;selectedClinicDate=null;selectedClinicTime=null;showPage('page-success');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}}catch(e){alert('–û—à–∏–±–∫–∞')}}

checkRegistration();
</script>
</body>
</html>
