<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BookIt</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#050507;
--bg-elevated:#0c0c10;
--bg-card:#121218;
--bg-card-hover:#1a1a22;
--text:#ffffff;
--text-secondary:#8a8a9a;
--text-muted:#55555f;
--gold:#d4af37;
--gold-light:#f4e4bc;
--gold-glow:rgba(212,175,55,0.3);
--platinum:#e5e4e2;
--accent:#9d7cff;
--accent-pink:#ff6b9d;
--success:#00d48a;
--danger:#ff4757;
--border:rgba(255,255,255,0.06);
--border-gold:rgba(212,175,55,0.3);
--gradient-gold:linear-gradient(135deg,#d4af37 0%,#f4e4bc 50%,#d4af37 100%);
--gradient-premium:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f64f59 100%);
--gradient-dark:linear-gradient(180deg,rgba(255,255,255,0.08) 0%,rgba(255,255,255,0) 100%);
--gradient-shine:linear-gradient(90deg,transparent 0%,rgba(255,255,255,0.1) 50%,transparent 100%);
--shadow-luxury:0 20px 60px rgba(0,0,0,0.6),0 8px 20px rgba(0,0,0,0.4);
--shadow-gold:0 0 40px rgba(212,175,55,0.2),0 0 80px rgba(212,175,55,0.1);
--shadow-inner:inset 0 1px 0 rgba(255,255,255,0.05);
}

body{
font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
background:var(--bg);
background-image:radial-gradient(ellipse at top,rgba(102,126,234,0.08) 0%,transparent 50%),
radial-gradient(ellipse at bottom right,rgba(212,175,55,0.05) 0%,transparent 50%);
color:var(--text);
min-height:100vh;
padding-bottom:120px;
-webkit-font-smoothing:antialiased
}

.page{display:none;animation:luxuryFadeIn 0.5s cubic-bezier(0.4,0,0.2,1)}.page.active{display:block}
@keyframes luxuryFadeIn{from{opacity:0;transform:translateY(20px) scale(0.98)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(212,175,55,0.3)}50%{box-shadow:0 0 40px rgba(212,175,55,0.5)}}
@keyframes borderGlow{0%,100%{border-color:rgba(212,175,55,0.3)}50%{border-color:rgba(212,175,55,0.6)}}

/* === HEADER === */
.header{
padding:20px 24px;
background:linear-gradient(180deg,var(--bg) 0%,transparent 100%);
position:sticky;top:0;z-index:100;
display:flex;justify-content:space-between;align-items:center;
backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px)
}
.header::after{content:'';position:absolute;bottom:0;left:24px;right:24px;height:1px;background:var(--gradient-gold);opacity:0.2}
.header h1{
font-size:26px;font-weight:700;letter-spacing:-0.5px;
background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
filter:drop-shadow(0 2px 10px rgba(212,175,55,0.3))
}
.header-back{
background:var(--bg-card);
border:1px solid var(--border);
width:44px;height:44px;border-radius:14px;
font-size:18px;cursor:pointer;color:var(--text);
display:flex;align-items:center;justify-content:center;
transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
box-shadow:var(--shadow-inner)
}
.header-back:hover{background:var(--bg-card-hover);border-color:var(--gold);transform:scale(1.05)}
.header-profile{
background:var(--gradient-gold);
border:none;width:48px;height:48px;border-radius:16px;
font-size:22px;cursor:pointer;
box-shadow:var(--shadow-gold);
transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
animation:glow 3s infinite;
overflow:hidden;
display:flex;align-items:center;justify-content:center
}
.header-profile img{
width:100%;height:100%;object-fit:cover
}
.header-profile:hover{transform:scale(1.1) rotate(5deg)}
.header-menu-btn{
background:transparent;
border:1px solid var(--gold);
padding:12px 20px;border-radius:12px;
font-size:13px;font-weight:600;cursor:pointer;
color:var(--gold);
transition:all 0.3s;
text-transform:uppercase;letter-spacing:1px
}
.header-menu-btn:hover{background:var(--gold);color:var(--bg)}

/* === REGISTER === */
.register-container{padding:80px 28px;text-align:center}
.register-icon{
font-size:100px;margin-bottom:40px;
animation:float 4s ease-in-out infinite;
filter:drop-shadow(0 20px 40px rgba(212,175,55,0.3))
}
.register-title{
font-size:34px;font-weight:700;margin-bottom:16px;letter-spacing:-1px;
background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text
}
.register-text{color:var(--text-secondary);margin-bottom:48px;font-size:16px;line-height:1.7}

/* === INPUTS === */
.input-group{margin-bottom:28px;text-align:left}
.input-label{
font-size:11px;font-weight:700;color:var(--gold);
margin-bottom:12px;display:block;
text-transform:uppercase;letter-spacing:1.5px
}
.input-field{
width:100%;padding:20px 24px;font-size:17px;
border:1px solid var(--border);border-radius:18px;
background:var(--bg-card);color:var(--text);
outline:none;transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
font-family:inherit;
box-shadow:var(--shadow-inner)
}
.input-field:focus{
border-color:var(--gold);
box-shadow:var(--shadow-gold),var(--shadow-inner);
background:var(--bg-elevated)
}
.input-field::placeholder{color:var(--text-muted)}

/* === BUTTONS === */
.btn-primary{
width:100%;padding:20px;font-size:15px;font-weight:700;
background:var(--gradient-gold);color:var(--bg);
border:none;border-radius:18px;cursor:pointer;
transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
box-shadow:var(--shadow-gold);
font-family:inherit;text-transform:uppercase;letter-spacing:1px;
position:relative;overflow:hidden
}
.btn-primary::before{
content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
background:var(--gradient-shine);
transition:left 0.5s
}
.btn-primary:hover::before{left:100%}
.btn-primary:hover{transform:translateY(-3px);box-shadow:0 15px 50px rgba(212,175,55,0.4)}
.btn-primary:active{transform:translateY(-1px)}
.btn-primary:disabled{opacity:0.3;transform:none;box-shadow:none}

/* === BUSINESS CARDS === */
.businesses-grid{padding:24px;display:flex;flex-direction:column;gap:20px}
.business-card{
border-radius:28px;position:relative;height:180px;
cursor:pointer;overflow:hidden;
transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
box-shadow:var(--shadow-luxury);
border:1px solid var(--border)
}
.business-card::before{
content:'';position:absolute;top:0;left:0;right:0;bottom:0;
background:linear-gradient(180deg,transparent 0%,transparent 40%,rgba(0,0,0,0.9) 100%);
z-index:1
}
.business-card::after{
content:'';position:absolute;top:0;left:0;right:0;height:1px;
background:var(--gradient-gold);opacity:0;
transition:opacity 0.3s
}
.business-card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 30px 80px rgba(0,0,0,0.7)}
.business-card:hover::after{opacity:0.5}
.business-card-content{position:absolute;bottom:0;left:0;right:0;padding:24px;color:white;z-index:2}
.business-emoji{font-size:44px;margin-bottom:12px;filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3))}
.business-name{font-size:24px;font-weight:700;margin-bottom:6px;letter-spacing:-0.5px}
.business-desc{font-size:14px;opacity:0.8;font-weight:500}

/* === PROFILE === */
.profile-header{
padding:40px 28px;text-align:center;
background:linear-gradient(180deg,var(--bg-elevated) 0%,var(--bg) 100%);
border-bottom:1px solid var(--border);
position:relative
}
.profile-header::before{
content:'';position:absolute;top:0;left:0;right:0;height:200px;
background:radial-gradient(ellipse at center top,rgba(212,175,55,0.1) 0%,transparent 70%);
pointer-events:none
}
.profile-avatar{
width:100px;height:100px;border-radius:50%;
background:var(--gradient-gold);
color:var(--bg);font-size:44px;
display:flex;align-items:center;justify-content:center;
margin:0 auto 20px;
box-shadow:var(--shadow-gold);
border:3px solid var(--bg);
animation:glow 3s infinite;
position:relative
}
.profile-name{font-size:26px;font-weight:700;margin-bottom:8px;letter-spacing:-0.5px}
.profile-phone{color:var(--text-secondary);font-size:15px}

/* === TABS === */
.profile-tabs{
display:flex;padding:12px;margin:20px;
background:var(--bg-card);border-radius:20px;gap:6px;
border:1px solid var(--border)
}
.profile-tab{
flex:1;padding:16px;text-align:center;
font-size:13px;font-weight:600;color:var(--text-muted);
background:transparent;border:none;cursor:pointer;
border-radius:14px;transition:all 0.3s;font-family:inherit;
text-transform:uppercase;letter-spacing:0.5px
}
.profile-tab.active{
color:var(--bg);background:var(--gradient-gold);
box-shadow:var(--shadow-gold)
}

/* === CARDS === */
.profile-content{padding:20px}

/* === THEME SETTINGS === */
.theme-section{
padding:20px;
border-top:1px solid var(--border);
margin-top:20px
}
.theme-section-title{
font-size:14px;font-weight:700;color:var(--gold);
text-transform:uppercase;letter-spacing:1px;
margin-bottom:16px
}
.theme-options{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:12px
}
.theme-btn{
background:var(--bg-card);
border:2px solid var(--border);
border-radius:16px;
padding:12px 8px;
cursor:pointer;
transition:all 0.3s;
display:flex;flex-direction:column;
align-items:center;gap:8px;
font-family:inherit
}
.theme-btn span:last-child{
font-size:11px;font-weight:600;
color:var(--text-secondary)
}
.theme-btn:hover{border-color:var(--gold)}
.theme-btn.active{
border-color:var(--gold);
background:rgba(212,175,55,0.1);
box-shadow:0 0 20px rgba(212,175,55,0.2)
}
.theme-btn.active span:last-child{color:var(--gold)}
.theme-preview{
width:40px;height:40px;border-radius:12px;
border:1px solid rgba(255,255,255,0.1)
}
.lang-flag{
font-size:28px;
line-height:1
}
.lang-options{
grid-template-columns:repeat(3,1fr)
}
.dark-preview{background:linear-gradient(135deg,#050507 0%,#121218 100%)}
.light-preview{background:linear-gradient(135deg,#f5f5f7 0%,#ffffff 100%)}
.premium-preview{background:linear-gradient(135deg,#d4af37 0%,#f4e4bc 50%,#d4af37 100%)}
.purple-preview{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
.ocean-preview{background:linear-gradient(135deg,#0077b6 0%,#00b4d8 100%)}
.sunset-preview{background:linear-gradient(135deg,#f72585 0%,#ffd60a 100%)}
.tatarstan-preview{background:linear-gradient(180deg,#00963c 0%,#00963c 33%,#ffffff 33%,#ffffff 66%,#cc0000 66%,#cc0000 100%)}
.newyear-preview{background:linear-gradient(135deg,#c41e3a 0%,#228b22 35%,#ffd700 50%,#228b22 65%,#c41e3a 100%)}

/* === THEME VARIABLES === */
[data-theme="light"]{
--bg:#f5f5f7;
--bg-elevated:#ffffff;
--bg-card:#ffffff;
--bg-card-hover:#f0f0f2;
--text:#1a1a1a;
--text-secondary:#666666;
--text-muted:#999999;
--border:rgba(0,0,0,0.12);
--shadow-luxury:0 10px 40px rgba(0,0,0,0.1);
--shadow-inner:0 1px 3px rgba(0,0,0,0.05);
--shadow-gold:0 4px 20px rgba(212,175,55,0.3);
--gold:#b8860b;
--gold-light:#d4a855;
--gold-glow:rgba(184,134,11,0.3);
--gradient-gold:linear-gradient(135deg,#d4af37 0%,#f4e4bc 50%,#d4af37 100%);
--success:#22c55e;
--danger:#ef4444;
--gradient-shine:linear-gradient(90deg,transparent,rgba(212,175,55,0.1),transparent)
}
[data-theme="premium"]{
--bg:#0a0a0f;
--bg-elevated:#12121a;
--bg-card:#1a1a25;
--bg-card-hover:#252535;
--text:#ffffff;
--text-secondary:#a0a0a0;
--text-muted:#666666;
--border:rgba(255,215,0,0.15);
--shadow-luxury:0 20px 60px rgba(255,215,0,0.15);
--shadow-inner:0 2px 8px rgba(0,0,0,0.3);
--shadow-gold:0 4px 30px rgba(255,215,0,0.4);
--gold:#ffd700;
--gold-light:#fff4b8;
--gold-glow:rgba(255,215,0,0.5);
--gradient-gold:linear-gradient(135deg,#ffd700 0%,#fff4b8 50%,#ffd700 100%);
--success:#22c55e;
--danger:#ef4444;
--gradient-shine:linear-gradient(90deg,transparent,rgba(255,215,0,0.3),transparent)
}
[data-theme="purple"]{
--bg:#0f0a1a;
--bg-elevated:#1a1025;
--bg-card:#251a35;
--bg-card-hover:#352545;
--text:#ffffff;
--text-secondary:#a78bfa;
--text-muted:#6b5b95;
--border:rgba(167,139,250,0.2);
--shadow-luxury:0 20px 60px rgba(167,139,250,0.15);
--shadow-inner:0 2px 8px rgba(0,0,0,0.3);
--shadow-gold:0 4px 30px rgba(167,139,250,0.4);
--gold:#a78bfa;
--gold-light:#c4b5fd;
--gold-glow:rgba(167,139,250,0.5);
--gradient-gold:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
--success:#22c55e;
--danger:#ef4444;
--gradient-shine:linear-gradient(90deg,transparent,rgba(167,139,250,0.3),transparent)
}
[data-theme="ocean"]{
--bg:#0a1628;
--bg-elevated:#0d1f3c;
--bg-card:#132744;
--bg-card-hover:#1a3355;
--text:#ffffff;
--text-secondary:#67e8f9;
--text-muted:#0e7490;
--border:rgba(0,212,255,0.2);
--shadow-luxury:0 20px 60px rgba(0,212,255,0.15);
--shadow-inner:0 2px 8px rgba(0,0,0,0.3);
--shadow-gold:0 4px 30px rgba(0,212,255,0.4);
--gold:#00d4ff;
--gold-light:#67e8f9;
--gold-glow:rgba(0,212,255,0.5);
--gradient-gold:linear-gradient(135deg,#0077b6 0%,#00b4d8 100%);
--success:#22c55e;
--danger:#ef4444;
--gradient-shine:linear-gradient(90deg,transparent,rgba(0,212,255,0.3),transparent)
}
[data-theme="sunset"]{
--bg:#1a0a14;
--bg-elevated:#2a1020;
--bg-card:#3a1830;
--bg-card-hover:#4a2040;
--text:#ffffff;
--text-secondary:#ff85b3;
--text-muted:#a83279;
--border:rgba(247,37,133,0.2);
--shadow-luxury:0 20px 60px rgba(247,37,133,0.15);
--shadow-inner:0 2px 8px rgba(0,0,0,0.3);
--shadow-gold:0 4px 30px rgba(247,37,133,0.4);
--gold:#f72585;
--gold-light:#ff85b3;
--gold-glow:rgba(247,37,133,0.5);
--gradient-gold:linear-gradient(135deg,#f72585 0%,#ffd60a 100%);
--success:#22c55e;
--danger:#ef4444;
--gradient-shine:linear-gradient(90deg,transparent,rgba(247,37,133,0.3),transparent)
}
[data-theme="tatarstan"]{
--bg:#071a0d;
--bg-elevated:#0c2614;
--bg-card:#12351c;
--bg-card-hover:#184525;
--text:#ffffff;
--text-secondary:#8eedb0;
--text-muted:#4a9960;
--border:rgba(0,150,60,0.3);
--shadow-luxury:0 20px 60px rgba(0,150,60,0.2);
--shadow-inner:0 2px 8px rgba(0,0,0,0.4);
--shadow-gold:0 4px 30px rgba(0,150,60,0.5);
--gold:#00c853;
--gold-light:#8eedb0;
--gold-glow:rgba(0,200,83,0.5);
--gradient-gold:linear-gradient(135deg,#cc0000 0%,#00c853 100%);
--success:#00c853;
--danger:#cc0000;
--gradient-shine:linear-gradient(90deg,transparent,rgba(0,200,83,0.3),transparent)
}
[data-theme="newyear"]{
--bg:#0a0f1a;
--bg-elevated:#101828;
--bg-card:#1a2540;
--bg-card-hover:#243050;
--text:#ffffff;
--text-secondary:#a8d4ff;
--text-muted:#5a8cba;
--border:rgba(200,0,0,0.3);
--shadow-luxury:0 20px 60px rgba(200,0,0,0.2);
--shadow-inner:0 2px 8px rgba(0,0,0,0.4);
--shadow-gold:0 4px 30px rgba(200,0,0,0.4);
--gold:#ff1744;
--gold-light:#ff8a80;
--gold-glow:rgba(255,23,68,0.5);
--gradient-gold:linear-gradient(135deg,#c41e3a 0%,#ffd700 50%,#228b22 100%);
--success:#228b22;
--danger:#c41e3a;
--gradient-shine:linear-gradient(90deg,transparent,rgba(255,215,0,0.4),transparent)
}

.booking-card{
background:var(--bg-card);border-radius:24px;
padding:22px;margin-bottom:16px;
border:1px solid var(--border);
transition:all 0.3s;
box-shadow:var(--shadow-inner)
}
.booking-card:hover{border-color:rgba(212,175,55,0.2)}
.booking-card.past{opacity:0.4}
.booking-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.booking-date{font-size:18px;font-weight:700}
.booking-status{
font-size:10px;padding:8px 14px;border-radius:30px;
background:var(--success);color:white;
font-weight:700;text-transform:uppercase;letter-spacing:0.5px
}
.booking-status.cancelled{background:var(--danger)}
.booking-status.past{background:var(--text-muted)}
.booking-service{font-size:16px;margin-bottom:8px;font-weight:500}
.booking-master{font-size:14px;color:var(--text-secondary);margin-bottom:16px}
.booking-cancel{
background:transparent;border:1px solid var(--danger);
color:var(--danger);padding:12px 20px;border-radius:14px;
font-size:13px;font-weight:600;cursor:pointer;
transition:all 0.3s;font-family:inherit
}
.booking-cancel:hover{background:var(--danger);color:white}

.empty-state{text-align:center;padding:80px 28px;color:var(--text-muted)}
.empty-state-icon{font-size:80px;margin-bottom:24px;opacity:0.3}

/* === SECTIONS === */
.section-title{
font-size:11px;font-weight:700;color:var(--gold);
padding:24px;text-transform:uppercase;letter-spacing:2px
}

/* === LISTS === */
.branch-list,.category-list,.services-list{padding:0 24px}
.branch-card,.category-card{
background:var(--bg-card);border-radius:22px;
padding:22px;margin-bottom:14px;cursor:pointer;
border:1px solid var(--border);transition:all 0.3s
}
.branch-card:hover,.category-card:hover{border-color:rgba(212,175,55,0.3)}
.branch-card.selected,.category-card.selected{
border-color:var(--gold);
background:linear-gradient(135deg,rgba(212,175,55,0.1) 0%,transparent 100%);
box-shadow:var(--shadow-gold)
}
.branch-name{font-size:18px;font-weight:700;margin-bottom:8px}
.branch-address{font-size:14px;color:var(--text-secondary);margin-bottom:4px}
.branch-hours{font-size:13px;color:var(--text-muted)}
.category-card{display:flex;align-items:center;gap:18px}
.category-icon{font-size:36px}
.category-name{font-size:18px;font-weight:600}

/* === DOCTORS / MASTERS === */
.doctors-list,.masters-list{display:flex;gap:14px;padding:0 24px 24px;overflow-x:auto}
.doctor-card,.master-card{
flex-shrink:0;width:140px;padding:22px 16px;
background:var(--bg-card);border-radius:24px;
text-align:center;cursor:pointer;
border:1px solid var(--border);transition:all 0.3s
}
.doctor-card:hover,.master-card:hover{border-color:rgba(212,175,55,0.3)}
.doctor-card.selected,.master-card.selected{
border-color:var(--gold);
background:linear-gradient(135deg,rgba(212,175,55,0.1) 0%,transparent 100%)
}
.doctor-avatar,.master-avatar{
width:64px;height:64px;border-radius:50%;
background:var(--gradient-gold);
margin:0 auto 14px;
display:flex;align-items:center;justify-content:center;
font-size:28px;color:var(--bg)
}
.doctor-name,.master-name{font-weight:600;font-size:14px;margin-bottom:6px}
.doctor-specialty{font-size:12px;color:var(--text-secondary);margin-bottom:6px}
.doctor-rating,.master-rating{font-size:12px;color:var(--gold)}

/* === SERVICES === */
.service-item{
display:flex;justify-content:space-between;align-items:center;
padding:20px;background:var(--bg-card);border-radius:18px;
margin-bottom:12px;cursor:pointer;
border:1px solid var(--border);transition:all 0.3s
}
.service-item:hover{border-color:rgba(212,175,55,0.3)}
.service-item.selected{border-color:var(--gold);background:linear-gradient(135deg,rgba(212,175,55,0.1) 0%,transparent 100%)}
.service-info h3{font-size:16px;font-weight:600;margin-bottom:6px}
.service-info span{font-size:13px;color:var(--text-secondary)}
.service-price{font-size:17px;font-weight:700;color:var(--gold)}

/* === DATE / TIME === */
.dates-list{display:flex;gap:12px;padding:24px;overflow-x:auto}
.date-chip{
flex-shrink:0;width:68px;padding:16px 10px;
background:var(--bg-card);border-radius:20px;
text-align:center;cursor:pointer;
border:1px solid var(--border);transition:all 0.3s
}
.date-chip:hover{border-color:rgba(212,175,55,0.3)}
.date-chip.selected{
border-color:var(--gold);background:var(--gradient-gold);color:var(--bg);
box-shadow:var(--shadow-gold)
}
.date-chip.disabled{opacity:0.2;cursor:not-allowed}
.date-chip-day{font-size:22px;font-weight:700}
.date-chip-weekday{font-size:11px;margin-top:6px;font-weight:600;text-transform:uppercase}

.times-list{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;padding:0 24px}
.time-slot{
padding:16px;background:var(--bg-card);border-radius:16px;
text-align:center;font-size:15px;font-weight:600;
cursor:pointer;border:1px solid var(--border);transition:all 0.3s
}
.time-slot:hover{border-color:rgba(212,175,55,0.3)}
.time-slot.selected{
border-color:var(--gold);background:var(--gradient-gold);color:var(--bg);
box-shadow:var(--shadow-gold)
}
.time-slot.disabled{opacity:0.2;cursor:not-allowed}
.no-slots{text-align:center;padding:40px;color:var(--text-muted);font-size:16px}

/* === BOTTOM BUTTON === */
.bottom-btn{
position:fixed;bottom:0;left:0;right:0;
padding:24px;
background:linear-gradient(180deg,transparent 0%,var(--bg) 40%);
backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px)
}
.bottom-btn button{
width:100%;padding:20px;font-size:15px;font-weight:700;
background:var(--gradient-gold);color:var(--bg);
border:none;border-radius:18px;cursor:pointer;
box-shadow:var(--shadow-gold);
transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
font-family:inherit;text-transform:uppercase;letter-spacing:1px
}
.bottom-btn button:hover{transform:translateY(-3px);box-shadow:0 20px 60px rgba(212,175,55,0.4)}
.bottom-btn button:disabled{opacity:0.3;transform:none;box-shadow:none}

/* === SUCCESS === */
.success-container{padding:100px 28px;text-align:center}
.success-icon{font-size:100px;margin-bottom:32px;animation:float 3s ease-in-out infinite}
.success-title{
font-size:32px;font-weight:700;margin-bottom:16px;letter-spacing:-1px;
background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text
}
.success-text{font-size:18px;margin-bottom:12px;font-weight:500}
.success-details{color:var(--text-secondary);margin-bottom:24px;font-size:15px;white-space:pre-line;line-height:1.8}

/* === MENU === */
.menu-categories{display:flex;gap:12px;padding:24px;overflow-x:auto}
.menu-chip{
flex-shrink:0;padding:14px 24px;
background:var(--bg-card);border-radius:30px;
font-size:14px;font-weight:600;cursor:pointer;
border:1px solid var(--border);white-space:nowrap;
transition:all 0.3s;color:var(--text);font-family:inherit
}
.menu-chip:hover{border-color:rgba(212,175,55,0.3)}
.menu-chip.active{
background:var(--gradient-gold);border-color:transparent;color:var(--bg);
box-shadow:var(--shadow-gold)
}

.menu-items{padding:0 24px 140px;display:grid;gap:16px}
.menu-item{
display:flex;gap:18px;padding:20px;
background:var(--bg-card);border-radius:24px;
border:1px solid var(--border);transition:all 0.3s
}
.menu-item:hover{border-color:rgba(212,175,55,0.2)}
.menu-item-image{
width:90px;height:90px;border-radius:20px;
display:flex;align-items:center;justify-content:center;
font-size:38px;flex-shrink:0;overflow:hidden
}
.menu-item-image img{
width:100%;height:100%;object-fit:cover
}
.menu-item-info{flex:1;display:flex;flex-direction:column;justify-content:center}
.menu-item-name{font-size:17px;font-weight:600;margin-bottom:6px}
.menu-item-volume{font-size:13px;color:var(--text-secondary);margin-bottom:10px}
.menu-item-price{font-size:18px;font-weight:700;color:var(--gold)}
.menu-item-add{
width:50px;height:50px;border-radius:16px;
background:var(--gradient-gold);color:var(--bg);
border:none;font-size:24px;cursor:pointer;
align-self:center;transition:all 0.3s;
box-shadow:0 4px 16px rgba(212,175,55,0.3)
}
.menu-item-add:hover{transform:scale(1.15);box-shadow:0 8px 24px rgba(212,175,55,0.4)}

/* === CART === */
.cart-fab{
position:fixed;bottom:28px;right:28px;
width:70px;height:70px;border-radius:22px;
background:var(--gradient-gold);color:var(--bg);
border:none;font-size:30px;cursor:pointer;
box-shadow:var(--shadow-gold);
display:none;align-items:center;justify-content:center;
transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
animation:glow 3s infinite
}
.cart-fab.show{display:flex}
.cart-fab:hover{transform:scale(1.1) rotate(5deg)}
.cart-badge{
position:absolute;top:-8px;right:-8px;
background:var(--danger);color:white;
width:28px;height:28px;border-radius:50%;
font-size:12px;font-weight:700;
display:flex;align-items:center;justify-content:center;
border:3px solid var(--bg)
}

.cart-items{padding:24px}
.cart-item{
display:flex;align-items:center;gap:18px;
padding:18px;background:var(--bg-card);
border-radius:20px;margin-bottom:14px;
border:1px solid var(--border)
}
.cart-item-info{flex:1}
.cart-item-name{font-weight:600;margin-bottom:6px;font-size:16px}
.cart-item-price{color:var(--text-secondary);font-size:14px}
.cart-item-controls{display:flex;align-items:center;gap:14px}
.cart-item-controls button{
width:40px;height:40px;border-radius:14px;
border:none;background:var(--gradient-gold);color:var(--bg);
font-size:20px;cursor:pointer;transition:transform 0.2s;font-weight:700
}
.cart-item-controls button:hover{transform:scale(1.15)}
.cart-item-controls span{font-weight:700;font-size:18px;min-width:28px;text-align:center}

.cart-total{padding:24px;border-top:1px solid var(--border)}
.cart-total-row{display:flex;justify-content:space-between;font-size:22px;font-weight:700;margin-bottom:24px}

/* === MODAL === */
.menu-image-modal{
position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(5,5,7,0.97);z-index:1000;
display:none;flex-direction:column;
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px)
}
.menu-image-modal.show{display:flex}
.menu-image-header{padding:24px;display:flex;justify-content:space-between;align-items:center;color:white}
.menu-image-close{
background:var(--bg-card);border:1px solid var(--border);
color:white;width:48px;height:48px;border-radius:16px;
font-size:24px;cursor:pointer;
display:flex;align-items:center;justify-content:center
}
.menu-image-nav{display:flex;gap:12px}
.menu-image-nav button{
background:var(--bg-card);border:1px solid var(--border);
color:var(--text);padding:14px 24px;border-radius:14px;
cursor:pointer;font-weight:600;transition:all 0.3s;font-family:inherit
}
.menu-image-nav button:hover{border-color:var(--gold)}
.menu-image-nav button.active{background:var(--gradient-gold);border-color:transparent;color:var(--bg);box-shadow:var(--shadow-gold)}
.menu-image-container{flex:1;overflow:auto;padding:20px}
.menu-image-container img{width:100%;border-radius:20px;box-shadow:var(--shadow-luxury)}

/* Item Modal */
.item-modal{
position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.8);z-index:1000;
display:none;align-items:flex-end;justify-content:center;
backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)
}
.item-modal.show{display:flex}
.item-modal-box{
background:var(--bg-card);
border-radius:28px 28px 0 0;
width:100%;max-width:500px;
max-height:85vh;overflow-y:auto;
padding:24px;position:relative;
border:1px solid var(--border);
border-bottom:none;
animation:slideUp 0.3s ease
}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.item-modal-close{
position:absolute;top:16px;right:16px;
background:var(--bg);border:1px solid var(--border);
color:var(--text);width:36px;height:36px;
border-radius:50%;font-size:18px;cursor:pointer;
display:flex;align-items:center;justify-content:center
}
.item-modal-header{text-align:center;margin-bottom:24px}
.item-modal-icon{
width:80px;height:80px;border-radius:20px;
margin:0 auto 16px;
display:flex;align-items:center;justify-content:center;
font-size:40px;overflow:hidden
}
.item-modal-icon img{
width:100%;height:100%;object-fit:cover
}
.item-modal-name{font-size:22px;font-weight:700}
.item-modal-section{margin-bottom:20px}
.item-modal-label{
font-size:12px;font-weight:700;color:var(--gold);
text-transform:uppercase;letter-spacing:1px;
margin-bottom:12px
}
.item-modal-options{display:flex;flex-wrap:wrap;gap:10px}
.item-modal-options.temp-options{flex-wrap:wrap}
.item-option{
flex:1;min-width:calc(50% - 5px);
padding:14px 12px;
background:var(--bg);border:1px solid var(--border);
border-radius:14px;color:var(--text);
font-size:14px;font-weight:600;cursor:pointer;
transition:all 0.2s;text-align:center;
font-family:inherit
}
.item-option span{display:block;font-size:12px;color:var(--text-secondary);margin-top:4px}
.item-option:hover{border-color:var(--gold)}
.item-option.selected{
border-color:var(--gold);
background:linear-gradient(135deg,rgba(212,175,55,0.15) 0%,transparent 100%);
box-shadow:0 0 20px rgba(212,175,55,0.2)
}
.item-modal-footer{
display:flex;gap:16px;align-items:center;
margin-top:24px;padding-top:20px;
border-top:1px solid var(--border)
}
.item-modal-total{font-size:24px;font-weight:700;color:var(--gold)}
.item-modal-footer .btn-primary{flex:1}

/* Снежинки для новогодней темы */
.snowflakes{
position:fixed;top:0;left:0;width:100%;height:100%;
pointer-events:none;z-index:9999;overflow:hidden;
display:none
}
[data-theme="newyear"] .snowflakes{display:block}
.snowflake{
position:absolute;top:-20px;
color:#fff;font-size:20px;
animation:snowfall linear infinite;
opacity:0.8;
text-shadow:0 0 5px rgba(255,255,255,0.5)
}
@keyframes snowfall{
0%{transform:translateY(0) rotate(0deg)}
100%{transform:translateY(100vh) rotate(360deg)}
}
.snowflake:nth-child(1){left:5%;animation-duration:8s;animation-delay:0s;font-size:16px}
.snowflake:nth-child(2){left:15%;animation-duration:12s;animation-delay:1s;font-size:24px}
.snowflake:nth-child(3){left:25%;animation-duration:10s;animation-delay:2s;font-size:18px}
.snowflake:nth-child(4){left:35%;animation-duration:14s;animation-delay:0.5s;font-size:22px}
.snowflake:nth-child(5){left:45%;animation-duration:9s;animation-delay:3s;font-size:14px}
.snowflake:nth-child(6){left:55%;animation-duration:11s;animation-delay:1.5s;font-size:20px}
.snowflake:nth-child(7){left:65%;animation-duration:13s;animation-delay:2.5s;font-size:26px}
.snowflake:nth-child(8){left:75%;animation-duration:10s;animation-delay:0.8s;font-size:16px}
.snowflake:nth-child(9){left:85%;animation-duration:15s;animation-delay:1.2s;font-size:18px}
.snowflake:nth-child(10){left:95%;animation-duration:8s;animation-delay:2.8s;font-size:22px}
.snowflake:nth-child(11){left:10%;animation-duration:11s;animation-delay:4s;font-size:12px}
.snowflake:nth-child(12){left:30%;animation-duration:9s;animation-delay:3.5s;font-size:20px}
.snowflake:nth-child(13){left:50%;animation-duration:13s;animation-delay:1.8s;font-size:24px}
.snowflake:nth-child(14){left:70%;animation-duration:10s;animation-delay:4.5s;font-size:14px}
.snowflake:nth-child(15){left:90%;animation-duration:12s;animation-delay:2.2s;font-size:18px}

/* Настройка звука */
.sound-toggle{
display:flex;align-items:center;justify-content:space-between;
padding:16px 20px;
background:var(--bg-card);
border-radius:16px;
margin:16px 0;
border:1px solid var(--border)
}
.sound-toggle-label{
display:flex;align-items:center;gap:12px;
color:var(--text);font-size:15px
}
.sound-toggle-switch{
width:52px;height:28px;
background:var(--bg-elevated);
border-radius:14px;
position:relative;
cursor:pointer;
transition:background 0.3s;
border:1px solid var(--border)
}
.sound-toggle-switch.active{background:var(--gold)}
.sound-toggle-switch::after{
content:'';
position:absolute;
width:22px;height:22px;
background:#fff;
border-radius:50%;
top:2px;left:2px;
transition:transform 0.3s;
box-shadow:0 2px 4px rgba(0,0,0,0.2)
}
.sound-toggle-switch.active::after{transform:translateX(24px)}
.sound-options{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
margin-top:12px
}
.sound-btn{
padding:10px 8px;
background:var(--bg-card);
border:2px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:12px;
cursor:pointer;
transition:all 0.2s
}
.sound-btn:active{transform:scale(0.95)}
.sound-btn.active{
border-color:var(--gold);
background:rgba(212,175,55,0.15)
}

/* Панель владельца */
.owner-panel{
background:var(--bg);
min-height:100vh
}
.owner-header{
background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
padding:20px;
border-bottom:1px solid var(--border)
}
.owner-header-top{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:16px
}
.owner-title{
font-size:20px;
font-weight:700;
color:var(--gold)
}
.owner-business-name{
font-size:14px;
color:var(--text-secondary);
margin-top:4px
}
.owner-period-select{
display:flex;
gap:8px
}
.owner-period-btn{
padding:8px 16px;
background:var(--bg-card);
border:1px solid var(--border);
border-radius:20px;
color:var(--text-secondary);
font-size:12px;
cursor:pointer;
transition:all 0.2s
}
.owner-period-btn.active{
background:var(--gold);
color:#000;
border-color:var(--gold)
}
.owner-stats-row{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:12px
}
.owner-stat-card{
background:var(--bg-card);
border-radius:12px;
padding:12px;
text-align:center;
border:1px solid var(--border)
}
.owner-stat-value{
font-size:24px;
font-weight:700;
color:var(--text)
}
.owner-stat-value.green{color:var(--success)}
.owner-stat-value.gold{color:var(--gold)}
.owner-stat-label{
font-size:10px;
color:var(--text-muted);
margin-top:4px
}
.owner-stat-change{
font-size:10px;
margin-top:4px
}
.owner-stat-change.up{color:var(--success)}
.owner-stat-change.down{color:var(--danger)}

.owner-tabs{
display:flex;
background:var(--bg-elevated);
padding:8px;
gap:4px;
border-bottom:1px solid var(--border)
}
.owner-tab{
flex:1;
padding:12px 8px;
background:transparent;
border:none;
border-radius:8px;
color:var(--text-secondary);
font-size:12px;
font-weight:600;
cursor:pointer;
transition:all 0.2s
}
.owner-tab.active{
background:var(--bg-card);
color:var(--gold)
}

.owner-content{
padding:16px
}
.owner-section{
background:var(--bg-card);
border-radius:16px;
padding:16px;
margin-bottom:16px;
border:1px solid var(--border)
}
.owner-section-title{
font-size:14px;
font-weight:600;
color:var(--text);
margin-bottom:12px;
display:flex;
align-items:center;
gap:8px
}
.owner-chart{
height:150px;
display:flex;
align-items:flex-end;
gap:4px;
padding:10px 0
}
.owner-chart-bar{
flex:1;
background:linear-gradient(180deg,var(--gold) 0%,rgba(212,175,55,0.3) 100%);
border-radius:4px 4px 0 0;
min-height:4px;
transition:height 0.3s;
position:relative
}
.owner-chart-bar:hover{
background:linear-gradient(180deg,var(--accent-pink) 0%,rgba(255,107,157,0.3) 100%)
}
.owner-chart-bar::after{
content:attr(data-value);
position:absolute;
top:-20px;
left:50%;
transform:translateX(-50%);
font-size:10px;
color:var(--text-secondary);
opacity:0;
transition:opacity 0.2s
}
.owner-chart-bar:hover::after{opacity:1}
.owner-chart-labels{
display:flex;
justify-content:space-between;
font-size:10px;
color:var(--text-muted);
margin-top:8px
}

.owner-order-item{
display:flex;
align-items:center;
padding:12px 0;
border-bottom:1px solid var(--border);
gap:12px
}
.owner-order-item:last-child{border-bottom:none}
.owner-order-status{
width:8px;
height:8px;
border-radius:50%;
flex-shrink:0
}
.owner-order-status.new{background:var(--gold)}
.owner-order-status.preparing{background:var(--accent)}
.owner-order-status.ready{background:var(--success)}
.owner-order-status.completed{background:var(--text-muted)}
.owner-order-info{flex:1}
.owner-order-id{
font-size:14px;
font-weight:600;
color:var(--text)
}
.owner-order-details{
font-size:12px;
color:var(--text-secondary);
margin-top:2px
}
.owner-order-time{
font-size:11px;
color:var(--text-muted)
}
.owner-order-sum{
font-size:14px;
font-weight:600;
color:var(--gold)
}
.owner-order-actions{
display:flex;
gap:8px
}
.owner-order-btn{
padding:6px 12px;
border-radius:8px;
font-size:11px;
font-weight:600;
cursor:pointer;
border:none;
transition:all 0.2s
}
.owner-order-btn.primary{
background:var(--gold);
color:#000
}
.owner-order-btn.secondary{
background:var(--bg-elevated);
color:var(--text);
border:1px solid var(--border)
}

.owner-menu-item{
display:flex;
align-items:center;
padding:12px;
background:var(--bg-elevated);
border-radius:12px;
margin-bottom:8px;
gap:12px
}
.owner-menu-img{
width:50px;
height:50px;
border-radius:10px;
object-fit:cover;
background:var(--bg-card)
}
.owner-menu-info{flex:1}
.owner-menu-name{
font-size:14px;
font-weight:500;
color:var(--text)
}
.owner-menu-stats{
font-size:11px;
color:var(--text-secondary);
margin-top:2px
}
.owner-menu-price{
font-size:14px;
font-weight:600;
color:var(--gold)
}
.owner-menu-toggle{
width:44px;
height:24px;
background:var(--bg-card);
border-radius:12px;
position:relative;
cursor:pointer;
border:1px solid var(--border)
}
.owner-menu-toggle.active{background:var(--success)}
.owner-menu-toggle::after{
content:'';
position:absolute;
width:18px;height:18px;
background:#fff;
border-radius:50%;
top:2px;left:2px;
transition:transform 0.2s
}
.owner-menu-toggle.active::after{transform:translateX(20px)}

.owner-top-list{
counter-reset:top
}
.owner-top-item{
display:flex;
align-items:center;
padding:10px 0;
border-bottom:1px solid var(--border);
gap:12px
}
.owner-top-item:last-child{border-bottom:none}
.owner-top-item::before{
counter-increment:top;
content:counter(top);
width:24px;
height:24px;
background:var(--bg-elevated);
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:12px;
font-weight:600;
color:var(--text-secondary)
}
.owner-top-item:nth-child(1)::before{background:var(--gold);color:#000}
.owner-top-item:nth-child(2)::before{background:#c0c0c0;color:#000}
.owner-top-item:nth-child(3)::before{background:#cd7f32;color:#fff}
.owner-top-name{flex:1;font-size:14px;color:var(--text)}
.owner-top-value{font-size:14px;font-weight:600;color:var(--gold)}

.owner-quick-actions{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:10px
}
.owner-quick-btn{
display:flex;
align-items:center;
justify-content:center;
gap:8px;
padding:14px;
background:var(--bg-elevated);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:13px;
font-weight:500;
cursor:pointer;
transition:all 0.2s
}
.owner-quick-btn:active{transform:scale(0.98)}
.owner-quick-btn.danger{border-color:var(--danger);color:var(--danger)}
.owner-quick-btn.success{border-color:var(--success);color:var(--success)}

.owner-notification{
display:flex;
align-items:center;
padding:12px;
background:var(--bg-elevated);
border-radius:10px;
margin-bottom:8px;
gap:10px
}
.owner-notification-icon{font-size:20px}
.owner-notification-text{flex:1}
.owner-notification-title{font-size:13px;font-weight:500;color:var(--text)}
.owner-notification-time{font-size:11px;color:var(--text-muted)}

.owner-empty{
text-align:center;
padding:40px 20px;
color:var(--text-muted)
}
.owner-empty-icon{font-size:48px;margin-bottom:12px}
.owner-empty-text{font-size:14px}

/* Расписание владельца */
.owner-date-picker{
display:flex;
align-items:center;
gap:12px;
justify-content:center
}
.owner-date-picker input{
flex:1;
max-width:200px;
padding:12px;
background:var(--bg-elevated);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:14px;
text-align:center
}
.owner-date-btn{
width:44px;height:44px;
background:var(--bg-elevated);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:18px;
cursor:pointer
}
.owner-master-select{
display:flex;
flex-wrap:wrap;
gap:8px
}
.owner-master-btn{
padding:10px 16px;
background:var(--bg-elevated);
border:1px solid var(--border);
border-radius:20px;
color:var(--text-secondary);
font-size:13px;
cursor:pointer;
transition:all 0.2s
}
.owner-master-btn.active{
background:var(--gold);
color:#000;
border-color:var(--gold)
}
.owner-slots-grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px
}
.owner-slot{
padding:12px 8px;
border-radius:10px;
text-align:center;
font-size:13px;
font-weight:500;
cursor:pointer;
transition:all 0.2s;
border:2px solid transparent
}
.owner-slot.free{
background:var(--bg-elevated);
color:var(--text);
border-color:var(--border)
}
.owner-slot.free:hover{
border-color:var(--gold)
}
.owner-slot.booked{
background:rgba(102,126,234,0.2);
color:var(--accent);
border-color:var(--accent)
}
.owner-slot.blocked{
background:rgba(255,71,87,0.2);
color:var(--danger);
border-color:var(--danger)
}
.owner-slot.selected{
border-color:var(--gold);
box-shadow:0 0 0 2px var(--gold-glow)
}
.owner-slots-legend{
display:flex;
justify-content:center;
gap:16px;
margin-top:12px;
font-size:11px;
color:var(--text-secondary)
}
.legend-item{
display:flex;
align-items:center;
gap:6px
}
.legend-dot{
width:10px;height:10px;
border-radius:50%
}
.legend-dot.free{background:var(--bg-elevated);border:1px solid var(--border)}
.legend-dot.booked{background:var(--accent)}
.legend-dot.blocked{background:var(--danger)}

.owner-booking-item{
display:flex;
align-items:center;
padding:12px;
background:var(--bg-elevated);
border-radius:12px;
margin-bottom:8px;
gap:12px
}
.owner-booking-time{
font-size:14px;
font-weight:600;
color:var(--gold);
min-width:50px
}
.owner-booking-info{flex:1}
.owner-booking-name{
font-size:14px;
color:var(--text)
}
.owner-booking-service{
font-size:12px;
color:var(--text-secondary)
}
.owner-booking-actions{
display:flex;
gap:8px
}

.owner-block-modal{
position:fixed;
top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.8);
display:flex;
align-items:center;
justify-content:center;
z-index:1000;
padding:20px;
opacity:0;
visibility:hidden;
transition:all 0.3s
}
.owner-block-modal.show{
opacity:1;
visibility:visible
}
.owner-block-content{
background:var(--bg-card);
border-radius:20px;
padding:24px;
max-width:400px;
width:100%
}
.owner-block-title{
font-size:18px;
font-weight:600;
margin-bottom:16px;
text-align:center
}
.owner-block-slots{
display:flex;
flex-wrap:wrap;
gap:8px;
margin-bottom:16px
}
.owner-block-slot{
padding:8px 12px;
background:var(--bg-elevated);
border-radius:8px;
font-size:13px;
color:var(--gold)
}
.owner-block-reason{
width:100%;
padding:12px;
background:var(--bg-elevated);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-size:14px;
margin-bottom:16px;
resize:none
}
.owner-block-actions{
display:flex;
gap:12px
}
.owner-block-actions button{
flex:1;
padding:14px;
border-radius:12px;
font-size:14px;
font-weight:600;
cursor:pointer;
border:none
}
.owner-block-actions .cancel{
background:var(--bg-elevated);
color:var(--text)
}
.owner-block-actions .confirm{
background:var(--danger);
color:#fff
}

/* Групповой заказ */
.group-order-banner{
background:linear-gradient(135deg,var(--gold) 0%,var(--accent-pink) 100%);
border-radius:16px;
padding:16px;
margin:16px;
display:flex;
align-items:center;
gap:12px;
cursor:pointer;
transition:transform 0.2s,box-shadow 0.2s
}
.group-order-banner:hover{transform:scale(1.02);box-shadow:0 8px 25px rgba(212,175,55,0.3)}
.group-order-banner-icon{font-size:28px}
.group-order-banner-text{flex:1}
.group-order-banner-title{font-weight:600;color:#000;font-size:15px}
.group-order-banner-desc{font-size:12px;color:rgba(0,0,0,0.6);margin-top:2px}
.group-order-banner-arrow{font-size:20px;color:rgba(0,0,0,0.4)}

.group-order-modal{
position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.8);
z-index:1000;
display:none;
align-items:center;
justify-content:center;
padding:20px
}
.group-order-modal.show{display:flex}
.group-order-box{
background:var(--bg-elevated);
border-radius:24px;
padding:24px;
width:100%;
max-width:400px;
max-height:80vh;
overflow-y:auto;
border:1px solid var(--border)
}
.group-order-header{
display:flex;
align-items:center;
justify-content:space-between;
margin-bottom:20px
}
.group-order-title{font-size:20px;font-weight:700;color:var(--text)}
.group-order-close{
background:none;border:none;
font-size:24px;color:var(--text-muted);
cursor:pointer
}
.group-order-section{margin-bottom:20px}
.group-order-label{
font-size:13px;
color:var(--text-secondary);
margin-bottom:8px;
display:block
}
.group-order-link{
background:var(--bg-card);
border:1px solid var(--border);
border-radius:12px;
padding:12px;
display:flex;
align-items:center;
gap:10px
}
.group-order-link input{
flex:1;
background:none;
border:none;
color:var(--text);
font-size:14px;
outline:none
}
.group-order-link button{
background:var(--gold);
border:none;
border-radius:8px;
padding:8px 16px;
color:#000;
font-weight:600;
font-size:13px;
cursor:pointer
}
.group-members{
background:var(--bg-card);
border-radius:12px;
padding:12px;
margin-top:12px
}
.group-member{
display:flex;
align-items:center;
gap:10px;
padding:8px 0;
border-bottom:1px solid var(--border)
}
.group-member:last-child{border-bottom:none}
.group-member-avatar{
width:32px;height:32px;
background:var(--bg-elevated);
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:14px
}
.group-member-info{flex:1}
.group-member-name{font-size:14px;font-weight:500;color:var(--text)}
.group-member-items{font-size:12px;color:var(--text-secondary)}
.group-member-sum{font-size:14px;font-weight:600;color:var(--gold)}
.group-member.owner .group-member-avatar{
background:var(--gold);
color:#000
}
.group-cart-items{margin-top:16px}
.group-cart-person{
background:var(--bg-card);
border-radius:12px;
padding:12px;
margin-bottom:12px
}
.group-cart-person-header{
display:flex;
align-items:center;
gap:8px;
margin-bottom:8px;
padding-bottom:8px;
border-bottom:1px solid var(--border)
}
.group-cart-person-name{font-weight:600;color:var(--text);flex:1}
.group-cart-person-total{color:var(--gold);font-weight:600}
.group-cart-item{
display:flex;
justify-content:space-between;
padding:4px 0;
font-size:13px;
color:var(--text-secondary)
}
.group-total-row{
display:flex;
justify-content:space-between;
padding:16px;
background:var(--bg-card);
border-radius:12px;
margin-top:16px
}
.group-total-label{font-size:16px;color:var(--text)}
.group-total-sum{font-size:20px;font-weight:700;color:var(--gold)}
.group-actions{
display:flex;
gap:12px;
margin-top:20px
}
.group-actions button{flex:1}
.btn-secondary{
background:var(--bg-card);
border:1px solid var(--border);
border-radius:12px;
padding:14px;
color:var(--text);
font-weight:600;
font-size:15px;
cursor:pointer
}

/* Кнопка добавления на экран */
.add-shortcut-btn{
display:flex;
align-items:center;
gap:12px;
width:100%;
padding:16px 20px;
background:linear-gradient(135deg,var(--gold) 0%,var(--accent-pink) 100%);
border:none;
border-radius:16px;
cursor:pointer;
transition:transform 0.2s,box-shadow 0.2s
}
.add-shortcut-btn:hover{transform:scale(1.02);box-shadow:0 8px 25px rgba(212,175,55,0.3)}
.add-shortcut-btn-icon{font-size:24px}
.add-shortcut-btn-text{flex:1;text-align:left}
.add-shortcut-btn-title{font-weight:600;color:#000;font-size:14px}
.add-shortcut-btn-desc{font-size:11px;color:rgba(0,0,0,0.6);margin-top:2px}
.add-shortcut-btn-arrow{font-size:18px;color:rgba(0,0,0,0.4)}

/* Модалка инструкции */
.shortcut-modal{
position:fixed;top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.85);
z-index:2000;
display:none;
align-items:center;
justify-content:center;
padding:20px
}
.shortcut-modal.show{display:flex}
.shortcut-box{
background:var(--bg-elevated);
border-radius:24px;
padding:24px;
width:100%;
max-width:360px;
max-height:85vh;
overflow-y:auto;
border:1px solid var(--border)
}
.shortcut-header{
text-align:center;
margin-bottom:20px
}
.shortcut-header-icon{font-size:48px;margin-bottom:12px}
.shortcut-header-title{font-size:20px;font-weight:700;color:var(--text)}
.shortcut-header-desc{font-size:13px;color:var(--text-secondary);margin-top:8px;line-height:1.5}
.shortcut-tabs{
display:flex;
gap:8px;
margin-bottom:20px
}
.shortcut-tab{
flex:1;
padding:12px;
background:var(--bg-card);
border:1px solid var(--border);
border-radius:12px;
font-size:13px;
font-weight:600;
color:var(--text-muted);
cursor:pointer;
transition:all 0.2s
}
.shortcut-tab.active{
background:var(--gold);
color:#000;
border-color:var(--gold)
}
.shortcut-steps{display:none}
.shortcut-steps.active{display:block}
.shortcut-step{
display:flex;
gap:14px;
padding:14px 0;
border-bottom:1px solid var(--border)
}
.shortcut-step:last-child{border-bottom:none}
.shortcut-step-num{
width:28px;height:28px;
background:var(--gold);
color:#000;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-weight:700;
font-size:14px;
flex-shrink:0
}
.shortcut-step-text{
font-size:14px;
color:var(--text);
line-height:1.5
}
.shortcut-step-text code{
background:var(--bg-card);
padding:2px 8px;
border-radius:6px;
font-family:monospace;
color:var(--gold)
}
.shortcut-close{
width:100%;
margin-top:20px;
padding:14px;
background:var(--bg-card);
border:1px solid var(--border);
border-radius:12px;
color:var(--text);
font-weight:600;
font-size:15px;
cursor:pointer
}

/* Мини-игра */
.game-banner{
background:linear-gradient(135deg,#ff6b9d 0%,#c44cff 50%,#00d4ff 100%);
border-radius:20px;
padding:16px 20px;
margin:16px;
display:flex;
align-items:center;
gap:14px;
cursor:pointer;
transition:transform 0.2s,box-shadow 0.2s;
position:relative;
overflow:hidden
}
.game-banner::before{
content:'';
position:absolute;
top:-50%;left:-50%;
width:200%;height:200%;
background:linear-gradient(45deg,transparent,rgba(255,255,255,0.1),transparent);
animation:game-shine 3s infinite
}
@keyframes game-shine{
0%{transform:translateX(-100%) rotate(45deg)}
100%{transform:translateX(100%) rotate(45deg)}
}
.game-banner:hover{transform:scale(1.02);box-shadow:0 8px 30px rgba(196,76,255,0.4)}
.game-banner-icon{font-size:32px;animation:game-bounce 2s infinite}
@keyframes game-bounce{
0%,100%{transform:scale(1)}
50%{transform:scale(1.2)}
}
.game-banner-text{flex:1}
.game-banner-title{font-weight:700;color:#fff;font-size:16px}
.game-banner-desc{font-size:12px;color:rgba(255,255,255,0.8);margin-top:2px}
.game-banner-score{
background:rgba(0,0,0,0.3);
padding:6px 12px;
border-radius:20px;
font-size:13px;
font-weight:600;
color:#fff
}

.game-container{
position:fixed;
top:0;left:0;right:0;bottom:0;
background:linear-gradient(180deg,#0a0a1a 0%,#1a0a2a 100%);
z-index:2000;
display:none;
flex-direction:column
}
.game-container.show{display:flex}
.game-header{
display:flex;
align-items:center;
justify-content:space-between;
padding:16px 20px;
background:rgba(0,0,0,0.3)
}
.game-back{
background:none;border:none;
font-size:24px;color:#fff;
cursor:pointer;padding:8px
}
.game-title{font-size:18px;font-weight:700;color:#fff}
.game-score-display{
font-size:16px;font-weight:600;
color:#ffdf00;
background:rgba(255,223,0,0.2);
padding:8px 16px;
border-radius:20px
}
.game-area{
flex:1;
position:relative;
overflow:hidden;
touch-action:manipulation
}
.bubble{
position:absolute;
border-radius:50%;
cursor:pointer;
transition:transform 0.1s;
display:flex;
align-items:center;
justify-content:center;
font-size:24px;
animation:bubble-float 0.5s ease-out;
box-shadow:0 4px 20px rgba(0,0,0,0.3),inset 0 -5px 20px rgba(0,0,0,0.2),inset 0 5px 20px rgba(255,255,255,0.3)
}
@keyframes bubble-float{
0%{transform:scale(0);opacity:0}
50%{transform:scale(1.2)}
100%{transform:scale(1);opacity:1}
}
.bubble:active{transform:scale(0.9)}
.bubble-pop{
animation:bubble-pop 0.3s ease-out forwards
}
@keyframes bubble-pop{
0%{transform:scale(1);opacity:1}
50%{transform:scale(1.5);opacity:0.5}
100%{transform:scale(0);opacity:0}
}
.game-stats{
display:flex;
justify-content:space-around;
padding:16px;
background:rgba(0,0,0,0.3)
}
.game-stat{text-align:center}
.game-stat-value{font-size:24px;font-weight:700;color:#fff}
.game-stat-label{font-size:11px;color:rgba(255,255,255,0.6);margin-top:2px}
.combo-display{
position:absolute;
top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:48px;
font-weight:900;
color:#ffdf00;
text-shadow:0 0 20px rgba(255,223,0,0.8);
opacity:0;
pointer-events:none;
z-index:10
}
.combo-display.show{
animation:combo-pop 0.6s ease-out
}
@keyframes combo-pop{
0%{opacity:0;transform:translate(-50%,-50%) scale(0.5)}
30%{opacity:1;transform:translate(-50%,-50%) scale(1.3)}
100%{opacity:0;transform:translate(-50%,-50%) scale(1) translateY(-30px)}
}
.game-over-modal{
position:absolute;
top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.9);
display:none;
align-items:center;
justify-content:center;
flex-direction:column;
padding:40px;
z-index:20
}
.game-over-modal.show{display:flex}
.game-over-title{font-size:32px;font-weight:900;color:#ff6b9d;margin-bottom:8px}
.game-over-score{font-size:48px;font-weight:900;color:#ffdf00;margin-bottom:8px}
.game-over-best{font-size:16px;color:rgba(255,255,255,0.6);margin-bottom:32px}
.game-over-btn{
background:linear-gradient(135deg,#ff6b9d,#c44cff);
border:none;
border-radius:16px;
padding:16px 48px;
font-size:18px;
font-weight:700;
color:#fff;
cursor:pointer;
margin-bottom:12px
}
.game-over-btn-secondary{
background:transparent;
border:2px solid rgba(255,255,255,0.3);
border-radius:16px;
padding:14px 40px;
font-size:16px;
font-weight:600;
color:#fff;
cursor:pointer
}

/* Список игр */
.games-grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px;
padding:0 16px;
margin-bottom:12px
}
.game-card{
background:var(--bg-card);
border-radius:12px;
padding:10px 6px;
text-align:center;
cursor:pointer;
border:1px solid var(--border);
transition:transform 0.2s
}
.game-card:active{transform:scale(0.95)}
.game-card-icon{font-size:22px;margin-bottom:4px}
.game-card-name{font-weight:600;color:var(--text);font-size:10px;margin-bottom:2px}
.game-card-desc{display:none}
.game-card-best{
font-size:9px;
color:var(--gold);
margin-top:4px;
font-weight:500
}

/* Tap Speed */
.tap-area{
flex:1;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:20px
}
.tap-button{
width:200px;height:200px;
border-radius:50%;
background:linear-gradient(135deg,#ff6b9d,#c44cff);
border:none;
font-size:48px;
cursor:pointer;
transition:transform 0.1s;
box-shadow:0 10px 40px rgba(196,76,255,0.4)
}
.tap-button:active{transform:scale(0.95)}
.tap-counter{
font-size:72px;
font-weight:900;
color:#fff;
text-shadow:0 0 30px rgba(255,255,255,0.5)
}
.tap-timer{
font-size:24px;
color:rgba(255,255,255,0.6)
}

/* Memory Numbers */
.memory-display{
flex:1;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:24px;
padding:20px
}
.memory-number{
font-size:64px;
font-weight:900;
color:#ffdf00;
text-shadow:0 0 30px rgba(255,223,0,0.5);
min-height:80px
}
.memory-input{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:12px;
max-width:280px
}
.memory-btn{
width:70px;height:70px;
border-radius:16px;
background:var(--bg-card);
border:2px solid var(--border);
font-size:28px;
font-weight:700;
color:#fff;
cursor:pointer;
transition:all 0.15s
}
.memory-btn:active{
background:var(--gold);
color:#000;
transform:scale(0.95)
}
.memory-user-input{
font-size:36px;
font-weight:700;
color:#fff;
min-height:50px;
letter-spacing:8px
}
.memory-level{
font-size:18px;
color:rgba(255,255,255,0.6)
}
.memory-status{
font-size:24px;
color:#fff;
font-weight:600
}

/* Color Match */
.color-display{
flex:1;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:30px
}
.color-word{
font-size:48px;
font-weight:900;
padding:30px 50px;
border-radius:24px;
background:rgba(0,0,0,0.3)
}
.color-buttons{
display:flex;
gap:16px
}
.color-btn{
width:100px;height:60px;
border-radius:16px;
border:none;
font-size:16px;
font-weight:700;
cursor:pointer;
transition:transform 0.1s
}
.color-btn:active{transform:scale(0.95)}
.color-btn.red{background:#ff4757;color:#fff}
.color-btn.blue{background:#3498db;color:#fff}
.color-btn.green{background:#2ed573;color:#fff}
.color-btn.yellow{background:#ffc107;color:#000}
.color-timer-bar{
width:80%;
height:8px;
background:rgba(255,255,255,0.2);
border-radius:4px;
overflow:hidden
}
.color-timer-fill{
height:100%;
background:linear-gradient(90deg,#ff6b9d,#c44cff);
transition:width 0.1s linear
}

/* Math Sprint */
.math-display{
flex:1;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
gap:20px;
padding:20px
}
.math-problem{
font-size:48px;
font-weight:900;
color:#fff;
text-shadow:0 0 20px rgba(255,255,255,0.3)
}
.math-answers{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
width:100%;
max-width:280px
}
.math-btn{
padding:20px;
border-radius:16px;
background:var(--bg-card);
border:2px solid var(--border);
font-size:24px;
font-weight:700;
color:#fff;
cursor:pointer;
transition:all 0.15s
}
.math-btn:active{transform:scale(0.95)}
.math-btn.correct{background:#2ed573;border-color:#2ed573}
.math-btn.wrong{background:#ff4757;border-color:#ff4757}
.math-streak{
font-size:16px;
color:rgba(255,255,255,0.6)
}
.math-timer-bar{
width:80%;
height:8px;
background:rgba(255,255,255,0.2);
border-radius:4px;
overflow:hidden
}
.math-timer-fill{
height:100%;
background:linear-gradient(90deg,#00d4ff,#c44cff);
transition:width 0.1s linear
}
</style>
</head>
<body>

<!-- Снежинки -->
<div class="snowflakes">
<div class="snowflake">❄</div>
<div class="snowflake">❅</div>
<div class="snowflake">❆</div>
<div class="snowflake">❄</div>
<div class="snowflake">❅</div>
<div class="snowflake">❆</div>
<div class="snowflake">❄</div>
<div class="snowflake">❅</div>
<div class="snowflake">❆</div>
<div class="snowflake">❄</div>
<div class="snowflake">❅</div>
<div class="snowflake">❆</div>
<div class="snowflake">❄</div>
<div class="snowflake">❅</div>
<div class="snowflake">❆</div>
</div>

<div id="page-register" class="page">
<div class="register-container">
<div class="register-icon">📱</div>
<div class="register-title" data-i18n="welcome">Добро пожаловать!</div>
<div class="register-text" data-i18n="register_desc">Поделитесь номером телефона для заказов и записей</div>
<button class="btn-primary" id="register-btn" onclick="requestPhoneNumber()"><span data-i18n="share_phone">📲 Поделиться номером</span></button>
<div style="margin-top:20px;font-size:13px;color:var(--text-secondary)" data-i18n="enter_manually">Номер будет получен из вашего Telegram</div>
</div>
</div>

<div id="page-home" class="page">
<div class="header"><h1>BookIt</h1><button class="header-profile" id="header-avatar-btn" onclick="openProfile()">👤</button></div>

<!-- Игры -->
<div class="games-grid">
<div class="game-card" onclick="startBubbleGame()">
<div class="game-card-icon">🫧</div>
<div class="game-card-name">Bubble</div>
<div class="game-card-best" id="best-bubble">🏆 0</div>
</div>
<div class="game-card" onclick="startTapGame()">
<div class="game-card-icon">👆</div>
<div class="game-card-name">Tap</div>
<div class="game-card-best" id="best-tap">🏆 0</div>
</div>
<div class="game-card" onclick="startMemoryGame()">
<div class="game-card-icon">🧠</div>
<div class="game-card-name">Memory</div>
<div class="game-card-best" id="best-memory">🏆 0</div>
</div>
<div class="game-card" onclick="startColorGame()">
<div class="game-card-icon">🌈</div>
<div class="game-card-name">Color</div>
<div class="game-card-best" id="best-color">🏆 0</div>
</div>
<div class="game-card" onclick="startMathGame()">
<div class="game-card-icon">🧮</div>
<div class="game-card-name">Math</div>
<div class="game-card-best" id="best-math">🏆 0</div>
</div>
</div>

<div class="businesses-grid" id="businesses-list"></div>
</div>

<div id="page-profile" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">←</button><h1 data-i18n="profile">Профиль</h1><div style="width:40px"></div></div>
<div class="profile-header">
<div class="profile-avatar" id="profile-avatar" onclick="document.getElementById('avatar-input').click()" style="cursor:pointer;overflow:hidden;position:relative">
<span id="avatar-content">👤</span>
<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.5);font-size:10px;padding:2px 0;color:white" data-i18n="change_avatar">изменить</div>
</div>
<input type="file" id="avatar-input" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
<div class="profile-name" id="profile-name">Имя</div>
<div class="profile-phone" id="profile-phone">+7</div>
</div>
<div class="profile-tabs">
<button class="profile-tab active" id="tab-bookings" onclick="switchTab('bookings')" data-i18n="tab_bookings">Записи</button>
<button class="profile-tab" id="tab-orders" onclick="switchTab('orders')" data-i18n="tab_orders">Заказы</button>
<button class="profile-tab" id="tab-reservations" onclick="switchTab('reservations')" data-i18n="tab_reservations">Брони</button>
</div>
<div class="profile-content" id="profile-content"></div>

<div class="theme-section">
<div class="theme-section-title">🎨 Тема оформления</div>
<div class="theme-options">
<button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">
<span class="theme-preview dark-preview"></span>
<span>Тёмная</span>
</button>
<button class="theme-btn" data-theme="light" onclick="setTheme('light')">
<span class="theme-preview light-preview"></span>
<span>Светлая</span>
</button>
<button class="theme-btn" data-theme="premium" onclick="setTheme('premium')">
<span class="theme-preview premium-preview"></span>
<span>Премиум</span>
</button>
<button class="theme-btn" data-theme="purple" onclick="setTheme('purple')">
<span class="theme-preview purple-preview"></span>
<span>Фиолет</span>
</button>
<button class="theme-btn" data-theme="ocean" onclick="setTheme('ocean')">
<span class="theme-preview ocean-preview"></span>
<span>Океан</span>
</button>
<button class="theme-btn" data-theme="sunset" onclick="setTheme('sunset')">
<span class="theme-preview sunset-preview"></span>
<span>Закат</span>
</button>
<button class="theme-btn" data-theme="tatarstan" onclick="setTheme('tatarstan')">
<span class="theme-preview tatarstan-preview"></span>
<span>Татарстан</span>
</button>
<button class="theme-btn" data-theme="newyear" onclick="setTheme('newyear')">
<span class="theme-preview newyear-preview"></span>
<span>🎄 Новый год</span>
</button>
</div>
</div>

<div class="theme-section">
<div class="theme-section-title" data-i18n="settings_language">🌍 Язык</div>
<div class="theme-options lang-options">
<button class="theme-btn lang-btn" data-lang="ru" onclick="setLanguage('ru')">
<span class="lang-flag">🇷🇺</span>
<span>Русский</span>
</button>
<button class="theme-btn lang-btn" data-lang="en" onclick="setLanguage('en')">
<span class="lang-flag">🇬🇧</span>
<span>English</span>
</button>
<button class="theme-btn lang-btn" data-lang="tt" onclick="setLanguage('tt')">
<span class="lang-flag">🏳️</span>
<span>Татарча</span>
</button>
</div>
</div>

<div class="theme-section">
<div class="theme-section-title" data-i18n="settings_sound">🔊 Звуки</div>
<div class="sound-toggle" onclick="toggleSound()">
<div class="sound-toggle-label">
<span>🎵</span>
<span data-i18n="sound_effects">Звук при добавлении</span>
</div>
<div class="sound-toggle-switch" id="sound-switch"></div>
</div>
<div class="sound-options" id="sound-options">
<button class="sound-btn" data-sound="pluck" onclick="selectSound('pluck')">🎵 Плюк</button>
<button class="sound-btn" data-sound="pop" onclick="selectSound('pop')">🫧 Поп</button>
<button class="sound-btn" data-sound="coin" onclick="selectSound('coin')">🪙 Монета</button>
<button class="sound-btn" data-sound="ding" onclick="selectSound('ding')">🔔 Динь</button>
<button class="sound-btn" data-sound="whoosh" onclick="selectSound('whoosh')">💨 Вжух</button>
<button class="sound-btn" data-sound="blip" onclick="selectSound('blip')">👾 Блип</button>
</div>
</div>
</div>

<div id="page-cafe" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">←</button><h1>Pink Purple</h1><button class="header-menu-btn" onclick="showMenuImages()">📋 Меню</button></div>

<!-- Кнопка панели владельца (только для владельцев) -->
<div id="owner-panel-btn" class="group-order-banner" onclick="openOwnerPanel()" style="display:none;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%)">
<div class="group-order-banner-icon">📊</div>
<div class="group-order-banner-text">
<div class="group-order-banner-title">Панель управления</div>
<div class="group-order-banner-desc">Заказы, аналитика, меню</div>
</div>
<div class="group-order-banner-arrow">→</div>
</div>

<!-- Баннер группового заказа -->
<div class="group-order-banner" onclick="openGroupOrderModal()">
<div class="group-order-banner-icon">👥</div>
<div class="group-order-banner-text">
<div class="group-order-banner-title">Групповой заказ</div>
<div class="group-order-banner-desc">Собери заказ с друзьями</div>
</div>
<div class="group-order-banner-arrow">→</div>
</div>

<div class="menu-categories" id="menu-categories"></div>
<div class="menu-items" id="menu-items"></div>
<button class="cart-fab" id="cart-fab" onclick="showPage('page-cart')">🛒<span class="cart-badge" id="cart-badge">0</span></button>
</div>

<div id="page-cart" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-cafe')">←</button><h1 data-i18n="cart">Корзина</h1><div style="width:40px"></div></div>
<div class="cart-items" id="cart-items"></div>
<div class="section-title" data-i18n="pickup_time">К какому времени приготовить?</div>
<div class="pickup-time-selector">
<select id="pickup-time" class="input-field" style="margin:0 16px 16px;width:calc(100% - 32px)"></select>
</div>
<div class="cart-total">
<div class="cart-total-row"><span data-i18n="total">Итого</span><span id="cart-total">0₽</span></div>
<button class="btn-primary" onclick="submitOrder()" data-i18n="checkout">Оформить заказ</button>
</div>
</div>

<div id="page-barber" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">←</button><h1>PORTOS</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите мастера</div>
<div class="masters-list" id="masters-list"></div>
<div class="section-title">Выберите услугу</div>
<div class="services-list" id="barber-services"></div>
<div class="bottom-btn"><button id="barber-next-btn" onclick="goToBarberDateTime()" disabled>Выбрать время</button></div>
</div>

<div id="page-barber-datetime" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-barber')">←</button><h1>Дата и время</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите дату</div>
<div class="dates-list" id="barber-dates"></div>
<div class="section-title">Выберите время</div>
<div class="times-list" id="barber-times"></div>
<div class="bottom-btn"><button id="barber-book-btn" onclick="submitBarberBooking()" disabled>Записаться</button></div>
</div>

<div id="page-clinic-branches" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">←</button><h1>Здоровье семьи</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите филиал</div>
<div class="branch-list" id="branch-list"></div>
</div>

<div id="page-clinic-categories" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-branches')">←</button><h1 id="clinic-branch-title">Филиал</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите направление</div>
<div class="category-list" id="category-list"></div>
</div>

<div id="page-clinic-doctor" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-categories')">←</button><h1 id="clinic-category-title">Направление</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите услугу</div>
<div class="services-list" id="clinic-services"></div>
<div class="section-title">Выберите врача</div>
<div class="doctors-list" id="doctors-list"></div>
<div class="bottom-btn"><button id="clinic-next-btn" onclick="goToClinicDateTime()" disabled>Выбрать время</button></div>
</div>

<div id="page-clinic-datetime" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-clinic-doctor')">←</button><h1>Дата и время</h1><div style="width:40px"></div></div>
<div class="section-title">Выберите дату</div>
<div class="dates-list" id="clinic-dates"></div>
<div class="section-title">Выберите время</div>
<div id="clinic-times-container"><div class="times-list" id="clinic-times"></div></div>
<div class="bottom-btn"><button id="clinic-book-btn" onclick="submitClinicBooking()" disabled>Записаться</button></div>
</div>

<!-- ЧЕРНОВАР: Бронирование столика -->
<div id="page-chernovar" class="page">
<div class="header"><button class="header-back" onclick="showPage('page-home')">←</button><h1>Черновар</h1><div style="width:40px"></div></div>
<div style="padding:32px 24px;text-align:center;background:linear-gradient(180deg,var(--bg-card) 0%,var(--bg) 100%);border-bottom:1px solid var(--border)">
<div style="font-size:48px;margin-bottom:16px;filter:drop-shadow(0 0 20px rgba(245,158,11,0.4))">🍺</div>
<div style="font-size:15px;color:var(--text-secondary);margin-bottom:6px">📍 Профсоюзная 23/12, Казань</div>
<div style="font-size:13px;color:var(--hint)">Вс-Чт: 11:00-00:00 • Пт-Сб: 11:00-01:00</div>
</div>
<div class="section-title">Бронирование столика</div>
<div style="padding:0 20px">
<div class="input-group">
<label class="input-label">На какое имя?</label>
<input type="text" id="chernovar-name" class="input-field" placeholder="Введите имя" oninput="checkChernovarForm()">
</div>
<div class="input-group">
<label class="input-label">Количество гостей</label>
<select id="chernovar-guests" class="input-field" onchange="checkChernovarForm()">
<option value="">Выберите</option>
<option value="1">1 гость</option>
<option value="2">2 гостя</option>
<option value="3">3 гостя</option>
<option value="4">4 гостя</option>
<option value="5">5 гостей</option>
<option value="6">6 гостей</option>
<option value="7">7 гостей</option>
<option value="8">8 гостей</option>
<option value="9">9 гостей</option>
<option value="10+">10+ гостей</option>
</select>
</div>
<div class="input-group">
<label class="input-label">Дата</label>
<select id="chernovar-date" class="input-field" onchange="generateChernovarTimes();checkChernovarForm()"></select>
</div>
<div class="input-group">
<label class="input-label">Время</label>
<select id="chernovar-time" class="input-field" onchange="checkChernovarForm()"></select>
</div>
<div class="input-group">
<label class="input-label">Комментарий (необязательно)</label>
<input type="text" id="chernovar-comment" class="input-field" placeholder="Особые пожелания">
</div>
</div>
<div class="bottom-btn"><button id="chernovar-book-btn" onclick="submitChernovarBooking()" disabled>Забронировать</button></div>
</div>

<div id="page-success" class="page">
<div class="success-container">
<div class="success-icon" id="success-icon">✅</div>
<div class="success-title" id="success-title">Готово!</div>
<div class="success-text" id="success-text"></div>
<div class="success-details" id="success-details"></div>
<br><br>
<button class="btn-primary" onclick="showPage('page-home')">На главную</button>
</div>
</div>

<!-- Панель владельца -->
<div id="page-owner" class="page owner-panel">
<div class="owner-header">
<div class="owner-header-top">
<div>
<div class="owner-title">📊 Панель управления</div>
<div class="owner-business-name" id="owner-business-name">Pink Purple</div>
</div>
<button class="header-back" onclick="showPage('page-home')" style="background:var(--bg-card);border-radius:50%;width:40px;height:40px;border:1px solid var(--border)">←</button>
</div>
<div class="owner-period-select">
<button class="owner-period-btn active" onclick="setOwnerPeriod('today')">Сегодня</button>
<button class="owner-period-btn" onclick="setOwnerPeriod('week')">Неделя</button>
<button class="owner-period-btn" onclick="setOwnerPeriod('month')">Месяц</button>
<button class="owner-period-btn" onclick="setOwnerPeriod('year')">Год</button>
</div>
<div class="owner-stats-row" style="margin-top:16px">
<div class="owner-stat-card">
<div class="owner-stat-value" id="owner-orders-count">0</div>
<div class="owner-stat-label">Заказов</div>
<div class="owner-stat-change up" id="owner-orders-change">+0%</div>
</div>
<div class="owner-stat-card">
<div class="owner-stat-value gold" id="owner-revenue">0₽</div>
<div class="owner-stat-label">Выручка</div>
<div class="owner-stat-change up" id="owner-revenue-change">+0%</div>
</div>
<div class="owner-stat-card">
<div class="owner-stat-value" id="owner-avg-check">0₽</div>
<div class="owner-stat-label">Ср. чек</div>
<div class="owner-stat-change" id="owner-avg-change">+0%</div>
</div>
<div class="owner-stat-card">
<div class="owner-stat-value green" id="owner-clients">0</div>
<div class="owner-stat-label">Клиентов</div>
<div class="owner-stat-change up" id="owner-clients-change">+0</div>
</div>
</div>
</div>

<div class="owner-tabs">
<button class="owner-tab active" onclick="setOwnerTab('orders')">🧾 Заказы</button>
<button class="owner-tab" onclick="setOwnerTab('schedule')">📅 Расписание</button>
<button class="owner-tab" onclick="setOwnerTab('analytics')">📈 Аналитика</button>
<button class="owner-tab" onclick="setOwnerTab('menu')">📋 Меню</button>
<button class="owner-tab" onclick="setOwnerTab('settings')">⚙️</button>
</div>

<div class="owner-content">
<!-- Вкладка Заказы -->
<div id="owner-tab-orders" class="owner-tab-content">
<div class="owner-section">
<div class="owner-section-title">🔴 Новые заказы</div>
<div id="owner-new-orders"></div>
</div>
<div class="owner-section">
<div class="owner-section-title">🟡 В работе</div>
<div id="owner-preparing-orders"></div>
</div>
<div class="owner-section">
<div class="owner-section-title">🟢 Готовы к выдаче</div>
<div id="owner-ready-orders"></div>
</div>
</div>

<!-- Вкладка Расписание -->
<div id="owner-tab-schedule" class="owner-tab-content" style="display:none">
<div class="owner-section">
<div class="owner-section-title">📅 Выберите дату</div>
<div class="owner-date-picker">
<button class="owner-date-btn" onclick="ownerPrevDay()">←</button>
<input type="date" id="owner-schedule-date" onchange="loadOwnerSchedule()">
<button class="owner-date-btn" onclick="ownerNextDay()">→</button>
</div>
</div>

<div class="owner-section">
<div class="owner-section-title">👤 Выберите мастера/врача</div>
<div class="owner-master-select" id="owner-master-select"></div>
</div>

<div class="owner-section">
<div class="owner-section-title">🕐 Слоты на <span id="owner-schedule-date-label">сегодня</span></div>
<div class="owner-slots-grid" id="owner-slots-grid"></div>
<div class="owner-slots-legend">
<span class="legend-item"><span class="legend-dot free"></span> Свободно</span>
<span class="legend-item"><span class="legend-dot booked"></span> Занято</span>
<span class="legend-item"><span class="legend-dot blocked"></span> Заблокировано</span>
</div>
</div>

<div class="owner-section">
<div class="owner-section-title">📋 Записи на этот день</div>
<div id="owner-day-bookings"></div>
</div>
</div>

<!-- Вкладка Аналитика -->
<div id="owner-tab-analytics" class="owner-tab-content" style="display:none">
<div class="owner-section">
<div class="owner-section-title">📊 Выручка по дням</div>
<div class="owner-chart" id="owner-revenue-chart"></div>
<div class="owner-chart-labels">
<span>Пн</span><span>Вт</span><span>Ср</span><span>Чт</span><span>Пт</span><span>Сб</span><span>Вс</span>
</div>
</div>
<div class="owner-section">
<div class="owner-section-title">🏆 Топ товаров</div>
<div class="owner-top-list" id="owner-top-items"></div>
</div>
<div class="owner-section">
<div class="owner-section-title">⏰ Пиковые часы</div>
<div class="owner-chart" id="owner-hours-chart"></div>
<div class="owner-chart-labels">
<span>9</span><span>11</span><span>13</span><span>15</span><span>17</span><span>19</span><span>21</span>
</div>
</div>
<div class="owner-section">
<div class="owner-section-title">👥 Топ клиентов</div>
<div class="owner-top-list" id="owner-top-clients"></div>
</div>
</div>

<!-- Вкладка Меню -->
<div id="owner-tab-menu" class="owner-tab-content" style="display:none">
<div class="owner-section">
<div class="owner-section-title">📋 Управление меню</div>
<div id="owner-menu-list"></div>
</div>
<div class="owner-section">
<div class="owner-section-title">🚫 Стоп-лист</div>
<div id="owner-stop-list">
<div class="owner-empty">
<div class="owner-empty-icon">✅</div>
<div class="owner-empty-text">Всё в наличии</div>
</div>
</div>
</div>
</div>

<!-- Вкладка Настройки -->
<div id="owner-tab-settings" class="owner-tab-content" style="display:none">
<div class="owner-section">
<div class="owner-section-title">⚡ Быстрые действия</div>
<div class="owner-quick-actions">
<button class="owner-quick-btn" onclick="ownerToggleOpen()">
<span id="owner-open-icon">🟢</span>
<span id="owner-open-text">Открыто</span>
</button>
<button class="owner-quick-btn" onclick="ownerExportData()">
📥 Экспорт
</button>
<button class="owner-quick-btn" onclick="ownerSendPush()">
📢 Рассылка
</button>
<button class="owner-quick-btn danger" onclick="ownerClearStopList()">
🗑️ Очистить стоп
</button>
</div>
</div>
<div class="owner-section">
<div class="owner-section-title">🔔 Последние события</div>
<div id="owner-notifications">
<div class="owner-notification">
<div class="owner-notification-icon">🛒</div>
<div class="owner-notification-text">
<div class="owner-notification-title">Новый заказ #ORD00123</div>
<div class="owner-notification-time">2 мин назад</div>
</div>
</div>
<div class="owner-notification">
<div class="owner-notification-icon">⭐</div>
<div class="owner-notification-text">
<div class="owner-notification-title">Новый отзыв: 5 звёзд</div>
<div class="owner-notification-time">15 мин назад</div>
</div>
</div>
<div class="owner-notification">
<div class="owner-notification-icon">👤</div>
<div class="owner-notification-text">
<div class="owner-notification-title">Новый клиент зарегистрировался</div>
<div class="owner-notification-time">1 час назад</div>
</div>
</div>
</div>
</div>
<div class="owner-section">
<div class="owner-section-title">⚙️ Настройки заведения</div>
<div class="owner-quick-actions">
<button class="owner-quick-btn" onclick="ownerEditInfo()">
✏️ Редактировать
</button>
<button class="owner-quick-btn" onclick="ownerEditHours()">
🕐 Время работы
</button>
<button class="owner-quick-btn" onclick="ownerEditContacts()">
📞 Контакты
</button>
<button class="owner-quick-btn success" onclick="ownerViewStats()">
📊 Полный отчёт
</button>
</div>
</div>
</div>
</div>
</div>

<!-- Модалка блокировки слотов -->
<div id="owner-block-modal" class="owner-block-modal">
<div class="owner-block-content">
<div class="owner-block-title">🚫 Заблокировать слоты</div>
<div class="owner-block-slots" id="owner-block-slots"></div>
<textarea class="owner-block-reason" id="owner-block-reason" placeholder="Причина (необязательно)" rows="2"></textarea>
<div class="owner-block-actions">
<button class="cancel" onclick="closeBlockModal()">Отмена</button>
<button class="confirm" onclick="confirmBlockSlots()">Заблокировать</button>
</div>
</div>
</div>

<!-- Модалка с картинками меню -->
<div id="menu-image-modal" class="menu-image-modal">
<div class="menu-image-header">
<button class="menu-image-close" onclick="hideMenuImages()">✕</button>
<div class="menu-image-nav">
<button id="menu-img-btn-1" class="active" onclick="showMenuPage(1)">Стр. 1</button>
<button id="menu-img-btn-2" onclick="showMenuPage(2)">Стр. 2</button>
</div>
</div>
<div class="menu-image-container">
<img id="menu-full-image" src="" alt="Меню Pink Purple">
</div>
</div>

<!-- Модалка выбора опций товара -->
<div id="item-modal" class="item-modal" onclick="if(event.target===this)closeItemModal()">
<div class="item-modal-box">
<button class="item-modal-close" onclick="closeItemModal()">✕</button>
<div id="item-modal-content"></div>
</div>
</div>

<!-- Модалка группового заказа -->
<div id="group-order-modal" class="group-order-modal" onclick="if(event.target===this)closeGroupOrderModal()">
<div class="group-order-box">
<div class="group-order-header">
<div class="group-order-title">👥 Групповой заказ</div>
<button class="group-order-close" onclick="closeGroupOrderModal()">✕</button>
</div>
<div id="group-order-content"></div>
</div>
</div>

<!-- Игра Bubble Pop -->
<div id="game-container" class="game-container">
<div class="game-header">
<button class="game-back" onclick="exitGame()">←</button>
<div class="game-title">🫧 Bubble Pop</div>
<div class="game-score-display">🏆 <span id="game-score">0</span></div>
</div>
<div class="game-area" id="game-area">
<div class="combo-display" id="combo-display">COMBO!</div>
</div>
<div class="game-stats">
<div class="game-stat">
<div class="game-stat-value" id="stat-popped">0</div>
<div class="game-stat-label">Лопнуто</div>
</div>
<div class="game-stat">
<div class="game-stat-value" id="stat-combo">0</div>
<div class="game-stat-label">Комбо</div>
</div>
<div class="game-stat">
<div class="game-stat-value" id="stat-missed">0</div>
<div class="game-stat-label">Пропущено</div>
</div>
</div>
<div class="game-over-modal" id="game-over">
<div class="game-over-title">Игра окончена!</div>
<div class="game-over-score" id="final-score">0</div>
<div class="game-over-best" id="final-best">Лучший: 0</div>
<button class="game-over-btn" onclick="restartGame()">🔄 Ещё раз</button>
<button class="game-over-btn-secondary" onclick="exitGame()">Выйти</button>
</div>
</div>

<!-- Игра Tap Speed -->
<div id="tap-container" class="game-container">
<div class="game-header">
<button class="game-back" onclick="exitTapGame()">←</button>
<div class="game-title">👆 Tap Speed</div>
<div class="game-score-display">⏱️ <span id="tap-time">10</span>с</div>
</div>
<div class="tap-area" id="tap-area">
<div class="tap-timer" id="tap-status">Нажми чтобы начать!</div>
<button class="tap-button" id="tap-button" onclick="handleTap()">👆</button>
<div class="tap-counter" id="tap-counter">0</div>
</div>
<div class="game-over-modal" id="tap-over">
<div class="game-over-title">Время вышло!</div>
<div class="game-over-score" id="tap-final">0</div>
<div class="game-over-best" id="tap-best">Лучший: 0</div>
<button class="game-over-btn" onclick="restartTapGame()">🔄 Ещё раз</button>
<button class="game-over-btn-secondary" onclick="exitTapGame()">Выйти</button>
</div>
</div>

<!-- Игра Memory -->
<div id="memory-container" class="game-container">
<div class="game-header">
<button class="game-back" onclick="exitMemoryGame()">←</button>
<div class="game-title">🧠 Memory</div>
<div class="game-score-display">Уровень <span id="memory-level">1</span></div>
</div>
<div class="memory-display" id="memory-display">
<div class="memory-status" id="memory-status">Запомни числа!</div>
<div class="memory-number" id="memory-number"></div>
<div class="memory-user-input" id="memory-user-input"></div>
<div class="memory-input" id="memory-input" style="display:none">
<button class="memory-btn" onclick="memoryPress(1)">1</button>
<button class="memory-btn" onclick="memoryPress(2)">2</button>
<button class="memory-btn" onclick="memoryPress(3)">3</button>
<button class="memory-btn" onclick="memoryPress(4)">4</button>
<button class="memory-btn" onclick="memoryPress(5)">5</button>
<button class="memory-btn" onclick="memoryPress(6)">6</button>
<button class="memory-btn" onclick="memoryPress(7)">7</button>
<button class="memory-btn" onclick="memoryPress(8)">8</button>
<button class="memory-btn" onclick="memoryPress(9)">9</button>
</div>
</div>
<div class="game-over-modal" id="memory-over">
<div class="game-over-title">Ошибка!</div>
<div class="game-over-score" id="memory-final">Уровень 0</div>
<div class="game-over-best" id="memory-best">Лучший: 0</div>
<button class="game-over-btn" onclick="restartMemoryGame()">🔄 Ещё раз</button>
<button class="game-over-btn-secondary" onclick="exitMemoryGame()">Выйти</button>
</div>
</div>

<!-- Игра Color Match -->
<div id="color-container" class="game-container">
<div class="game-header">
<button class="game-back" onclick="exitColorGame()">←</button>
<div class="game-title">🌈 Color Match</div>
<div class="game-score-display">🏆 <span id="color-score">0</span></div>
</div>
<div class="color-display">
<div class="color-timer-bar"><div class="color-timer-fill" id="color-timer-fill"></div></div>
<div class="color-word" id="color-word">КРАСНЫЙ</div>
<div style="color:rgba(255,255,255,0.6);font-size:14px">Цвет текста = слово?</div>
<div class="color-buttons">
<button class="color-btn green" onclick="colorAnswer(true)">✓ Да</button>
<button class="color-btn red" onclick="colorAnswer(false)">✗ Нет</button>
</div>
</div>
<div class="game-over-modal" id="color-over">
<div class="game-over-title">Игра окончена!</div>
<div class="game-over-score" id="color-final">0</div>
<div class="game-over-best" id="color-best">Лучший: 0</div>
<button class="game-over-btn" onclick="restartColorGame()">🔄 Ещё раз</button>
<button class="game-over-btn-secondary" onclick="exitColorGame()">Выйти</button>
</div>
</div>

<!-- Игра Math Sprint -->
<div id="math-container" class="game-container">
<div class="game-header">
<button class="game-back" onclick="exitMathGame()">←</button>
<div class="game-title">🧮 Math Sprint</div>
<div class="game-score-display">🏆 <span id="math-score">0</span></div>
</div>
<div class="math-display">
<div class="math-timer-bar"><div class="math-timer-fill" id="math-timer-fill"></div></div>
<div class="math-streak" id="math-streak">Серия: 0</div>
<div class="math-problem" id="math-problem">2 + 2</div>
<div class="math-answers" id="math-answers"></div>
</div>
<div class="game-over-modal" id="math-over">
<div class="game-over-title">Время вышло!</div>
<div class="game-over-score" id="math-final">0</div>
<div class="game-over-best" id="math-best">Лучший: 0</div>
<button class="game-over-btn" onclick="restartMathGame()">🔄 Ещё раз</button>
<button class="game-over-btn-secondary" onclick="exitMathGame()">Выйти</button>
</div>
</div>

<script>
const tg=window.Telegram.WebApp;tg.ready();tg.expand();

// Загружаем сохранённую тему и язык сразу
(function(){
const t=localStorage.getItem('app_theme');if(t)document.documentElement.setAttribute('data-theme',t);
const l=localStorage.getItem('app_lang')||'ru';document.documentElement.setAttribute('data-lang',l);
})();

// === ЛОКАЛИЗАЦИЯ ===
const i18n = {
ru: {
// Общее
app_name: 'BookIt',
profile: 'Профиль',
back: '←',
close: '✕',
cancel: 'Отмена',
save: 'Сохранить',
add: 'Добавить',
// Регистрация
welcome: 'Добро пожаловать!',
register_desc: 'Для начала работы поделитесь номером телефона',
share_phone: '📱 Поделиться номером',
enter_manually: 'Ввести вручную',
enter_phone: 'Введите номер телефона',
phone_placeholder: '+7 999 123-45-67',
continue_btn: 'Продолжить',
// Профиль
change_avatar: 'изменить',
tab_bookings: 'Записи',
tab_orders: 'Заказы',
tab_reservations: 'Брони',
no_bookings: 'Нет записей',
no_orders: 'Нет заказов',
no_reservations: 'Нет броней',
// Настройки
settings_theme: '🎨 Тема оформления',
settings_language: '🌍 Язык',
theme_dark: 'Тёмная',
theme_light: 'Светлая',
theme_premium: 'Премиум',
theme_purple: 'Фиолет',
theme_ocean: 'Океан',
theme_sunset: 'Закат',
theme_tatarstan: 'Татарстан',
theme_newyear: '🎄 Новый год',
// Звуки
settings_sound: '🔊 Звуки',
sound_effects: 'Звук при добавлении',
// Кафе
menu_btn: '📋 Меню',
cart: 'Корзина',
cart_empty: 'Корзина пуста',
checkout: 'Оформить заказ',
total: 'Итого',
pickup_time: 'К какому времени приготовить?',
pickup_asap: 'Как можно скорее',
order_success: 'Заказ оформлен!',
order_sum: 'Сумма',
order_time: 'К времени',
// Опции товара
select_size: 'Размер',
select_temp: 'Температура',
select_juiceball: 'Джусбол (бесплатно)',
temp_ice: '🧊 Со льдом',
temp_cold: '❄️ Холодный без льда',
temp_room: '🌡️ Комнатная',
temp_warm: '☕ Тёплый',
no_juiceball: 'Без джусбола',
// Бронирование
select_date: 'Выберите дату',
select_time: 'Выберите время',
select_guests: 'Количество гостей',
guests: 'гостей',
book_table: 'Забронировать',
booking_success: 'Столик забронирован!',
// Запись
select_service: 'Выберите услугу',
select_master: 'Выберите мастера',
any_master: 'Любой мастер',
book_service: 'Записаться',
booking_created: 'Вы записаны!',
// Статусы
status_active: 'Активна',
status_cancelled: 'Отменена',
status_completed: 'Завершена',
cancel_booking: 'Отменить',
cancel_order: 'Отменить',
// Категории меню
cat_top: '🔥 Наш топ',
cat_freeze: '🧊 Фризы',
cat_milkshake: '🥤 Милкшейки',
cat_sparkly: '✨ Спарклы',
cat_bloom: '🌸 Блумы',
cat_smoothie: '🥤 Смузи',
cat_milky: '🥛 Милки',
cat_coffee: '☕ Кофе',
cat_waffles: '🧇 Вафли',
cat_extra: '➕ Допы',
// Бизнесы
business_cafe: 'Кафе',
business_barbershop: 'Барбершоп',
business_clinic: 'Клиника',
business_restaurant: 'Ресторан'
},
en: {
app_name: 'BookIt',
profile: 'Profile',
back: '←',
close: '✕',
cancel: 'Cancel',
save: 'Save',
add: 'Add',
welcome: 'Welcome!',
register_desc: 'Share your phone number to get started',
share_phone: '📱 Share Phone Number',
enter_manually: 'Enter manually',
enter_phone: 'Enter phone number',
phone_placeholder: '+1 234 567-8900',
continue_btn: 'Continue',
change_avatar: 'change',
tab_bookings: 'Bookings',
tab_orders: 'Orders',
tab_reservations: 'Reservations',
no_bookings: 'No bookings',
no_orders: 'No orders',
no_reservations: 'No reservations',
settings_theme: '🎨 Theme',
settings_language: '🌍 Language',
theme_dark: 'Dark',
theme_light: 'Light',
theme_premium: 'Premium',
theme_purple: 'Purple',
theme_ocean: 'Ocean',
theme_sunset: 'Sunset',
theme_tatarstan: 'Tatarstan',
theme_newyear: '🎄 New Year',
settings_sound: '🔊 Sounds',
sound_effects: 'Sound on add to cart',
menu_btn: '📋 Menu',
cart: 'Cart',
cart_empty: 'Cart is empty',
checkout: 'Checkout',
total: 'Total',
pickup_time: 'When should we prepare it?',
pickup_asap: 'As soon as possible',
order_success: 'Order placed!',
order_sum: 'Sum',
order_time: 'Pickup time',
select_size: 'Size',
select_temp: 'Temperature',
select_juiceball: 'Juiceball (free)',
temp_ice: '🧊 With ice',
temp_cold: '❄️ Cold no ice',
temp_room: '🌡️ Room temp',
temp_warm: '☕ Warm',
no_juiceball: 'No juiceball',
select_date: 'Select date',
select_time: 'Select time',
select_guests: 'Number of guests',
guests: 'guests',
book_table: 'Book table',
booking_success: 'Table booked!',
select_service: 'Select service',
select_master: 'Select specialist',
any_master: 'Any specialist',
book_service: 'Book',
booking_created: 'You are booked!',
status_active: 'Active',
status_cancelled: 'Cancelled',
status_completed: 'Completed',
cancel_booking: 'Cancel',
cancel_order: 'Cancel',
cat_top: '🔥 Our Top',
cat_freeze: '🧊 Freeze',
cat_milkshake: '🥤 Milkshakes',
cat_sparkly: '✨ Sparkly',
cat_bloom: '🌸 Blooms',
cat_smoothie: '🥤 Smoothie',
cat_milky: '🥛 Milky',
cat_coffee: '☕ Coffee',
cat_waffles: '🧇 Waffles',
cat_extra: '➕ Extras',
business_cafe: 'Cafe',
business_barbershop: 'Barbershop',
business_clinic: 'Clinic',
business_restaurant: 'Restaurant'
},
tt: {
app_name: 'BookIt',
profile: 'Профиль',
back: '←',
close: '✕',
cancel: 'Баш тарту',
save: 'Саклау',
add: 'Өстәү',
welcome: 'Рәхим итегез!',
register_desc: 'Эшне башлау өчен телефон номерыгызны бүлешегез',
share_phone: '📱 Номерны бүлешү',
enter_manually: 'Кулдан язу',
enter_phone: 'Телефон номерын языгыз',
phone_placeholder: '+7 999 123-45-67',
continue_btn: 'Дәвам итү',
change_avatar: 'үзгәртү',
tab_bookings: 'Язылулар',
tab_orders: 'Заказлар',
tab_reservations: 'Брондар',
no_bookings: 'Язылулар юк',
no_orders: 'Заказлар юк',
no_reservations: 'Брондар юк',
settings_theme: '🎨 Темалар',
settings_language: '🌍 Тел',
theme_dark: 'Караңгы',
theme_light: 'Ачык',
theme_premium: 'Премиум',
theme_purple: 'Шәмәхә',
theme_ocean: 'Океан',
theme_sunset: 'Кояш бату',
theme_tatarstan: 'Татарстан',
theme_newyear: '🎄 Яңа ел',
settings_sound: '🔊 Тавышлар',
sound_effects: 'Өстәгәндә тавыш',
menu_btn: '📋 Меню',
cart: 'Кәрзин',
cart_empty: 'Кәрзин буш',
checkout: 'Заказ бирү',
total: 'Барлыгы',
pickup_time: 'Кайчанга әзерләргә?',
pickup_asap: 'Тизрәк',
order_success: 'Заказ бирелде!',
order_sum: 'Сумма',
order_time: 'Вакыт',
select_size: 'Зурлык',
select_temp: 'Температура',
select_juiceball: 'Джусбол (бушлай)',
temp_ice: '🧊 Боз белән',
temp_cold: '❄️ Салкын',
temp_room: '🌡️ Бүлмә',
temp_warm: '☕ Җылы',
no_juiceball: 'Джусболсыз',
select_date: 'Көнне сайлагыз',
select_time: 'Вакытны сайлагыз',
select_guests: 'Кунаклар саны',
guests: 'кунак',
book_table: 'Өстәл алу',
booking_success: 'Өстәл алынды!',
select_service: 'Хезмәтне сайлагыз',
select_master: 'Остазны сайлагыз',
any_master: 'Теләсә кем',
book_service: 'Язылу',
booking_created: 'Сез язылдыгыз!',
status_active: 'Актив',
status_cancelled: 'Баш тартылды',
status_completed: 'Тәмамланды',
cancel_booking: 'Баш тарту',
cancel_order: 'Баш тарту',
cat_top: '🔥 Иң яхшылар',
cat_freeze: '🧊 Фризлар',
cat_milkshake: '🥤 Милкшейклар',
cat_sparkly: '✨ Спарклылар',
cat_bloom: '🌸 Блумнар',
cat_smoothie: '🥤 Смузи',
cat_milky: '🥛 Сөтлеләр',
cat_coffee: '☕ Кофе',
cat_waffles: '🧇 Вафлилар',
cat_extra: '➕ Өстәмәләр',
business_cafe: 'Кафе',
business_barbershop: 'Барбершоп',
business_clinic: 'Клиника',
business_restaurant: 'Ресторан'
}
};

let currentLang = localStorage.getItem('app_lang') || 'ru';

function t(key) {
return i18n[currentLang]?.[key] || i18n['ru'][key] || key;
}

// === ЗВУКИ ===
let soundEnabled = localStorage.getItem('sound_enabled') !== 'false';

// Создаем звук программно через Web Audio API
let audioCtx = null;
let currentSound = localStorage.getItem('sound_type') || 'pluck';

function playPluck() {
if(!soundEnabled) return;
playSound(currentSound);
}

function playSound(type) {
try {
if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const osc = audioCtx.createOscillator();
const gain = audioCtx.createGain();
osc.connect(gain);
gain.connect(audioCtx.destination);

switch(type) {
case 'pluck':
osc.frequency.setValueAtTime(880, audioCtx.currentTime);
osc.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.1);
gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
osc.type = 'sine';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.15);
break;

case 'pop':
osc.frequency.setValueAtTime(600, audioCtx.currentTime);
osc.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.08);
gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
osc.type = 'sine';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.1);
break;

case 'coin':
osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
osc.frequency.setValueAtTime(1600, audioCtx.currentTime + 0.05);
osc.frequency.setValueAtTime(1200, audioCtx.currentTime + 0.1);
gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
osc.type = 'square';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.2);
break;

case 'ding':
osc.frequency.setValueAtTime(1400, audioCtx.currentTime);
gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
osc.type = 'sine';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.4);
break;

case 'whoosh':
osc.frequency.setValueAtTime(200, audioCtx.currentTime);
osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);
osc.type = 'sawtooth';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.25);
break;

case 'blip':
osc.frequency.setValueAtTime(800, audioCtx.currentTime);
osc.frequency.setValueAtTime(1000, audioCtx.currentTime + 0.03);
osc.frequency.setValueAtTime(600, audioCtx.currentTime + 0.06);
gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
osc.type = 'square';
osc.start(audioCtx.currentTime);
osc.stop(audioCtx.currentTime + 0.1);
break;
}
} catch(e){}
}

function selectSound(type) {
currentSound = type;
localStorage.setItem('sound_type', type);
updateSoundButtons();
playSound(type);
try{tg.HapticFeedback.selectionChanged()}catch(e){}
}

function updateSoundButtons() {
document.querySelectorAll('.sound-btn').forEach(btn => {
btn.classList.toggle('active', btn.dataset.sound === currentSound);
});
}

function toggleSound() {
soundEnabled = !soundEnabled;
localStorage.setItem('sound_enabled', soundEnabled);
updateSoundSwitch();
if(soundEnabled) playPluck();
try{tg.HapticFeedback.selectionChanged()}catch(e){}
}

function updateSoundSwitch() {
const sw = document.getElementById('sound-switch');
if(sw) sw.classList.toggle('active', soundEnabled);
}

function loadSoundSettings() {
soundEnabled = localStorage.getItem('sound_enabled') !== 'false';
currentSound = localStorage.getItem('sound_type') || 'pluck';
updateSoundSwitch();
updateSoundButtons();
}

function setLanguage(lang) {
currentLang = lang;
localStorage.setItem('app_lang', lang);
document.documentElement.setAttribute('data-lang', lang);
document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
const btn = document.querySelector('.lang-btn[data-lang="'+lang+'"]');
if(btn) btn.classList.add('active');
applyTranslations();
try{tg.HapticFeedback.selectionChanged()}catch(e){}
}

function loadLanguage() {
const saved = localStorage.getItem('app_lang') || 'ru';
currentLang = saved;
document.querySelectorAll('.lang-btn').forEach(b => {
b.classList.toggle('active', b.getAttribute('data-lang') === saved);
});
applyTranslations();
}

function applyTranslations() {
// Статические элементы
document.querySelectorAll('[data-i18n]').forEach(el => {
const key = el.getAttribute('data-i18n');
el.textContent = t(key);
});
// Обновляем динамический контент
updateDynamicContent();
}

function updateDynamicContent() {
// Заголовки страниц
const profileHeader = document.querySelector('#page-profile .header h1');
if(profileHeader) profileHeader.textContent = t('profile');
const cartHeader = document.querySelector('#page-cart .header h1');
if(cartHeader) cartHeader.textContent = t('cart');
// Табы профиля
const tabBookings = document.getElementById('tab-bookings');
if(tabBookings) tabBookings.textContent = t('tab_bookings');
const tabOrders = document.getElementById('tab-orders');
if(tabOrders) tabOrders.textContent = t('tab_orders');
const tabReservations = document.getElementById('tab-reservations');
if(tabReservations) tabReservations.textContent = t('tab_reservations');
// Кнопки тем
document.querySelectorAll('.theme-btn[data-theme]').forEach(btn => {
const theme = btn.getAttribute('data-theme');
const span = btn.querySelector('span:last-child');
if(span && theme) span.textContent = t('theme_' + theme);
});
// Заголовки настроек
const themeTitle = document.querySelector('.theme-section-title');
if(themeTitle && !themeTitle.getAttribute('data-i18n')) themeTitle.textContent = t('settings_theme');
// Кнопка оформления заказа
const checkoutBtn = document.querySelector('#page-cart .btn-primary');
if(checkoutBtn) checkoutBtn.textContent = t('checkout');
// Кнопка меню
const menuBtn = document.querySelector('.header-menu-btn');
if(menuBtn) menuBtn.textContent = t('menu_btn');
// Текст изменить аватар
const changeAvatar = document.querySelector('#profile-avatar div');
if(changeAvatar) changeAvatar.textContent = t('change_avatar');
// Обновляем меню категории
if(typeof loadCafeMenu === 'function' && document.getElementById('menu-categories')) {
loadCafeMenu();
}
}

const API_URL='https://bookit-api-camelot770.amvera.io';
let user=tg.initDataUnsafe?.user||{id:12345,first_name:'Тест'};
let userProfile=null,cart=[];

// Картинки меню Pink Purple
const MENU_IMAGES=[
'https://i.imgur.com/Yprglgl.png',
'https://i.imgur.com/H7GdT6l.png'
];

let selectedMaster=null,selectedBarberService=null,selectedBarberDate=null,selectedBarberTime=null;
let barberServices={};
let selectedBranch=null,selectedCategory=null,selectedDoctor=null,selectedClinicService=null,selectedClinicDate=null,selectedClinicTime=null;
let branches=[],clinicServices={},categoryDoctors=[];

const FALLBACK_BRANCHES=[
{id:'branch_central',name:'Центральный филиал',address:'ул. Ленина, 42',phone:'+7 (999) 111-22-33',work_hours:'8:00 - 20:00'},
{id:'branch_north',name:'Северный филиал',address:'пр. Мира, 128',phone:'+7 (999) 222-33-44',work_hours:'9:00 - 21:00'},
{id:'branch_south',name:'Южный филиал',address:'ул. Гагарина, 15',phone:'+7 (999) 333-44-55',work_hours:'8:00 - 19:00'}
];

const FALLBACK_SERVICES={
branch_central:{
therapy:{name:'🩺 Терапия',specialty:'Терапевт',items:[{id:'consult_therapy',name:'Приём терапевта',price:1500,duration:30},{id:'checkup_basic',name:'Базовый осмотр',price:2000,duration:45}]},
cardio:{name:'❤️ Кардиология',specialty:'Кардиолог',items:[{id:'consult_cardio',name:'Приём кардиолога',price:2000,duration:40},{id:'ecg',name:'ЭКГ',price:1200,duration:20}]},
neuro:{name:'🧠 Неврология',specialty:'Невролог',items:[{id:'consult_neuro',name:'Приём невролога',price:1800,duration:30}]},
pediatrics:{name:'👶 Педиатрия',specialty:'Педиатр',items:[{id:'consult_child',name:'Приём педиатра',price:1600,duration:30}]}
},
branch_north:{
therapy:{name:'🩺 Терапия',specialty:'Терапевт',items:[{id:'consult_therapy',name:'Приём терапевта',price:1400,duration:30}]},
gyneco:{name:'👩 Гинекология',specialty:'Гинеколог',items:[{id:'consult_gyn',name:'Приём гинеколога',price:2200,duration:40},{id:'uzi_gyn',name:'УЗИ органов малого таза',price:2500,duration:30}]},
surgery:{name:'🔪 Хирургия',specialty:'Хирург',items:[{id:'consult_surg',name:'Консультация хирурга',price:1800,duration:30}]}
},
branch_south:{
therapy:{name:'🩺 Терапия',specialty:'Терапевт',items:[{id:'consult_therapy',name:'Приём терапевта',price:1300,duration:30}]},
derma:{name:'🧴 Дерматология',specialty:'Дерматолог',items:[{id:'consult_derma',name:'Приём дерматолога',price:1700,duration:30}]},
ortho:{name:'🦴 Ортопедия',specialty:'Ортопед',items:[{id:'consult_ortho',name:'Приём ортопеда',price:1900,duration:40}]},
eye:{name:'👁️ Офтальмология',specialty:'Офтальмолог',items:[{id:'consult_eye',name:'Приём офтальмолога',price:1600,duration:30}]}
}
};

const FALLBACK_DOCTORS={
branch_central:[
{id:'doc_ivanov',name:'Иванов А.И.',specialty:'Терапевт',experience:'15 лет',rating:4.9},
{id:'doc_petrova',name:'Петрова М.С.',specialty:'Кардиолог',experience:'12 лет',rating:4.8},
{id:'doc_sidorov',name:'Сидоров К.В.',specialty:'Невролог',experience:'10 лет',rating:4.7},
{id:'doc_kozlova',name:'Козлова Е.А.',specialty:'Педиатр',experience:'8 лет',rating:4.9}
],
branch_north:[
{id:'doc_smirnov',name:'Смирнов Д.П.',specialty:'Терапевт',experience:'20 лет',rating:4.9},
{id:'doc_volkova',name:'Волкова И.Н.',specialty:'Гинеколог',experience:'14 лет',rating:4.8},
{id:'doc_morozov',name:'Морозов А.С.',specialty:'Хирург',experience:'18 лет',rating:4.9}
],
branch_south:[
{id:'doc_novikov',name:'Новиков П.А.',specialty:'Терапевт',experience:'11 лет',rating:4.7},
{id:'doc_fedorova',name:'Фёдорова О.В.',specialty:'Дерматолог',experience:'9 лет',rating:4.8},
{id:'doc_alexeev',name:'Алексеев В.М.',specialty:'Ортопед',experience:'16 лет',rating:4.9},
{id:'doc_egorova',name:'Егорова Т.С.',specialty:'Офтальмолог',experience:'7 лет',rating:4.6}
]
};

function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');if(id==='page-cart')renderCart();try{tg.HapticFeedback.impactOccurred('light')}catch(e){}}

// Модалка меню
function showMenuImages(){document.getElementById('menu-image-modal').classList.add('show');showMenuPage(1)}
function hideMenuImages(){document.getElementById('menu-image-modal').classList.remove('show')}
function showMenuPage(n){
document.getElementById('menu-img-btn-1').classList.toggle('active',n===1);
document.getElementById('menu-img-btn-2').classList.toggle('active',n===2);
document.getElementById('menu-full-image').src=MENU_IMAGES[n-1];
}

// === THEMES ===
function setTheme(theme){
document.documentElement.setAttribute('data-theme',theme);
localStorage.setItem('app_theme',theme);
document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));
const btn=document.querySelector('.theme-btn[data-theme="'+theme+'"]');
if(btn)btn.classList.add('active');
try{tg.HapticFeedback.selectionChanged()}catch(e){}
}

function loadTheme(){
const saved=localStorage.getItem('app_theme')||'dark';
document.documentElement.setAttribute('data-theme',saved);
document.querySelectorAll('.theme-btn').forEach(b=>{
b.classList.toggle('active',b.getAttribute('data-theme')===saved);
});
}

async function checkRegistration(){
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/profile');const d=await r.json();if(d.registered){userProfile=d;loadBusinesses();showPage('page-home');loadHeaderAvatar();loadTheme();loadLanguage();loadSoundSettings()}else{showPage('page-register');loadLanguage();loadSoundSettings()}}catch(e){userProfile={phone:'',first_name:user.first_name};loadBusinesses();showPage('page-home');loadHeaderAvatar();loadTheme();loadLanguage();loadSoundSettings()}
}

function loadHeaderAvatar(){
const saved=localStorage.getItem('avatar_'+user.id);
const headerBtn=document.getElementById('header-avatar-btn');
if(saved && headerBtn){headerBtn.innerHTML='<img src="'+saved+'">';}
}

function requestPhoneNumber(){
// Запрашиваем контакт через Telegram WebApp
try{
tg.requestContact(async function(sent, event){
if(sent && event && event.responseUnsafe && event.responseUnsafe.contact){
const contact = event.responseUnsafe.contact;
const phone = contact.phone_number;
// Регистрируем пользователя
try{await fetch(API_URL+'/api/user/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,phone:phone,first_name:user.first_name,username:user.username})})}catch(e){}
userProfile={phone:phone,first_name:user.first_name};
loadBusinesses();
showPage('page-home');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}else{
// Пользователь отказал - показываем альтернативу
showManualPhoneInput();
}
});
}catch(e){
// requestContact не поддерживается - показываем ручной ввод
showManualPhoneInput();
}
}

function showManualPhoneInput(){
document.querySelector('.register-container').innerHTML=`
<div class="register-icon">📱</div>
<div class="register-title">Введите номер</div>
<div class="register-text">Или введите номер вручную</div>
<div class="input-group">
<label class="input-label">Номер телефона</label>
<input type="tel" id="phone-input" class="input-field" placeholder="+7 (999) 123-45-67" oninput="validatePhone()">
</div>
<button class="btn-primary" id="register-btn" onclick="registerManual()" disabled>Продолжить</button>
`;
}

function validatePhone(){const p=document.getElementById('phone-input').value.replace(/\D/g,'');document.getElementById('register-btn').disabled=p.length<10}

async function registerManual(){
const phone=document.getElementById('phone-input').value;
try{await fetch(API_URL+'/api/user/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,phone:phone,first_name:user.first_name,username:user.username})})}catch(e){}
userProfile={phone:phone,first_name:user.first_name};loadBusinesses();showPage('page-home');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

function loadBusinesses(){
const b=[
{id:'pink_purple',name:'Pink Purple',desc:'Смузи, милки, вафли',emoji:'🍹',grad:'linear-gradient(135deg,#9C27B0,#E91E63)'},
{id:'portos',name:'PORTOS',desc:'Мужские стрижки',emoji:'💈',grad:'linear-gradient(135deg,#1a1a2e,#16213e)'},
{id:'clinic',name:'Здоровье семьи',desc:'Сеть клиник',emoji:'🏥',grad:'linear-gradient(135deg,#00b894,#00cec9)'},
{id:'chernovar',name:'Черновар',desc:'Ресторан • Бронь столиков',emoji:'🍺',grad:'linear-gradient(135deg,#2c1810,#5d4037)'}
];
document.getElementById('businesses-list').innerHTML=b.map(x=>'<div class="business-card" onclick="openBusiness(\''+x.id+'\')" style="background:'+x.grad+'"><div class="business-card-content"><div class="business-emoji">'+x.emoji+'</div><div class="business-name">'+x.name+'</div><div class="business-desc">'+x.desc+'</div></div></div>').join('');
}

function openBusiness(id){
if(id==='pink_purple'){loadCafeMenu();showPage('page-cafe')}
else if(id==='portos'){loadBarberData();showPage('page-barber')}
else if(id==='clinic'){loadClinicBranches();showPage('page-clinic-branches')}
else if(id==='chernovar'){showPage('page-chernovar')}
}

function openProfile(){
document.getElementById('profile-name').textContent=userProfile?.first_name||user.first_name||'Гость';
document.getElementById('profile-phone').textContent=userProfile?.phone||'';
loadAvatar();
switchTab('bookings');
showPage('page-profile');
}

function loadAvatar(){
const saved=localStorage.getItem('avatar_'+user.id);
const container=document.getElementById('avatar-content');
const headerBtn=document.getElementById('header-avatar-btn');
if(saved){
container.innerHTML='<img src="'+saved+'" style="width:100%;height:100%;object-fit:cover">';
if(headerBtn)headerBtn.innerHTML='<img src="'+saved+'">';
}else{
container.innerHTML='👤';
if(headerBtn)headerBtn.innerHTML='👤';
}
}

function uploadAvatar(input){
const file=input.files[0];
if(!file)return;
if(file.size>2*1024*1024){alert('Файл слишком большой (макс 2MB)');return}
const reader=new FileReader();
reader.onload=function(e){
const dataUrl=e.target.result;
localStorage.setItem('avatar_'+user.id,dataUrl);
loadAvatar();
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
};
reader.readAsDataURL(file);
}
function switchTab(t){document.querySelectorAll('.profile-tab').forEach(x=>x.classList.remove('active'));document.getElementById('tab-'+t).classList.add('active');if(t==='bookings')loadUserBookings();else if(t==='orders')loadUserOrders();else if(t==='reservations')loadUserReservations()}

async function loadUserBookings(){
const c=document.getElementById('profile-content');
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/bookings');const b=await r.json();
if(!b.length){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">📅</div><div>Нет записей</div></div>';return}
c.innerHTML=b.map(x=>{const d=new Date(x.date).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});const sc=x.status==='cancelled'?'cancelled':(x.is_past?'past':'');const st=x.status==='cancelled'?'Отменена':(x.is_past?'Завершена':'Активна');const icon=x.business_id==='clinic'?'👨‍⚕️':'👨‍🦱';return'<div class="booking-card '+(x.is_past?'past':'')+'"><div class="booking-header"><div class="booking-date">'+d+', '+x.time+'</div><div class="booking-status '+sc+'">'+st+'</div></div><div class="booking-service">'+x.service_name+'</div><div class="booking-master">'+icon+' '+x.master_name+'</div>'+(!x.is_past&&x.status!=='cancelled'?'<button class="booking-cancel" onclick="cancelBooking(\''+x.booking_id+'\')">Отменить</button>':'')+'</div>'}).join('')}catch(e){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">📅</div><div>Нет записей</div></div>'}
}

async function loadUserOrders(){
const c=document.getElementById('profile-content');
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/orders');const o=await r.json();
if(!o.length){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">🛒</div><div>Нет заказов</div></div>';return}
c.innerHTML=o.map(x=>{
const d=new Date(x.created_at).toLocaleDateString('ru-RU',{day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'});
const pickup=x.pickup_time?'К '+x.pickup_time:'';
const sc=x.status==='cancelled'?'cancelled':'';
const st=x.status==='cancelled'?'Отменён':(x.status==='completed'?'Выполнен':'Новый');
const canCancel=x.status==='new';
return'<div class="booking-card"><div class="booking-header"><div class="booking-date">'+d+'</div><div class="booking-status '+sc+'">'+st+'</div></div><div class="booking-service">'+x.items.map(i=>i.name).join(', ')+'</div><div class="booking-master">💰 '+x.total+'₽'+(pickup?' • ⏰ '+pickup:'')+'</div>'+(canCancel?'<button class="booking-cancel" onclick="cancelOrder(\''+x.order_id+'\')">Отменить</button>':'')+'</div>'
}).join('')}catch(e){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">🛒</div><div>Нет заказов</div></div>'}
}

async function cancelOrder(id){if(!confirm('Отменить заказ?'))return;try{await fetch(API_URL+'/api/orders/'+id+'/cancel?user_id='+user.id,{method:'POST'});try{tg.HapticFeedback.notificationOccurred('success')}catch(e){};loadUserOrders()}catch(e){alert('Ошибка')}}

async function cancelBooking(id){if(!confirm('Отменить запись?'))return;try{await fetch(API_URL+'/api/bookings/'+id+'/cancel?user_id='+user.id,{method:'POST'});try{tg.HapticFeedback.notificationOccurred('success')}catch(e){};loadUserBookings()}catch(e){alert('Ошибка')}}

async function loadUserReservations(){
const c=document.getElementById('profile-content');
try{const r=await fetch(API_URL+'/api/user/'+user.id+'/reservations');const res=await r.json();
if(!res.length){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">🍽️</div><div>Нет бронирований</div></div>';return}
c.innerHTML=res.map(x=>{
const d=new Date(x.date).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});
const sc=x.status==='cancelled'?'cancelled':(x.is_past?'past':'');
const st=x.status==='cancelled'?'Отменена':(x.is_past?'Прошла':'Активна');
const canCancel=!x.is_past&&x.status!=='cancelled';
return'<div class="booking-card '+(x.is_past?'past':'')+'"><div class="booking-header"><div class="booking-date">'+d+', '+x.time+'</div><div class="booking-status '+sc+'">'+st+'</div></div><div class="booking-service">🍺 Черновар • '+x.guests+' гостей</div><div class="booking-master">👤 На имя: '+x.guest_name+'</div>'+(canCancel?'<button class="booking-cancel" onclick="cancelReservation(\''+x.reservation_id+'\')">Отменить</button>':'')+'</div>'
}).join('')}catch(e){c.innerHTML='<div class="empty-state"><div class="empty-state-icon">🍽️</div><div>Нет бронирований</div></div>'}
}

async function cancelReservation(id){if(!confirm('Отменить бронь?'))return;try{await fetch(API_URL+'/api/reservations/'+id+'/cancel?user_id='+user.id,{method:'POST'});try{tg.HapticFeedback.notificationOccurred('success')}catch(e){};loadUserReservations()}catch(e){alert('Ошибка')}}

// === CAFE - ПОЛНОЕ МЕНЮ PINK PURPLE ===
let currentMenu={};
function loadCafeMenu(){
// Показываем кнопку панели владельца если это владелец
const ownerBtn = document.getElementById('owner-panel-btn');
if(ownerBtn && isOwner()) ownerBtn.style.display = 'flex';

currentMenu={
top:{name:t('cat_top'),items:[
{id:'top_pink_matcha',name:'Пинк Матча',e:'🍵',img:'top_pink_matcha.jpg',bg:'linear-gradient(135deg,#a8e6cf,#dcedc1)',sizes:[{vol:'400мл',price:409},{vol:'500мл',price:459},{vol:'650мл',price:509}]},
{id:'top_pina_colada',name:'Пина Колада',e:'🥥',img:'top_pina_colada.jpg',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}]},
{id:'top_coco_pink',name:'Коко Пинк',e:'🥥',img:'top_coco_pink.jpg',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)',sizes:[{vol:'500мл',price:499},{vol:'650мл',price:549}]},
{id:'top_dubai_choco',name:'Дубайский шоколад',e:'🍫',img:'top_dubai_choco.jpg',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'500мл',price:599},{vol:'650мл',price:649}],hasTemp:true},
{id:'top_dubai_chill',name:'Дубай Чилл',e:'❄️',img:'top_dubai_chill.jpg',bg:'linear-gradient(135deg,#667eea,#764ba2)',sizes:[{vol:'500мл',price:599},{vol:'650мл',price:649}]}
]},
freeze:{name:t('cat_freeze'),items:[
{id:'freeze_oreo',name:'Шоколад Орео',e:'🍪',img:'freeze_oreo.jpg',bg:'linear-gradient(135deg,#232526,#414345)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]},
{id:'freeze_mango',name:'Манго',e:'🥭',img:'freeze_mango.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]},
{id:'freeze_cherry',name:'Вишня',e:'🍒',img:'freeze_cherry.jpg',bg:'linear-gradient(135deg,#c31432,#240b36)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]},
{id:'freeze_strawberry',name:'Клубника',e:'🍓',img:'freeze_strawberry.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]},
{id:'freeze_grape',name:'Виноград',e:'🍇',img:'freeze_grape.jpg',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]},
{id:'freeze_blueberry',name:'Черника',e:'🫐',img:'freeze_blueberry.jpg',bg:'linear-gradient(135deg,#4776e6,#8e54e9)',sizes:[{vol:'500мл',price:449},{vol:'650мл',price:499}]}
]},
milkshake:{name:t('cat_milkshake'),items:[
{id:'shake_classic',name:'Классика',e:'🥛',img:'shake_classic.jpg',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'500мл',price:449}]},
{id:'shake_choco',name:'Шоколад',e:'🍫',img:'shake_choco.jpg',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'500мл',price:449}]},
{id:'shake_strawberry',name:'Клубника',e:'🍓',img:'shake_strawberry.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'500мл',price:449}]},
{id:'shake_caramel',name:'Карамель',e:'🍯',img:'shake_caramel.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'500мл',price:449}]},
{id:'shake_blueberry',name:'Черника',e:'🫐',img:'shake_blueberry.jpg',bg:'linear-gradient(135deg,#4776e6,#8e54e9)',sizes:[{vol:'500мл',price:449}]},
{id:'shake_coffee',name:'Кофейный',e:'☕',img:'shake_coffee.jpg',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'500мл',price:449}]}
]},
sparkly:{name:t('cat_sparkly'),items:[
{id:'sparkle_mango_ginger',name:'Манго-Имбирь',e:'🥭',img:'sparkle_mango_ginger.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_pineapple_lychee',name:'Ананас-Личи',e:'🍍',img:'sparkle_pineapple_lychee.jpg',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_apple_lime',name:'Яблоко-Лимон-Лайм',e:'🍏',img:'sparkle_apple_lime.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_mint_raspberry',name:'Мята-Малина',e:'🌿',img:'sparkle_mint_raspberry.jpg',bg:'linear-gradient(135deg,#11998e,#38ef7d)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_kiwi_lime',name:'Киви-Лайм',e:'🥝',img:'sparkle_kiwi_lime.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_lime_curacao',name:'Лайм-Кюрасао',e:'🍋',img:'sparkle_lime_curacao.jpg',bg:'linear-gradient(135deg,#11998e,#38ef7d)',sizes:[{vol:'500мл',price:349}]},
{id:'sparkle_citrus',name:'Цитрус',e:'🍊',img:'sparkle_citrus.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'500мл',price:349}]}
]},
bloom:{name:t('cat_bloom'),items:[
{id:'bloom_kiwi_maracuya',name:'Киви Маракуйя Блум',e:'🥝',img:'bloom_kiwi_maracuya.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'400мл',price:349},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:false},
{id:'bloom_mango_maracuya',name:'Манго Маракуйя Блум',e:'🥭',img:'bloom_mango_maracuya.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'400мл',price:399},{vol:'500мл',price:449},{vol:'650мл',price:499}],hasTemp:true,hasJuiceball:false},
{id:'bloom_cherry_pomegranate',name:'Вишня Гранат Блум',e:'🍒',img:'bloom_cherry_pomegranate.jpg',bg:'linear-gradient(135deg,#8e0e00,#1f1c18)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_blueberry_lavender',name:'Черника Лаванда Блум',e:'🫐',img:'bloom_blueberry_lavender.jpg',bg:'linear-gradient(135deg,#4776e6,#8e54e9)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_guava_cherry',name:'Гуава Вишня Блум',e:'🍒',img:'bloom_guava_cherry.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_peach',name:'Персиковый Блум',e:'🍑',img:'bloom_peach.jpg',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_strawberry_maracuya',name:'Клубника Маракуйя Блум',e:'🍓',img:'bloom_strawberry_maracuya.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_raspberry',name:'Малина Блум',e:'🫐',img:'bloom_raspberry.jpg',bg:'linear-gradient(135deg,#c31432,#240b36)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true},
{id:'bloom_strawberry_yuzu',name:'Клубника Юдзу Блум',e:'🍓',img:'bloom_strawberry_yuzu.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true,hasJuiceball:true}
]},
smoothie:{name:t('cat_smoothie'),items:[
{id:'smoothie_berry',name:'Ягодный смузи',e:'🍓',img:'smoothie_berry.jpg',bg:'linear-gradient(135deg,#ff6b6b,#c44569)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_kiwi_cucumber',name:'Киви-Огурец',e:'🥝',img:'smoothie_kiwi_cucumber.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_mango_banana',name:'Манго-Банан',e:'🥭',img:'smoothie_mango_banana.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_cherry_cacao',name:'Вишня-Какао',e:'🍒',img:'smoothie_cherry_cacao.jpg',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_strawberry_banana',name:'Клубника-Банан',e:'🍓',img:'smoothie_strawberry_banana.jpg',bg:'linear-gradient(135deg,#ff416c,#ff4b2b)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_cucumber_mint',name:'Огурец-Мята',e:'🥒',img:'smoothie_cucumber_mint.jpg',bg:'linear-gradient(135deg,#11998e,#38ef7d)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_blueberry_banana',name:'Черника-Банан',e:'🫐',img:'smoothie_blueberry_banana.jpg',bg:'linear-gradient(135deg,#4776e6,#8e54e9)',sizes:[{vol:'500мл',price:489}]},
{id:'smoothie_raspberry_apple',name:'Малина-Яблоко',e:'🍎',img:'smoothie_raspberry_apple.jpg',bg:'linear-gradient(135deg,#eb3349,#f45c43)',sizes:[{vol:'500мл',price:489}]}
]},
milky:{name:t('cat_milky'),items:[
{id:'milk_original',name:'Милк Ориджинал',e:'🧋',img:'milk_original.jpg',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'400мл',price:329},{vol:'500мл',price:379},{vol:'650мл',price:429}],hasTemp:true},
{id:'milk_minty',name:'Минти Милк',e:'🌿',img:'milk_minty.jpg',bg:'linear-gradient(135deg,#11998e,#38ef7d)',sizes:[{vol:'400мл',price:349},{vol:'500мл',price:399},{vol:'650мл',price:449}],hasTemp:true},
{id:'milk_green',name:'Грин Милк',e:'🍵',img:'milk_green.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'400мл',price:429},{vol:'500мл',price:479},{vol:'650мл',price:529}],hasTemp:true},
{id:'milk_caramel',name:'Карамель Милк',e:'🍯',img:'milk_caramel.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'400мл',price:399},{vol:'500мл',price:449},{vol:'650мл',price:499}],hasTemp:true},
{id:'milk_purple',name:'Перпл Милк',e:'🍇',img:'milk_purple.jpg',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)',sizes:[{vol:'400мл',price:399},{vol:'500мл',price:449},{vol:'650мл',price:499}],hasTemp:true},
{id:'milk_pink',name:'Пинк Милк',e:'🌸',img:'milk_pink.jpg',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)',sizes:[{vol:'400мл',price:399},{vol:'500мл',price:449},{vol:'650мл',price:499}],hasTemp:true},
{id:'milk_taro',name:'Таро Милк',e:'🍠',img:'milk_taro.jpg',bg:'linear-gradient(135deg,#8e2de2,#4a00e0)',sizes:[{vol:'400мл',price:409},{vol:'500мл',price:459},{vol:'650мл',price:509}],hasTemp:true},
{id:'milk_banana',name:'Банана Милк',e:'🍌',img:'milk_banana.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'400мл',price:409},{vol:'500мл',price:459},{vol:'650мл',price:509}],hasTemp:true},
{id:'milk_coco',name:'Коко Милк',e:'🥥',img:'milk_coco.jpg',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'400мл',price:409},{vol:'500мл',price:459},{vol:'650мл',price:509}],hasTemp:true}
]},
coffee:{name:t('cat_coffee'),items:[
{id:'coffee_ice_latte',name:'Айс Латте',e:'🧊',img:'coffee_ice_latte.jpg',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'500мл',price:389}]},
{id:'coffee_cream',name:'Сливочный латте',e:'🥛',img:'coffee_cream.jpg',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'500мл',price:429}]},
{id:'coffee_matcha',name:'Матча латте',e:'🍵',img:'coffee_matcha.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'500мл',price:429}],hasTemp:true},
{id:'coffee_pistachio',name:'Фисташковый латте',e:'🥜',img:'coffee_pistachio.jpg',bg:'linear-gradient(135deg,#56ab2f,#a8e063)',sizes:[{vol:'500мл',price:449}],hasTemp:true},
{id:'coffee_banana_caramel',name:'Бананово-карамельный латте',e:'🍌',img:'coffee_banana_caramel.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'400мл',price:389}],hasTemp:true},
{id:'coffee_cappuccino',name:'Капучино',e:'☕',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'300мл',price:249}]},
{id:'coffee_latte',name:'Латте',e:'☕',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'300мл',price:249}]},
{id:'coffee_raf',name:'Раф',e:'☕',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)',sizes:[{vol:'300мл',price:249}]},
{id:'coffee_espresso',name:'Эспрессо',e:'☕',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'50мл',price:190}]},
{id:'coffee_americano',name:'Американо',e:'☕',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'200мл',price:190}]}
]},
waffles:{name:t('cat_waffles'),items:[
{id:'waffle_choco_mix',name:'Шоколадный Микс',e:'🍫',img:'waffle_choco_mix.jpg',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'',price:489}]},
{id:'waffle_chicken',name:'Вафля с курицей',e:'🍗',img:'waffle_chicken.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'',price:489}]},
{id:'waffle_choco_oreo',name:'Шоколадный Орео',e:'🍪',img:'waffle_choco_oreo.jpg',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'',price:509}]},
{id:'waffle_pink_purple',name:'Пинк Перпл',e:'🌸',img:'waffle_pink_purple.jpg',bg:'linear-gradient(135deg,#fbc2eb,#a6c1ee)',sizes:[{vol:'',price:449}]},
{id:'waffle_banana_nutella',name:'Банан Нутелла',e:'🍌',img:'waffle_banana_nutella.jpg',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'',price:449}]}
]},
extra:{name:t('cat_extra'),items:[
{id:'extra_tapioca',name:'Тапиока',e:'⚫',bg:'linear-gradient(135deg,#232526,#414345)',sizes:[{vol:'',price:79}]},
{id:'extra_espresso',name:'Шот эспрессо',e:'☕',bg:'linear-gradient(135deg,#3a1c71,#d76d77)',sizes:[{vol:'',price:89}]},
{id:'extra_syrup',name:'Сироп',e:'🍯',bg:'linear-gradient(135deg,#f7971e,#ffd200)',sizes:[{vol:'',price:30}]},
{id:'extra_cream_cap',name:'Сырная шапка',e:'🧀',bg:'linear-gradient(135deg,#ffecd2,#fcb69f)',sizes:[{vol:'',price:99}]},
{id:'extra_coconut_jelly',name:'Кокосовое желе',e:'🥥',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'',price:79}]},
{id:'extra_alt_milk',name:'Альтернативное молоко',e:'🥛',bg:'linear-gradient(135deg,#c9d6ff,#e2e2e2)',sizes:[{vol:'',price:90}]}
]}
};
const c=Object.entries(currentMenu);
document.getElementById('menu-categories').innerHTML=c.map(([k,v],i)=>'<button class="menu-chip '+(i===0?'active':'')+'" onclick="selectMenuCat(\''+k+'\',this)">'+v.name+'</button>').join('');
renderMenu('top');
}

let selectedItem=null;
const juiceballFlavors=['Маракуйя','Личи','Манго','Клубника'];
function getTempOptions(){return [t('temp_ice'),t('temp_cold'),t('temp_room'),t('temp_warm')];}

function selectMenuCat(k,el){document.querySelectorAll('.menu-chip').forEach(x=>x.classList.remove('active'));el.classList.add('active');renderMenu(k)}

let menuItemsData={};

function renderMenu(k){
menuItemsData={};
document.getElementById('menu-items').innerHTML=currentMenu[k].items.map((x,idx)=>{
const minPrice=Math.min(...x.sizes.map(s=>s.price));
const maxPrice=Math.max(...x.sizes.map(s=>s.price));
const priceText=minPrice===maxPrice?minPrice+'₽':'от '+minPrice+'₽';
const volText=x.sizes.length>1?x.sizes.map(s=>s.vol).join(' / '):x.sizes[0].vol;
const itemKey=k+'_'+idx;
menuItemsData[itemKey]=x;
const imgContent=x.img?'<img src="'+x.img+'" alt="'+x.name+'">':x.e;
return '<div class="menu-item"><div class="menu-item-image" style="background:'+x.bg+'">'+imgContent+'</div><div class="menu-item-info"><div class="menu-item-name">'+x.name+'</div>'+(volText?'<div class="menu-item-volume">'+volText+'</div>':'')+'<div class="menu-item-price">'+priceText+'</div></div><button class="menu-item-add" onclick="openItemModal(\''+itemKey+'\')">+</button></div>'
}).join('')
}

function openItemModal(key){
const item=menuItemsData[key];
if(!item)return;
selectedItem=item;
const hasSizes=item.sizes.length>1;
const hasTemp=item.hasTemp||false;
const hasJuiceball=item.hasJuiceball||false;

const iconContent=item.img?'<img src="'+item.img+'" alt="'+item.name+'">':item.e;
let html='<div class="item-modal-header"><div class="item-modal-icon" style="background:'+item.bg+'">'+iconContent+'</div><div class="item-modal-name">'+item.name+'</div></div>';

// Размеры
if(hasSizes){
html+='<div class="item-modal-section"><div class="item-modal-label">'+t('select_size')+'</div><div class="item-modal-options" id="size-options">';
item.sizes.forEach((s,i)=>{
html+='<button class="item-option '+(i===0?'selected':'')+'" onclick="selectSize('+i+','+s.price+')" data-idx="'+i+'">'+s.vol+'<span>'+s.price+'₽</span></button>';
});
html+='</div></div>';
}

// Температура для блумов
if(hasTemp){
html+='<div class="item-modal-section"><div class="item-modal-label">'+t('select_temp')+'</div><div class="item-modal-options temp-options" id="temp-options">';
getTempOptions().forEach((opt,i)=>{
html+='<button class="item-option '+(i===0?'selected':'')+'" onclick="selectTemp('+i+')" data-idx="'+i+'">'+opt+'</button>';
});
html+='</div></div>';
}

// Джусбол для определённых блумов (бесплатно)
if(hasJuiceball){
html+='<div class="item-modal-section"><div class="item-modal-label">'+t('select_juiceball')+'</div><div class="item-modal-options" id="juiceball-options">';
html+='<button class="item-option selected" onclick="selectJuiceball(-1)" data-idx="-1">'+t('no_juiceball')+'</button>';
juiceballFlavors.forEach((j,i)=>{
html+='<button class="item-option" onclick="selectJuiceball('+i+')" data-idx="'+i+'">'+j+'</button>';
});
html+='</div></div>';
}

html+='<div class="item-modal-footer"><div class="item-modal-total" id="modal-total">'+item.sizes[0].price+'₽</div><button class="btn-primary" onclick="addItemToCart()">Добавить</button></div>';

document.getElementById('item-modal-content').innerHTML=html;
document.getElementById('item-modal').classList.add('show');

// Сохраняем выбор
selectedItem._selectedSize=0;
selectedItem._selectedPrice=item.sizes[0].price;
selectedItem._selectedTemp=0;
selectedItem._selectedJuiceball=-1;
}

function selectSize(idx,price){
document.querySelectorAll('#size-options .item-option').forEach(b=>b.classList.remove('selected'));
document.querySelector('#size-options .item-option[data-idx="'+idx+'"]').classList.add('selected');
selectedItem._selectedSize=idx;
selectedItem._selectedPrice=price;
document.getElementById('modal-total').textContent=price+'₽';
}

function selectTemp(idx){
document.querySelectorAll('#temp-options .item-option').forEach(b=>b.classList.remove('selected'));
document.querySelector('#temp-options .item-option[data-idx="'+idx+'"]').classList.add('selected');
selectedItem._selectedTemp=idx;
}

function selectJuiceball(idx){
document.querySelectorAll('#juiceball-options .item-option').forEach(b=>b.classList.remove('selected'));
document.querySelector('#juiceball-options .item-option[data-idx="'+idx+'"]').classList.add('selected');
selectedItem._selectedJuiceball=idx;
}

function closeItemModal(){document.getElementById('item-modal').classList.remove('show')}

// === ГРУППОВОЙ ЗАКАЗ ===
let groupOrder = null;
let isGroupMode = false;

function generateGroupId() {
return 'GRP' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2,4).toUpperCase();
}

function openGroupOrderModal() {
const content = document.getElementById('group-order-content');
if(groupOrder) {
renderGroupOrderView();
} else {
content.innerHTML = `
<div style="text-align:center;padding:20px 0">
<div style="font-size:48px;margin-bottom:16px">👥</div>
<p style="color:var(--text-secondary);margin-bottom:24px;line-height:1.5">
Создайте групповой заказ и поделитесь ссылкой с друзьями. Каждый добавит своё, а вы оформите всё вместе!
</p>
<button class="btn-primary" onclick="createGroupOrder()" style="width:100%">
🎉 Создать групповой заказ
</button>
</div>
`;
}
document.getElementById('group-order-modal').classList.add('show');
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}
}

function closeGroupOrderModal() {
document.getElementById('group-order-modal').classList.remove('show');
}

async function createGroupOrder() {
try {
const r = await fetch(API_URL + '/api/group-orders', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({
owner_id: user.id,
owner_name: user.first_name || 'Организатор'
})
});
const d = await r.json();
groupOrder = {
id: d.group_id,
owner_id: user.id,
members: [{
user_id: user.id,
name: user.first_name || 'Организатор',
items: [],
total: 0,
is_owner: true
}]
};
isGroupMode = true;
localStorage.setItem('group_order_id', d.group_id);
renderGroupOrderView();
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
} catch(e) {
alert('Ошибка создания группового заказа');
}
}

async function loadGroupOrderFromServer(groupId) {
try {
const r = await fetch(API_URL + '/api/group-orders/' + groupId);
if(r.ok) {
const data = await r.json();
groupOrder = {
id: data.id,
owner_id: data.owner_id,
members: data.members
};
isGroupMode = true;
return true;
}
} catch(e) {}
return false;
}

async function refreshGroupOrder() {
if(!groupOrder?.id) return;
try {
const r = await fetch(API_URL + '/api/group-orders/' + groupOrder.id);
if(r.ok) {
const data = await r.json();
groupOrder.members = data.members;
renderGroupOrderView();
}
} catch(e) {}
}

function renderGroupOrderView() {
const content = document.getElementById('group-order-content');
const shareLink = 'https://t.me/pinkpurple_miniapp_bot?startapp=group_' + groupOrder.id;
const allMembers = groupOrder.members || [];
const grandTotal = allMembers.reduce((s, m) => s + (m.total || 0), 0);
const isOwner = groupOrder.owner_id === user.id;
const myMember = allMembers.find(m => m.user_id === user.id);

let membersHtml = allMembers.map((m) => {
const itemsCount = (m.items || []).reduce((s, i) => s + i.qty, 0);
return `
<div class="group-member ${m.is_owner ? 'owner' : ''}">
<div class="group-member-avatar">${m.is_owner ? '👑' : '👤'}</div>
<div class="group-member-info">
<div class="group-member-name">${m.name}${m.user_id === user.id ? ' (вы)' : ''}</div>
<div class="group-member-items">${itemsCount > 0 ? itemsCount + ' поз.' : 'Пока ничего'}</div>
</div>
<div class="group-member-sum">${m.total > 0 ? m.total + '₽' : '—'}</div>
</div>
`;
}).join('');

let cartHtml = '';
allMembers.forEach(m => {
if(m.items && m.items.length > 0) {
cartHtml += `
<div class="group-cart-person">
<div class="group-cart-person-header">
<span class="group-cart-person-name">${m.name}</span>
<span class="group-cart-person-total">${m.total}₽</span>
</div>
${m.items.map(i => `
<div class="group-cart-item">
<span>${i.name} × ${i.qty}</span>
<span>${i.price * i.qty}₽</span>
</div>
`).join('')}
</div>
`;
}
});

content.innerHTML = `
${isOwner ? `
<div class="group-order-section">
<label class="group-order-label">Ссылка для друзей</label>
<div class="group-order-link">
<input type="text" value="${shareLink}" readonly id="group-link-input">
<button onclick="copyGroupLink()">📋</button>
</div>
<button class="btn-secondary" onclick="shareGroupLink()" style="width:100%;margin-top:12px">
📤 Поделиться в Telegram
</button>
</div>
` : ''}

<div class="group-order-section">
<label class="group-order-label">Участники (${allMembers.length})</label>
<div class="group-members">
${membersHtml}
</div>
<button class="btn-secondary" onclick="refreshGroupOrder()" style="width:100%;margin-top:12px">
🔄 Обновить
</button>
</div>

${cartHtml ? `
<div class="group-order-section">
<label class="group-order-label">Общая корзина</label>
${cartHtml}
</div>
` : ''}

<div class="group-total-row">
<span class="group-total-label">Общий итог</span>
<span class="group-total-sum">${grandTotal}₽</span>
</div>

<div class="group-actions">
<button class="btn-secondary" onclick="cancelGroupOrder()">${isOwner ? 'Отменить' : 'Выйти'}</button>
<button class="btn-primary" onclick="addMyItemsToGroup()" ${cart.length === 0 ? 'disabled' : ''}>
Добавить моё (${cart.reduce((s,x)=>s+x.qty,0)})
</button>
</div>

${isOwner && grandTotal > 0 ? `
<button class="btn-primary" onclick="submitGroupOrder()" style="width:100%;margin-top:12px;background:linear-gradient(135deg,var(--gold),var(--accent-pink))">
🎉 Оформить на ${grandTotal}₽
</button>
` : ''}
`;
}

function copyGroupLink() {
const input = document.getElementById('group-link-input');
input.select();
document.execCommand('copy');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
alert('Ссылка скопирована!');
}

function shareGroupLink() {
const link = 'https://t.me/pinkpurple_miniapp_bot?startapp=group_' + groupOrder.id;
const tgLink = 'https://t.me/share/url?url=' + encodeURIComponent(link) + '&text=' + encodeURIComponent('👥 Присоединяйся к групповому заказу в Pink Purple!');
window.open(tgLink, '_blank');
}

async function addMyItemsToGroup() {
if(cart.length === 0) return;
const myTotal = cart.reduce((s, x) => s + x.price * x.qty, 0);

try {
const r = await fetch(API_URL + '/api/group-orders/' + groupOrder.id + '/items', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({
user_id: user.id,
items: cart,
total: myTotal
})
});
if(r.ok) {
const d = await r.json();
groupOrder.members = d.group.members;
renderGroupOrderView();
playPluck();
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}
} catch(e) {
alert('Ошибка сохранения');
}
}

function cancelGroupOrder() {
if(!confirm('Отменить групповой заказ?')) return;
groupOrder = null;
isGroupMode = false;
localStorage.removeItem('group_order_id');
closeGroupOrderModal();
try{tg.HapticFeedback.notificationOccurred('warning')}catch(e){}
}

async function submitGroupOrder() {
try {
const r = await fetch(API_URL + '/api/group-orders/' + groupOrder.id + '/submit?user_id=' + user.id, {
method: 'POST'
});

if(!r.ok) {
const err = await r.json();
alert(err.detail || 'Ошибка');
return;
}

const d = await r.json();
document.getElementById('success-icon').textContent = '🎉';
document.getElementById('success-title').textContent = 'Групповой заказ оформлен!';
document.getElementById('success-text').textContent = '#' + d.order_id;
document.getElementById('success-details').textContent = 'Сумма: ' + d.total + '₽';

groupOrder = null;
isGroupMode = false;
cart = [];
localStorage.removeItem('group_order_id');
updateBadge();
closeGroupOrderModal();
showPage('page-success');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
} catch(e) {
alert('Ошибка сети');
}
}

// Проверка параметра startapp для присоединения к групповому заказу
async function checkGroupInvite() {
const startParam = tg.initDataUnsafe?.start_param || '';
if(startParam.startsWith('group_')) {
const groupId = startParam.replace('group_', '');
try {
// Сначала присоединяемся
const r = await fetch(API_URL + '/api/group-orders/' + groupId + '/join', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({
user_id: user.id,
user_name: user.first_name || 'Гость'
})
});
if(r.ok) {
const d = await r.json();
groupOrder = {
id: groupId,
owner_id: d.group.owner_id,
members: d.group.members
};
isGroupMode = true;
localStorage.setItem('group_order_id', groupId);
// Открываем модалку группового заказа
setTimeout(() => {
openGroupOrderModal();
}, 500);
}
} catch(e) {}
}
}

// Загрузка сохранённого группового заказа
async function loadGroupOrder() {
const savedId = localStorage.getItem('group_order_id');
if(savedId) {
const loaded = await loadGroupOrderFromServer(savedId);
if(!loaded) {
localStorage.removeItem('group_order_id');
}
}
// Проверяем приглашение
checkGroupInvite();
}

function addItemToCart(){
const item=selectedItem;
const size=item.sizes[item._selectedSize];
let name=item.name;
if(item.sizes.length>1)name+=' '+size.vol;
if(item.hasTemp)name+=' ('+getTempOptions()[item._selectedTemp].replace(/[🧊❄️🌡️☕]\s*/,'')+')';
if(item._selectedJuiceball>=0)name+=' +'+juiceballFlavors[item._selectedJuiceball];

const cartId=item.id+'_'+item._selectedSize+'_'+(item._selectedTemp||0)+'_'+(item._selectedJuiceball||-1);
const existing=cart.find(x=>x.id===cartId);
if(existing)existing.qty++;
else cart.push({id:cartId,name:name,price:item._selectedPrice,qty:1});

updateBadge();
closeItemModal();
playPluck();
try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function addToCart(id,name,price){const e=cart.find(x=>x.id===id);if(e)e.qty++;else cart.push({id,name,price,qty:1});updateBadge();playPluck();try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}}
function updateBadge(){const t=cart.reduce((s,x)=>s+x.qty,0);document.getElementById('cart-badge').textContent=t;document.getElementById('cart-fab').classList.toggle('show',t>0)}
function renderCart(){
document.getElementById('cart-items').innerHTML=cart.map(x=>'<div class="cart-item"><div class="cart-item-info"><div class="cart-item-name">'+x.name+'</div><div class="cart-item-price">'+x.price+'₽</div></div><div class="cart-item-controls"><button onclick="changeQty(\''+x.id+'\',-1)">−</button><span>'+x.qty+'</span><button onclick="changeQty(\''+x.id+'\',1)">+</button></div></div>').join('');
document.getElementById('cart-total').textContent=cart.reduce((s,x)=>s+x.price*x.qty,0)+'₽';
generatePickupTimes();
}
function generatePickupTimes(){
const sel=document.getElementById('pickup-time');
const now=new Date();
const opts=['<option value="">'+t('pickup_asap')+'</option>'];
for(let h=10;h<22;h++){
for(let m=0;m<60;m+=5){
const time=(h<10?'0':'')+h+':'+(m<10?'0':'')+m;
const slotDate=new Date();slotDate.setHours(h,m,0,0);
if(slotDate>now){opts.push('<option value="'+time+'">'+time+'</option>')}
}}
sel.innerHTML=opts.join('');
}
function changeQty(id,d){const x=cart.find(i=>i.id===id);if(x){x.qty+=d;if(x.qty<=0)cart=cart.filter(i=>i.id!==id)}renderCart();updateBadge()}
async function submitOrder(){
if(cart.length===0){alert('Корзина пуста');return;}
const total=cart.reduce((s,x)=>s+x.price*x.qty,0);
const pickupTime=document.getElementById('pickup-time').value;
try{
const r=await fetch(API_URL+'/api/orders',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username||null,first_name:user.first_name||'Гость',business_id:'pink_purple',items:cart,total:total,phone:userProfile?.phone||null,pickup_time:pickupTime||null})});
if(!r.ok){
const err=await r.text();
console.error('Order error:',r.status,err);
alert('Ошибка сервера: '+r.status);
return;
}
const d=await r.json();
document.getElementById('success-icon').textContent='✅';
document.getElementById('success-title').textContent='Заказ оформлен!';
document.getElementById('success-text').textContent='#'+d.order_id;
document.getElementById('success-details').textContent='Сумма: '+total+'₽'+(pickupTime?'\nК времени: '+pickupTime:'');
cart=[];updateBadge();showPage('page-success');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}catch(e){
console.error('Network error:',e);
alert('Ошибка сети. Проверьте подключение.');
}
}

// === BARBER ===
let masters=[];
function loadBarberData(){masters=[{id:'artem',name:'Артём',r:4.9},{id:'dmitry',name:'Дмитрий',r:4.8},{id:'rustam',name:'Рустам',r:4.9},{id:'vlad',name:'Владислав',r:4.7}];barberServices={haircut:{name:'✂️ Стрижки',items:[{id:'mens',name:'Мужская стрижка',price:1200,dur:45},{id:'kids',name:'Детская',price:800,dur:30}]},beard:{name:'🧔 Борода',items:[{id:'trim',name:'Моделирование',price:700,dur:30}]},combo:{name:'🎯 Комбо',items:[{id:'full',name:'Стрижка+Борода',price:1700,dur:75}]}};renderMasters();renderBarberServices()}
function renderMasters(){document.getElementById('masters-list').innerHTML=masters.map(m=>'<div class="master-card '+(selectedMaster?.id===m.id?'selected':'')+'" onclick="selectMaster(\''+m.id+'\')"><div class="master-avatar">💈</div><div class="master-name">'+m.name+'</div><div class="master-rating">⭐ '+m.r+'</div></div>').join('')}
function selectMaster(id){selectedMaster=masters.find(m=>m.id===id);renderMasters();updateBarberBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function renderBarberServices(){let h='';for(const[k,v]of Object.entries(barberServices)){h+=v.items.map(s=>'<div class="service-item '+(selectedBarberService?.id===s.id?'selected':'')+'" onclick="selectBarberSvc(\''+k+'\',\''+s.id+'\')"><div class="service-info"><h3>'+s.name+'</h3><span>'+s.dur+' мин</span></div><div class="service-price">'+s.price+'₽</div></div>').join('')}document.getElementById('barber-services').innerHTML=h}
function selectBarberSvc(k,id){selectedBarberService=barberServices[k].items.find(s=>s.id===id);renderBarberServices();updateBarberBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function updateBarberBtn(){document.getElementById('barber-next-btn').disabled=!(selectedMaster&&selectedBarberService)}
async function goToBarberDateTime(){selectedBarberDate=null;selectedBarberTime=null;await renderBarberDates();showPage('page-barber-datetime')}
async function renderBarberDates(){const dates=[];const wd=['Вс','Пн','Вт','Ср','Чт','Пт','Сб'];const t=new Date();for(let i=0;i<14;i++){const d=new Date(t);d.setDate(t.getDate()+i);dates.push({date:d.toISOString().split('T')[0],day:d.getDate(),wd:wd[d.getDay()],today:i===0})}document.getElementById('barber-dates').innerHTML=dates.map(d=>'<div class="date-chip '+(selectedBarberDate===d.date?'selected':'')+'" onclick="selectBarberDate(\''+d.date+'\')"><div class="date-chip-day">'+d.day+'</div><div class="date-chip-weekday">'+(d.today?'Сегодня':d.wd)+'</div></div>').join('');if(!selectedBarberDate)selectBarberDate(dates[0].date)}
async function selectBarberDate(d){selectedBarberDate=d;selectedBarberTime=null;document.getElementById('barber-book-btn').disabled=true;renderBarberDates();await loadBarberSlots();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadBarberSlots(){const all=['10:00','10:30','11:00','11:30','12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00','19:30','20:00'];let av=all;try{const r=await fetch(API_URL+'/api/portos/slots/'+selectedMaster.id+'/'+selectedBarberDate);if(r.ok){const d=await r.json();av=d.slots||all}}catch(e){}if(av.length===0){document.getElementById('barber-times').innerHTML='<div class="no-slots">Нет доступного времени</div>';return}document.getElementById('barber-times').innerHTML=av.map(s=>'<div class="time-slot '+(selectedBarberTime===s?'selected':'')+'" onclick="selectBarberTime(\''+s+'\')">'+s+'</div>').join('')}
function selectBarberTime(t){selectedBarberTime=t;loadBarberSlots();document.getElementById('barber-book-btn').disabled=false;try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function submitBarberBooking(){if(!selectedMaster||!selectedBarberService||!selectedBarberDate||!selectedBarberTime)return;try{await fetch(API_URL+'/api/bookings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username,first_name:user.first_name,business_id:'portos',service_id:selectedBarberService.id,service_name:selectedBarberService.name,service_price:selectedBarberService.price,master_id:selectedMaster.id,master_name:selectedMaster.name,date:selectedBarberDate,time:selectedBarberTime,phone:userProfile?.phone})});const dd=new Date(selectedBarberDate).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});document.getElementById('success-icon').textContent='💈';document.getElementById('success-title').textContent='Вы записаны!';document.getElementById('success-text').textContent=selectedBarberService.name+' у '+selectedMaster.name;document.getElementById('success-details').textContent=dd+' в '+selectedBarberTime;selectedMaster=null;selectedBarberService=null;selectedBarberDate=null;selectedBarberTime=null;showPage('page-success');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}}catch(e){alert('Ошибка')}}

// === CLINIC ===
async function loadClinicBranches(){try{const r=await fetch(API_URL+'/api/clinic/branches');if(r.ok){branches=await r.json()}else{branches=FALLBACK_BRANCHES}}catch(e){branches=FALLBACK_BRANCHES}renderBranches()}
function renderBranches(){document.getElementById('branch-list').innerHTML=branches.map(b=>'<div class="branch-card" onclick="selectBranch(\''+b.id+'\')"><div class="branch-name">'+b.name+'</div><div class="branch-address">📍 '+b.address+'</div><div class="branch-hours">🕐 '+b.work_hours+'</div></div>').join('')}
async function selectBranch(id){selectedBranch=branches.find(b=>b.id===id);selectedCategory=null;selectedDoctor=null;selectedClinicService=null;document.getElementById('clinic-branch-title').textContent=selectedBranch.name;await loadBranchServices();showPage('page-clinic-categories');try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadBranchServices(){try{const r=await fetch(API_URL+'/api/clinic/branch/'+selectedBranch.id+'/services');if(r.ok){clinicServices=await r.json()}else{clinicServices=FALLBACK_SERVICES[selectedBranch.id]||{}}}catch(e){clinicServices=FALLBACK_SERVICES[selectedBranch.id]||{}}renderCategories()}
function renderCategories(){const cats=Object.entries(clinicServices);document.getElementById('category-list').innerHTML=cats.map(([k,v])=>'<div class="category-card" onclick="selectCategory(\''+k+'\')"><div class="category-icon">'+v.name.split(' ')[0]+'</div><div class="category-name">'+v.name.substring(v.name.indexOf(' ')+1)+'</div></div>').join('')}
async function selectCategory(catKey){selectedCategory=clinicServices[catKey];selectedDoctor=null;selectedClinicService=null;document.getElementById('clinic-category-title').textContent=selectedCategory.name;await loadCategoryDoctors();renderClinicServices();renderDoctors();showPage('page-clinic-doctor');try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadCategoryDoctors(){const specialty=selectedCategory.specialty;try{const r=await fetch(API_URL+'/api/clinic/branch/'+selectedBranch.id+'/doctors?specialty='+encodeURIComponent(specialty));if(r.ok){categoryDoctors=await r.json()}else{const all=FALLBACK_DOCTORS[selectedBranch.id]||[];categoryDoctors=all.filter(d=>d.specialty===specialty)}}catch(e){const all=FALLBACK_DOCTORS[selectedBranch.id]||[];categoryDoctors=all.filter(d=>d.specialty===specialty)}}
function renderClinicServices(){document.getElementById('clinic-services').innerHTML=selectedCategory.items.map(s=>'<div class="service-item '+(selectedClinicService?.id===s.id?'selected':'')+'" onclick="selectClinicService(\''+s.id+'\')"><div class="service-info"><h3>'+s.name+'</h3><span>'+s.duration+' мин</span></div><div class="service-price">'+s.price+'₽</div></div>').join('')}
function selectClinicService(id){selectedClinicService=selectedCategory.items.find(s=>s.id===id);renderClinicServices();updateClinicBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function renderDoctors(){document.getElementById('doctors-list').innerHTML=categoryDoctors.map(d=>'<div class="doctor-card '+(selectedDoctor?.id===d.id?'selected':'')+'" onclick="selectDoctor(\''+d.id+'\')"><div class="doctor-avatar">👨‍⚕️</div><div class="doctor-name">'+d.name+'</div><div class="doctor-specialty">'+d.experience+'</div><div class="doctor-rating">⭐ '+d.rating+'</div></div>').join('')}
function selectDoctor(id){selectedDoctor=categoryDoctors.find(d=>d.id===id);renderDoctors();updateClinicBtn();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
function updateClinicBtn(){document.getElementById('clinic-next-btn').disabled=!(selectedDoctor&&selectedClinicService)}
async function goToClinicDateTime(){selectedClinicDate=null;selectedClinicTime=null;await renderClinicDates();showPage('page-clinic-datetime')}
async function renderClinicDates(){const dates=[];const wd=['Вс','Пн','Вт','Ср','Чт','Пт','Сб'];const t=new Date();for(let i=0;i<14;i++){const d=new Date(t);d.setDate(t.getDate()+i);dates.push({date:d.toISOString().split('T')[0],day:d.getDate(),wd:wd[d.getDay()],today:i===0})}document.getElementById('clinic-dates').innerHTML=dates.map(d=>'<div class="date-chip '+(selectedClinicDate===d.date?'selected':'')+'" onclick="selectClinicDate(\''+d.date+'\')"><div class="date-chip-day">'+d.day+'</div><div class="date-chip-weekday">'+(d.today?'Сегодня':d.wd)+'</div></div>').join('');if(!selectedClinicDate)selectClinicDate(dates[0].date)}
async function selectClinicDate(d){selectedClinicDate=d;selectedClinicTime=null;document.getElementById('clinic-book-btn').disabled=true;renderClinicDates();await loadClinicSlots();try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function loadClinicSlots(){const all=['09:00','09:30','10:00','10:30','11:00','11:30','12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00'];let av=all;try{const r=await fetch(API_URL+'/api/clinic/slots/'+selectedBranch.id+'/'+selectedDoctor.id+'/'+selectedClinicDate);if(r.ok){const d=await r.json();av=d.slots||all}}catch(e){}const container=document.getElementById('clinic-times-container');if(av.length===0){container.innerHTML='<div class="no-slots">Нет доступного времени</div>';return}container.innerHTML='<div class="times-list" id="clinic-times">'+av.map(s=>'<div class="time-slot '+(selectedClinicTime===s?'selected':'')+'" onclick="selectClinicTime(\''+s+'\')">'+s+'</div>').join('')+'</div>'}
function selectClinicTime(t){selectedClinicTime=t;loadClinicSlots();document.getElementById('clinic-book-btn').disabled=false;try{tg.HapticFeedback.selectionChanged()}catch(e){}}
async function submitClinicBooking(){if(!selectedBranch||!selectedDoctor||!selectedClinicService||!selectedClinicDate||!selectedClinicTime)return;try{await fetch(API_URL+'/api/bookings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,username:user.username,first_name:user.first_name,business_id:'clinic',branch_id:selectedBranch.id,service_id:selectedClinicService.id,service_name:selectedClinicService.name,service_price:selectedClinicService.price,master_id:selectedDoctor.id,master_name:selectedDoctor.name,date:selectedClinicDate,time:selectedClinicTime,phone:userProfile?.phone})});const dd=new Date(selectedClinicDate).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});document.getElementById('success-icon').textContent='🏥';document.getElementById('success-title').textContent='Вы записаны!';document.getElementById('success-text').textContent=selectedClinicService.name;document.getElementById('success-details').textContent='Врач: '+selectedDoctor.name+'\n'+selectedBranch.name+'\n'+dd+' в '+selectedClinicTime;selectedBranch=null;selectedCategory=null;selectedDoctor=null;selectedClinicService=null;selectedClinicDate=null;selectedClinicTime=null;showPage('page-success');try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}}catch(e){alert('Ошибка')}}

// === ЧЕРНОВАР ===
function initChernovar(){
generateChernovarDates();
generateChernovarTimes();
document.getElementById('chernovar-name').value=userProfile?.first_name||user.first_name||'';
checkChernovarForm();
}

function generateChernovarDates(){
const sel=document.getElementById('chernovar-date');
const wd=['Вс','Пн','Вт','Ср','Чт','Пт','Сб'];
const opts=[];
const today=new Date();
for(let i=0;i<14;i++){
const d=new Date(today);d.setDate(today.getDate()+i);
const dateStr=d.toISOString().split('T')[0];
const dayNum=d.getDate();
const monthNames=['янв','фев','мар','апр','май','июн','июл','авг','сен','окт','ноя','дек'];
const display=dayNum+' '+monthNames[d.getMonth()]+' ('+wd[d.getDay()]+')';
opts.push('<option value="'+dateStr+'" data-day="'+d.getDay()+'">'+display+'</option>');
}
sel.innerHTML=opts.join('');
}

function generateChernovarTimes(){
const sel=document.getElementById('chernovar-time');
const dateInput=document.getElementById('chernovar-date');
const selectedDate=dateInput.value;
const selectedOption=dateInput.options[dateInput.selectedIndex];
const dayOfWeek=parseInt(selectedOption?.dataset.day||new Date().getDay());

// Пт(5) и Сб(6): 11:00-01:00, иначе 11:00-00:00
// Бронь закрывается за 2 часа до закрытия
const isFriSat=(dayOfWeek===5||dayOfWeek===6);
const lastBookingHour=isFriSat?23:22; // Пт-Сб до 23:00, Вс-Чт до 22:00

const opts=['<option value="">Выберите время</option>'];
const now=new Date();
const today=now.toISOString().split('T')[0];
const currentHour=now.getHours();
const currentMin=now.getMinutes();

for(let h=11;h<=lastBookingHour;h++){
for(let m=0;m<60;m+=30){
if(h===lastBookingHour&&m>0)continue; // Последний слот ровно в lastBookingHour:00
const t=(h<10?'0':'')+h+':'+(m<10?'0':'')+m;
// Для сегодня - только будущее время
if(selectedDate===today){
if(h<currentHour||(h===currentHour&&m<=currentMin))continue;
}
opts.push('<option value="'+t+'">'+t+'</option>');
}
}
sel.innerHTML=opts.join('');
}

function checkChernovarForm(){
const name=document.getElementById('chernovar-name').value.trim();
const guests=document.getElementById('chernovar-guests').value;
const date=document.getElementById('chernovar-date').value;
const time=document.getElementById('chernovar-time').value;
document.getElementById('chernovar-book-btn').disabled=!(name&&guests&&date&&time);
}

async function submitChernovarBooking(){
const name=document.getElementById('chernovar-name').value.trim();
const guests=document.getElementById('chernovar-guests').value;
const date=document.getElementById('chernovar-date').value;
const time=document.getElementById('chernovar-time').value;
const comment=document.getElementById('chernovar-comment').value.trim();

try{
const r=await fetch(API_URL+'/api/reservations',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
user_id:user.id,
username:user.username,
first_name:user.first_name,
business_id:'chernovar',
guest_name:name,
guests:guests,
date:date,
time:time,
comment:comment,
phone:userProfile?.phone
})
});
const d=await r.json();
const dd=new Date(date).toLocaleDateString('ru-RU',{day:'numeric',month:'long'});
document.getElementById('success-icon').textContent='🍺';
document.getElementById('success-title').textContent='Столик забронирован!';
document.getElementById('success-text').textContent='На имя: '+name;
document.getElementById('success-details').textContent=dd+' в '+time+'\nГостей: '+guests+'\nЧерновар, Профсоюзная 23/12';
showPage('page-success');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}catch(e){alert('Ошибка бронирования')}
}

// Инициализация при открытии страницы
const origShowPage=showPage;
showPage=function(id){
origShowPage(id);
if(id==='page-chernovar')initChernovar();
};

// === BUBBLE POP GAME ===
let gameActive = false;
let gameScore = 0;
let gameBestScore = parseInt(localStorage.getItem('bubble_best') || '0');
let gamePopped = 0;
let gameMissed = 0;
let gameCombo = 0;
let gameMaxCombo = 0;
let bubbleInterval = null;
let bubbles = [];
let lastPopTime = 0;

const bubbleColors = [
'linear-gradient(135deg, #ff6b9d, #ff8a80)',
'linear-gradient(135deg, #c44cff, #e040fb)',
'linear-gradient(135deg, #00d4ff, #00bcd4)',
'linear-gradient(135deg, #ffdf00, #ffc107)',
'linear-gradient(135deg, #00e676, #69f0ae)',
'linear-gradient(135deg, #ff5722, #ff7043)',
];

const bubbleEmojis = ['🫧', '💜', '💖', '⭐', '✨', '🌟', '💫', '🎀', '🍬', '🧁'];

function updateAllBestScores() {
document.getElementById('best-bubble').textContent = '🏆 ' + (localStorage.getItem('bubble_best') || 0);
document.getElementById('best-tap').textContent = '🏆 ' + (localStorage.getItem('tap_best') || 0);
document.getElementById('best-memory').textContent = '🏆 ' + (localStorage.getItem('memory_best') || 0);
document.getElementById('best-color').textContent = '🏆 ' + (localStorage.getItem('color_best') || 0);
document.getElementById('best-math').textContent = '🏆 ' + (localStorage.getItem('math_best') || 0);
}

function startBubbleGame() {
gameActive = true;
gameScore = 0;
gamePopped = 0;
gameMissed = 0;
gameCombo = 0;
gameMaxCombo = 0;
bubbles = [];
lastPopTime = Date.now();

document.getElementById('game-container').classList.add('show');
document.getElementById('game-over').classList.remove('show');
document.getElementById('game-area').innerHTML = '<div class="combo-display" id="combo-display">COMBO!</div>';

updateGameStats();
spawnBubble();

let spawnRate = 1200;
bubbleInterval = setInterval(() => {
if(!gameActive) return;
spawnBubble();
spawnRate = Math.max(400, spawnRate - 10);
}, spawnRate);

setTimeout(() => {
clearInterval(bubbleInterval);
bubbleInterval = setInterval(() => {
if(!gameActive) return;
spawnBubble();
}, 800);
}, 10000);

setTimeout(() => {
clearInterval(bubbleInterval);
bubbleInterval = setInterval(() => {
if(!gameActive) return;
spawnBubble();
if(Math.random() > 0.5) spawnBubble();
}, 600);
}, 25000);

try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function spawnBubble() {
if(!gameActive) return;

const area = document.getElementById('game-area');
const rect = area.getBoundingClientRect();
const size = 50 + Math.random() * 40;
const x = Math.random() * (rect.width - size);
const y = Math.random() * (rect.height - size - 100);

const bubble = document.createElement('div');
bubble.className = 'bubble';
bubble.style.width = size + 'px';
bubble.style.height = size + 'px';
bubble.style.left = x + 'px';
bubble.style.top = y + 'px';
bubble.style.background = bubbleColors[Math.floor(Math.random() * bubbleColors.length)];
bubble.textContent = bubbleEmojis[Math.floor(Math.random() * bubbleEmojis.length)];
bubble.style.fontSize = (size * 0.4) + 'px';

const lifetime = 2500 + Math.random() * 1500;
const timeout = setTimeout(() => {
if(bubble.parentNode && !bubble.classList.contains('bubble-pop')) {
bubble.remove();
if(gameActive) {
gameMissed++;
gameCombo = 0;
updateGameStats();
if(gameMissed >= 10) endBubbleGame();
}
}
}, lifetime);

bubble.addEventListener('click', (e) => {
e.stopPropagation();
popBubble(bubble, timeout);
});

bubble.addEventListener('touchstart', (e) => {
e.preventDefault();
popBubble(bubble, timeout);
}, {passive: false});

area.appendChild(bubble);
}

function popBubble(bubble, timeout) {
if(!gameActive || bubble.classList.contains('bubble-pop')) return;

clearTimeout(timeout);
bubble.classList.add('bubble-pop');

const now = Date.now();
if(now - lastPopTime < 500) {
gameCombo++;
if(gameCombo > gameMaxCombo) gameMaxCombo = gameCombo;
if(gameCombo >= 3 && gameCombo % 3 === 0) showCombo(gameCombo);
} else {
gameCombo = 1;
}
lastPopTime = now;

gameScore += 10 + (gameCombo * 2);
gamePopped++;
updateGameStats();
playPluck();
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}
setTimeout(() => bubble.remove(), 300);
}

function showCombo(combo) {
const el = document.getElementById('combo-display');
el.textContent = combo + 'x COMBO!';
el.classList.remove('show');
void el.offsetWidth;
el.classList.add('show');
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

function updateGameStats() {
document.getElementById('game-score').textContent = gameScore;
document.getElementById('stat-popped').textContent = gamePopped;
document.getElementById('stat-combo').textContent = gameMaxCombo;
document.getElementById('stat-missed').textContent = gameMissed;
}

function endBubbleGame() {
gameActive = false;
clearInterval(bubbleInterval);
if(gameScore > gameBestScore) {
gameBestScore = gameScore;
localStorage.setItem('bubble_best', gameBestScore);
}
document.getElementById('final-score').textContent = gameScore;
document.getElementById('final-best').textContent = 'Лучший: ' + gameBestScore;
document.getElementById('game-over').classList.add('show');
updateAllBestScores();
try{tg.HapticFeedback.notificationOccurred('error')}catch(e){}
}

function restartGame() {
document.getElementById('game-over').classList.remove('show');
startBubbleGame();
}

function exitGame() {
gameActive = false;
clearInterval(bubbleInterval);
document.getElementById('game-container').classList.remove('show');
updateAllBestScores();
}

// === TAP SPEED GAME ===
let tapCount = 0;
let tapTime = 10;
let tapInterval = null;
let tapStarted = false;
let tapBest = parseInt(localStorage.getItem('tap_best') || '0');

function startTapGame() {
tapCount = 0;
tapTime = 10;
tapStarted = false;
document.getElementById('tap-container').classList.add('show');
document.getElementById('tap-over').classList.remove('show');
document.getElementById('tap-counter').textContent = '0';
document.getElementById('tap-time').textContent = '10';
document.getElementById('tap-status').textContent = 'Нажми чтобы начать!';
try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function handleTap() {
if(!tapStarted) {
tapStarted = true;
document.getElementById('tap-status').textContent = 'ЖМИ БЫСТРЕЕ!';
tapInterval = setInterval(() => {
tapTime--;
document.getElementById('tap-time').textContent = tapTime;
if(tapTime <= 0) endTapGame();
}, 1000);
}
tapCount++;
document.getElementById('tap-counter').textContent = tapCount;
playPluck();
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}
}

function endTapGame() {
clearInterval(tapInterval);
if(tapCount > tapBest) {
tapBest = tapCount;
localStorage.setItem('tap_best', tapBest);
}
document.getElementById('tap-final').textContent = tapCount + ' нажатий';
document.getElementById('tap-best').textContent = 'Лучший: ' + tapBest;
document.getElementById('tap-over').classList.add('show');
updateAllBestScores();
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

function restartTapGame() {
document.getElementById('tap-over').classList.remove('show');
startTapGame();
}

function exitTapGame() {
clearInterval(tapInterval);
document.getElementById('tap-container').classList.remove('show');
updateAllBestScores();
}

// === MEMORY GAME ===
let memoryLevel = 1;
let memorySequence = '';
let memoryUserInput = '';
let memoryPhase = 'show';
let memoryBest = parseInt(localStorage.getItem('memory_best') || '0');

function startMemoryGame() {
memoryLevel = 1;
document.getElementById('memory-container').classList.add('show');
document.getElementById('memory-over').classList.remove('show');
nextMemoryRound();
try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function nextMemoryRound() {
memoryPhase = 'show';
memoryUserInput = '';
memorySequence = '';
for(let i = 0; i < memoryLevel + 2; i++) {
memorySequence += Math.floor(Math.random() * 9) + 1;
}

document.getElementById('memory-level').textContent = memoryLevel;
document.getElementById('memory-status').textContent = 'Запомни!';
document.getElementById('memory-number').textContent = memorySequence;
document.getElementById('memory-user-input').textContent = '';
document.getElementById('memory-input').style.display = 'none';

setTimeout(() => {
if(memoryPhase === 'show') {
memoryPhase = 'input';
document.getElementById('memory-status').textContent = 'Введи числа:';
document.getElementById('memory-number').textContent = '';
document.getElementById('memory-input').style.display = 'grid';
}
}, 1500 + (memoryLevel * 300));
}

function memoryPress(num) {
if(memoryPhase !== 'input') return;
memoryUserInput += num;
document.getElementById('memory-user-input').textContent = memoryUserInput;
playPluck();
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}

if(memoryUserInput.length === memorySequence.length) {
if(memoryUserInput === memorySequence) {
memoryLevel++;
document.getElementById('memory-status').textContent = '✓ Правильно!';
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
setTimeout(nextMemoryRound, 1000);
} else {
endMemoryGame();
}
}
}

function endMemoryGame() {
const score = memoryLevel - 1;
if(score > memoryBest) {
memoryBest = score;
localStorage.setItem('memory_best', memoryBest);
}
document.getElementById('memory-final').textContent = 'Уровень ' + score;
document.getElementById('memory-best').textContent = 'Лучший: ' + memoryBest;
document.getElementById('memory-over').classList.add('show');
updateAllBestScores();
try{tg.HapticFeedback.notificationOccurred('error')}catch(e){}
}

function restartMemoryGame() {
document.getElementById('memory-over').classList.remove('show');
startMemoryGame();
}

function exitMemoryGame() {
document.getElementById('memory-container').classList.remove('show');
updateAllBestScores();
}

// === COLOR MATCH GAME ===
let colorScore = 0;
let colorBest = parseInt(localStorage.getItem('color_best') || '0');
let colorTimer = 100;
let colorInterval = null;
let currentColorCorrect = false;

const colorWords = [
{word: 'КРАСНЫЙ', color: '#ff4757'},
{word: 'СИНИЙ', color: '#3498db'},
{word: 'ЗЕЛЁНЫЙ', color: '#2ed573'},
{word: 'ЖЁЛТЫЙ', color: '#ffc107'}
];

function startColorGame() {
colorScore = 0;
colorTimer = 100;
document.getElementById('color-container').classList.add('show');
document.getElementById('color-over').classList.remove('show');
document.getElementById('color-score').textContent = '0';
nextColorRound();

colorInterval = setInterval(() => {
colorTimer -= 2;
document.getElementById('color-timer-fill').style.width = colorTimer + '%';
if(colorTimer <= 0) endColorGame();
}, 100);

try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function nextColorRound() {
const wordObj = colorWords[Math.floor(Math.random() * colorWords.length)];
const colorObj = colorWords[Math.floor(Math.random() * colorWords.length)];
const match = Math.random() > 0.5;

const word = document.getElementById('color-word');
word.textContent = wordObj.word;

if(match) {
word.style.color = wordObj.color;
currentColorCorrect = true;
} else {
const otherColors = colorWords.filter(c => c.color !== wordObj.color);
word.style.color = otherColors[Math.floor(Math.random() * otherColors.length)].color;
currentColorCorrect = false;
}
}

function colorAnswer(answer) {
if(answer === currentColorCorrect) {
colorScore++;
colorTimer = Math.min(100, colorTimer + 10);
document.getElementById('color-score').textContent = colorScore;
playPluck();
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}
nextColorRound();
} else {
endColorGame();
}
}

function endColorGame() {
clearInterval(colorInterval);
if(colorScore > colorBest) {
colorBest = colorScore;
localStorage.setItem('color_best', colorBest);
}
document.getElementById('color-final').textContent = colorScore;
document.getElementById('color-best').textContent = 'Лучший: ' + colorBest;
document.getElementById('color-over').classList.add('show');
updateAllBestScores();
try{tg.HapticFeedback.notificationOccurred('error')}catch(e){}
}

function restartColorGame() {
document.getElementById('color-over').classList.remove('show');
startColorGame();
}

function exitColorGame() {
clearInterval(colorInterval);
document.getElementById('color-container').classList.remove('show');
updateAllBestScores();
}

// === MATH SPRINT GAME ===
let mathScore = 0;
let mathBest = parseInt(localStorage.getItem('math_best') || '0');
let mathTimer = 100;
let mathInterval = null;
let mathStreak = 0;
let mathCorrectAnswer = 0;

function startMathGame() {
mathScore = 0;
mathTimer = 100;
mathStreak = 0;
document.getElementById('math-container').classList.add('show');
document.getElementById('math-over').classList.remove('show');
document.getElementById('math-score').textContent = '0';
document.getElementById('math-streak').textContent = 'Серия: 0';
nextMathProblem();

mathInterval = setInterval(() => {
mathTimer -= 1;
document.getElementById('math-timer-fill').style.width = mathTimer + '%';
if(mathTimer <= 0) endMathGame();
}, 100);

try{tg.HapticFeedback.impactOccurred('medium')}catch(e){}
}

function nextMathProblem() {
const ops = ['+', '-', '×'];
const op = ops[Math.floor(Math.random() * ops.length)];
let a, b, answer;

if(op === '+') {
a = Math.floor(Math.random() * 50) + 1;
b = Math.floor(Math.random() * 50) + 1;
answer = a + b;
} else if(op === '-') {
a = Math.floor(Math.random() * 50) + 10;
b = Math.floor(Math.random() * a);
answer = a - b;
} else {
a = Math.floor(Math.random() * 12) + 1;
b = Math.floor(Math.random() * 12) + 1;
answer = a * b;
}

mathCorrectAnswer = answer;
document.getElementById('math-problem').textContent = a + ' ' + op + ' ' + b;

// Генерируем варианты ответов
const answers = [answer];
while(answers.length < 4) {
const wrong = answer + Math.floor(Math.random() * 20) - 10;
if(wrong !== answer && wrong > 0 && !answers.includes(wrong)) {
answers.push(wrong);
}
}

// Перемешиваем
answers.sort(() => Math.random() - 0.5);

document.getElementById('math-answers').innerHTML = answers.map(a => 
'<button class="math-btn" onclick="mathAnswer(' + a + ')">' + a + '</button>'
).join('');
}

function mathAnswer(answer) {
const buttons = document.querySelectorAll('.math-btn');
buttons.forEach(btn => {
if(parseInt(btn.textContent) === mathCorrectAnswer) {
btn.classList.add('correct');
} else if(parseInt(btn.textContent) === answer && answer !== mathCorrectAnswer) {
btn.classList.add('wrong');
}
});

if(answer === mathCorrectAnswer) {
mathStreak++;
mathScore += 10 + mathStreak;
mathTimer = Math.min(100, mathTimer + 8);
document.getElementById('math-score').textContent = mathScore;
document.getElementById('math-streak').textContent = 'Серия: ' + mathStreak;
playPluck();
try{tg.HapticFeedback.impactOccurred('light')}catch(e){}
} else {
mathStreak = 0;
mathTimer = Math.max(0, mathTimer - 15);
document.getElementById('math-streak').textContent = 'Серия: 0';
try{tg.HapticFeedback.notificationOccurred('error')}catch(e){}
}

setTimeout(nextMathProblem, 300);
}

function endMathGame() {
clearInterval(mathInterval);
if(mathScore > mathBest) {
mathBest = mathScore;
localStorage.setItem('math_best', mathBest);
}
document.getElementById('math-final').textContent = mathScore;
document.getElementById('math-best').textContent = 'Лучший: ' + mathBest;
document.getElementById('math-over').classList.add('show');
updateAllBestScores();
try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

function restartMathGame() {
document.getElementById('math-over').classList.remove('show');
startMathGame();
}

function exitMathGame() {
clearInterval(mathInterval);
document.getElementById('math-container').classList.remove('show');
updateAllBestScores();
}

// Загрузка лучших счётов при старте
updateAllBestScores();

// === ПАНЕЛЬ ВЛАДЕЛЬЦА ===
const OWNER_IDS = [736051965]; // ID владельцев
let ownerPeriod = 'today';
let ownerTab = 'orders';
let ownerData = {
  orders: [],
  isOpen: true
};

function isOwner() {
  return OWNER_IDS.includes(user?.id);
}

function openOwnerPanel() {
  if(!isOwner()) {
    alert('Доступ только для владельцев');
    return;
  }
  showPage('page-owner');
  loadOwnerData();
}

async function loadOwnerData() {
  // Загружаем данные с сервера
  try {
    const r = await fetch(API_URL + '/api/orders/business/pink_purple');
    if(r.ok) {
      ownerData.orders = await r.json();
    }
  } catch(e) {
    // Демо-данные если сервер недоступен
    ownerData.orders = generateDemoOrders();
  }
  renderOwnerPanel();
}

function generateDemoOrders() {
  const items = ['Пинк Матча L', 'Смузи Манго', 'Латте', 'Мохито Клубника', 'Милкшейк'];
  const names = ['Анна', 'Михаил', 'Елена', 'Дмитрий', 'София'];
  const statuses = ['new', 'preparing', 'ready', 'completed'];
  const orders = [];
  
  for(let i = 0; i < 20; i++) {
    const date = new Date();
    date.setHours(date.getHours() - Math.floor(Math.random() * 48));
    orders.push({
      order_id: 'ORD' + String(100 + i).padStart(5, '0'),
      first_name: names[Math.floor(Math.random() * names.length)],
      items: [
        {name: items[Math.floor(Math.random() * items.length)], qty: 1, price: 350 + Math.floor(Math.random() * 200)},
        ...(Math.random() > 0.5 ? [{name: items[Math.floor(Math.random() * items.length)], qty: 1, price: 300}] : [])
      ],
      total: 350 + Math.floor(Math.random() * 500),
      status: statuses[Math.floor(Math.random() * statuses.length)],
      created_at: date.toISOString()
    });
  }
  return orders;
}

function setOwnerPeriod(period) {
  ownerPeriod = period;
  document.querySelectorAll('.owner-period-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`.owner-period-btn[onclick*="${period}"]`).classList.add('active');
  renderOwnerPanel();
}

function setOwnerTab(tab) {
  ownerTab = tab;
  document.querySelectorAll('.owner-tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.owner-tab[onclick*="${tab}"]`).classList.add('active');
  document.querySelectorAll('.owner-tab-content').forEach(c => c.style.display = 'none');
  document.getElementById('owner-tab-' + tab).style.display = 'block';
  
  // Инициализируем расписание при первом открытии
  if(tab === 'schedule' && !ownerSelectedMaster) {
    initOwnerSchedule();
  }
}

function renderOwnerPanel() {
  const orders = filterOrdersByPeriod(ownerData.orders);
  
  // Статистика
  const totalOrders = orders.length;
  const revenue = orders.reduce((s, o) => s + (o.total || 0), 0);
  const avgCheck = totalOrders > 0 ? Math.round(revenue / totalOrders) : 0;
  const uniqueClients = new Set(orders.map(o => o.first_name)).size;
  
  document.getElementById('owner-orders-count').textContent = totalOrders;
  document.getElementById('owner-revenue').textContent = formatPrice(revenue);
  document.getElementById('owner-avg-check').textContent = formatPrice(avgCheck);
  document.getElementById('owner-clients').textContent = uniqueClients;
  
  // Заказы по статусам
  renderOrdersByStatus(orders);
  
  // Аналитика
  renderAnalytics(orders);
  
  // Меню
  renderOwnerMenu();
}

function filterOrdersByPeriod(orders) {
  const now = new Date();
  const start = new Date();
  
  if(ownerPeriod === 'today') {
    start.setHours(0,0,0,0);
  } else if(ownerPeriod === 'week') {
    start.setDate(now.getDate() - 7);
  } else if(ownerPeriod === 'month') {
    start.setMonth(now.getMonth() - 1);
  } else {
    start.setFullYear(now.getFullYear() - 1);
  }
  
  return orders.filter(o => new Date(o.created_at) >= start);
}

function renderOrdersByStatus(orders) {
  const newOrders = orders.filter(o => o.status === 'new');
  const preparing = orders.filter(o => o.status === 'preparing');
  const ready = orders.filter(o => o.status === 'ready');
  
  document.getElementById('owner-new-orders').innerHTML = newOrders.length > 0 
    ? newOrders.map(o => renderOwnerOrder(o)).join('')
    : '<div class="owner-empty"><div class="owner-empty-text">Нет новых заказов</div></div>';
    
  document.getElementById('owner-preparing-orders').innerHTML = preparing.length > 0
    ? preparing.map(o => renderOwnerOrder(o)).join('')
    : '<div class="owner-empty"><div class="owner-empty-text">Нет заказов в работе</div></div>';
    
  document.getElementById('owner-ready-orders').innerHTML = ready.length > 0
    ? ready.map(o => renderOwnerOrder(o)).join('')
    : '<div class="owner-empty"><div class="owner-empty-text">Нет готовых заказов</div></div>';
}

function renderOwnerOrder(order) {
  const time = new Date(order.created_at);
  const timeStr = time.toLocaleTimeString('ru', {hour: '2-digit', minute: '2-digit'});
  const itemsStr = order.items?.map(i => i.name + (i.qty > 1 ? ' ×' + i.qty : '')).join(', ') || '';
  
  return `
    <div class="owner-order-item">
      <div class="owner-order-status ${order.status}"></div>
      <div class="owner-order-info">
        <div class="owner-order-id">#${order.order_id}</div>
        <div class="owner-order-details">${order.first_name} • ${itemsStr}</div>
      </div>
      <div class="owner-order-time">${timeStr}</div>
      <div class="owner-order-sum">${order.total}₽</div>
      <div class="owner-order-actions">
        ${order.status === 'new' ? '<button class="owner-order-btn primary" onclick="ownerUpdateStatus(\'' + order.order_id + '\', \'preparing\')">Готовить</button>' : ''}
        ${order.status === 'preparing' ? '<button class="owner-order-btn primary" onclick="ownerUpdateStatus(\'' + order.order_id + '\', \'ready\')">Готово</button>' : ''}
        ${order.status === 'ready' ? '<button class="owner-order-btn primary" onclick="ownerUpdateStatus(\'' + order.order_id + '\', \'completed\')">Выдано</button>' : ''}
      </div>
    </div>
  `;
}

function ownerUpdateStatus(orderId, status) {
  const order = ownerData.orders.find(o => o.order_id === orderId);
  if(order) {
    order.status = status;
    renderOwnerPanel();
    playPluck();
    try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
  }
}

function renderAnalytics(orders) {
  // График выручки по дням
  const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
  const revenueByDay = [0, 0, 0, 0, 0, 0, 0];
  
  orders.forEach(o => {
    const day = new Date(o.created_at).getDay();
    const idx = day === 0 ? 6 : day - 1;
    revenueByDay[idx] += o.total || 0;
  });
  
  const maxRevenue = Math.max(...revenueByDay, 1);
  document.getElementById('owner-revenue-chart').innerHTML = revenueByDay.map((v, i) => 
    `<div class="owner-chart-bar" style="height:${(v/maxRevenue)*100}%" data-value="${formatPrice(v)}"></div>`
  ).join('');
  
  // Топ товаров
  const itemCounts = {};
  orders.forEach(o => {
    o.items?.forEach(item => {
      itemCounts[item.name] = (itemCounts[item.name] || 0) + item.qty;
    });
  });
  
  const topItems = Object.entries(itemCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
  
  document.getElementById('owner-top-items').innerHTML = topItems.length > 0
    ? topItems.map(([name, count]) => 
        `<div class="owner-top-item"><div class="owner-top-name">${name}</div><div class="owner-top-value">${count} шт</div></div>`
      ).join('')
    : '<div class="owner-empty"><div class="owner-empty-text">Нет данных</div></div>';
  
  // Пиковые часы
  const hourCounts = Array(7).fill(0);
  orders.forEach(o => {
    const hour = new Date(o.created_at).getHours();
    const idx = Math.floor((hour - 9) / 2);
    if(idx >= 0 && idx < 7) hourCounts[idx]++;
  });
  
  const maxHour = Math.max(...hourCounts, 1);
  document.getElementById('owner-hours-chart').innerHTML = hourCounts.map((v, i) => 
    `<div class="owner-chart-bar" style="height:${(v/maxHour)*100}%" data-value="${v} заказов"></div>`
  ).join('');
  
  // Топ клиентов
  const clientOrders = {};
  const clientSpend = {};
  orders.forEach(o => {
    clientOrders[o.first_name] = (clientOrders[o.first_name] || 0) + 1;
    clientSpend[o.first_name] = (clientSpend[o.first_name] || 0) + (o.total || 0);
  });
  
  const topClients = Object.entries(clientSpend)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
  
  document.getElementById('owner-top-clients').innerHTML = topClients.length > 0
    ? topClients.map(([name, spend]) => 
        `<div class="owner-top-item"><div class="owner-top-name">${name}</div><div class="owner-top-value">${formatPrice(spend)}</div></div>`
      ).join('')
    : '<div class="owner-empty"><div class="owner-empty-text">Нет данных</div></div>';
}

function renderOwnerMenu() {
  const menuItems = [
    {name: 'Пинк Матча L', price: 520, sales: 45, enabled: true},
    {name: 'Смузи Манго', price: 480, sales: 38, enabled: true},
    {name: 'Латте', price: 350, sales: 32, enabled: true},
    {name: 'Мохито Клубника', price: 420, sales: 28, enabled: false},
    {name: 'Милкшейк', price: 390, sales: 22, enabled: true}
  ];
  
  document.getElementById('owner-menu-list').innerHTML = menuItems.map((item, i) => `
    <div class="owner-menu-item">
      <div class="owner-menu-img">🍹</div>
      <div class="owner-menu-info">
        <div class="owner-menu-name">${item.name}</div>
        <div class="owner-menu-stats">Продано: ${item.sales} шт</div>
      </div>
      <div class="owner-menu-price">${item.price}₽</div>
      <div class="owner-menu-toggle ${item.enabled ? 'active' : ''}" onclick="ownerToggleItem(${i})"></div>
    </div>
  `).join('');
  
  const stopItems = menuItems.filter(i => !i.enabled);
  document.getElementById('owner-stop-list').innerHTML = stopItems.length > 0
    ? stopItems.map(item => `
        <div class="owner-menu-item">
          <div class="owner-menu-img" style="opacity:0.5">🍹</div>
          <div class="owner-menu-info">
            <div class="owner-menu-name">${item.name}</div>
          </div>
          <button class="owner-order-btn secondary" onclick="alert('Возврат в меню')">Вернуть</button>
        </div>
      `).join('')
    : '<div class="owner-empty"><div class="owner-empty-icon">✅</div><div class="owner-empty-text">Всё в наличии</div></div>';
}

function ownerToggleItem(idx) {
  playPluck();
  alert('Товар переключён');
}

function ownerToggleOpen() {
  ownerData.isOpen = !ownerData.isOpen;
  document.getElementById('owner-open-icon').textContent = ownerData.isOpen ? '🟢' : '🔴';
  document.getElementById('owner-open-text').textContent = ownerData.isOpen ? 'Открыто' : 'Закрыто';
  playPluck();
}

function ownerExportData() {
  alert('Экспорт данных в CSV...');
}

function ownerSendPush() {
  const msg = prompt('Текст рассылки:');
  if(msg) alert('Рассылка отправлена ' + ownerData.orders.length + ' клиентам');
}

function ownerClearStopList() {
  if(confirm('Очистить стоп-лист?')) {
    alert('Стоп-лист очищен');
  }
}

function ownerEditInfo() { alert('Редактирование информации'); }
function ownerEditHours() { alert('Редактирование времени работы'); }
function ownerEditContacts() { alert('Редактирование контактов'); }
function ownerViewStats() { alert('Полный отчёт'); }

// === РАСПИСАНИЕ ВЛАДЕЛЬЦА ===
let ownerScheduleDate = new Date().toISOString().split('T')[0];
let ownerSelectedMaster = null;
let ownerSelectedSlots = [];
let ownerScheduleData = {
  masters: [],
  bookings: [],
  blockedSlots: []
};

const OWNER_SLOTS = [
  '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
  '12:00', '12:30', '13:00', '13:30', '14:00', '14:30',
  '15:00', '15:30', '16:00', '16:30', '17:00', '17:30',
  '18:00', '18:30', '19:00', '19:30', '20:00', '20:30'
];

function initOwnerSchedule() {
  document.getElementById('owner-schedule-date').value = ownerScheduleDate;
  
  // Демо мастера (для барбершопа Portos)
  ownerScheduleData.masters = [
    {id: 'artem', name: 'Артём'},
    {id: 'dmitry', name: 'Дмитрий'},
    {id: 'rustam', name: 'Рустам'},
    {id: 'vlad', name: 'Владислав'}
  ];
  
  renderOwnerMasters();
  if(ownerScheduleData.masters.length > 0) {
    selectOwnerMaster(ownerScheduleData.masters[0].id);
  }
}

function renderOwnerMasters() {
  const container = document.getElementById('owner-master-select');
  container.innerHTML = ownerScheduleData.masters.map(m => `
    <button class="owner-master-btn ${ownerSelectedMaster === m.id ? 'active' : ''}" 
            onclick="selectOwnerMaster('${m.id}')">
      ${m.name}
    </button>
  `).join('');
}

function selectOwnerMaster(masterId) {
  ownerSelectedMaster = masterId;
  ownerSelectedSlots = [];
  renderOwnerMasters();
  loadOwnerSchedule();
}

async function loadOwnerSchedule() {
  ownerScheduleDate = document.getElementById('owner-schedule-date').value;
  
  // Форматируем дату для отображения
  const dateObj = new Date(ownerScheduleDate);
  const options = {day: 'numeric', month: 'long'};
  document.getElementById('owner-schedule-date-label').textContent = 
    dateObj.toLocaleDateString('ru', options);
  
  // Загружаем данные с сервера
  try {
    const r = await fetch(API_URL + `/api/owner/schedule/${ownerSelectedMaster}/${ownerScheduleDate}`);
    if(r.ok) {
      const data = await r.json();
      ownerScheduleData.bookings = data.bookings || [];
      ownerScheduleData.blockedSlots = data.blocked || [];
    }
  } catch(e) {
    // Демо данные
    ownerScheduleData.bookings = [
      {time: '10:00', client: 'Михаил', service: 'Стрижка', phone: '+7 999 123-45-67'},
      {time: '11:30', client: 'Александр', service: 'Стрижка + борода', phone: '+7 999 765-43-21'},
      {time: '15:00', client: 'Дмитрий', service: 'Моделирование бороды', phone: '+7 999 111-22-33'}
    ];
    ownerScheduleData.blockedSlots = ['13:00', '13:30', '14:00'];
  }
  
  renderOwnerSlots();
  renderOwnerBookings();
}

function renderOwnerSlots() {
  const bookedTimes = ownerScheduleData.bookings.map(b => b.time);
  const blockedTimes = ownerScheduleData.blockedSlots;
  
  const container = document.getElementById('owner-slots-grid');
  container.innerHTML = OWNER_SLOTS.map(slot => {
    let status = 'free';
    if(bookedTimes.includes(slot)) status = 'booked';
    else if(blockedTimes.includes(slot)) status = 'blocked';
    
    const isSelected = ownerSelectedSlots.includes(slot);
    
    return `
      <div class="owner-slot ${status} ${isSelected ? 'selected' : ''}" 
           onclick="toggleOwnerSlot('${slot}', '${status}')"
           data-slot="${slot}">
        ${slot}
      </div>
    `;
  }).join('');
}

function toggleOwnerSlot(slot, status) {
  if(status === 'booked') {
    // Показать информацию о брони
    const booking = ownerScheduleData.bookings.find(b => b.time === slot);
    if(booking) {
      if(confirm(`${booking.time} — ${booking.client}\n${booking.service}\n${booking.phone}\n\nОтменить запись?`)) {
        cancelOwnerBooking(slot);
      }
    }
    return;
  }
  
  if(status === 'blocked') {
    // Разблокировать слот
    if(confirm(`Разблокировать слот ${slot}?`)) {
      unblockOwnerSlot(slot);
    }
    return;
  }
  
  // Свободный слот - добавить/убрать из выбранных
  const idx = ownerSelectedSlots.indexOf(slot);
  if(idx >= 0) {
    ownerSelectedSlots.splice(idx, 1);
  } else {
    ownerSelectedSlots.push(slot);
  }
  
  renderOwnerSlots();
  
  // Если выбраны слоты - показать кнопку блокировки
  if(ownerSelectedSlots.length > 0) {
    showBlockModal();
  }
}

function showBlockModal() {
  ownerSelectedSlots.sort();
  document.getElementById('owner-block-slots').innerHTML = 
    ownerSelectedSlots.map(s => `<div class="owner-block-slot">${s}</div>`).join('');
  document.getElementById('owner-block-reason').value = '';
  document.getElementById('owner-block-modal').classList.add('show');
}

function closeBlockModal() {
  document.getElementById('owner-block-modal').classList.remove('show');
  ownerSelectedSlots = [];
  renderOwnerSlots();
}

async function confirmBlockSlots() {
  const reason = document.getElementById('owner-block-reason').value;
  
  try {
    await fetch(API_URL + '/api/owner/block-slots', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        master_id: ownerSelectedMaster,
        date: ownerScheduleDate,
        slots: ownerSelectedSlots,
        reason: reason
      })
    });
  } catch(e) {}
  
  // Добавляем в локальные данные
  ownerScheduleData.blockedSlots.push(...ownerSelectedSlots);
  
  closeBlockModal();
  renderOwnerSlots();
  playPluck();
  try{tg.HapticFeedback.notificationOccurred('success')}catch(e){}
}

async function unblockOwnerSlot(slot) {
  try {
    await fetch(API_URL + '/api/owner/unblock-slot', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        master_id: ownerSelectedMaster,
        date: ownerScheduleDate,
        slot: slot
      })
    });
  } catch(e) {}
  
  // Убираем из локальных данных
  const idx = ownerScheduleData.blockedSlots.indexOf(slot);
  if(idx >= 0) ownerScheduleData.blockedSlots.splice(idx, 1);
  
  renderOwnerSlots();
  playPluck();
}

async function cancelOwnerBooking(slot) {
  try {
    await fetch(API_URL + '/api/owner/cancel-booking', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        master_id: ownerSelectedMaster,
        date: ownerScheduleDate,
        slot: slot
      })
    });
  } catch(e) {}
  
  // Убираем из локальных данных
  ownerScheduleData.bookings = ownerScheduleData.bookings.filter(b => b.time !== slot);
  
  renderOwnerSlots();
  renderOwnerBookings();
  playPluck();
  try{tg.HapticFeedback.notificationOccurred('warning')}catch(e){}
}

function renderOwnerBookings() {
  const container = document.getElementById('owner-day-bookings');
  
  if(ownerScheduleData.bookings.length === 0) {
    container.innerHTML = `
      <div class="owner-empty">
        <div class="owner-empty-icon">📅</div>
        <div class="owner-empty-text">Нет записей на этот день</div>
      </div>
    `;
    return;
  }
  
  // Сортируем по времени
  const sorted = [...ownerScheduleData.bookings].sort((a, b) => a.time.localeCompare(b.time));
  
  container.innerHTML = sorted.map(b => `
    <div class="owner-booking-item">
      <div class="owner-booking-time">${b.time}</div>
      <div class="owner-booking-info">
        <div class="owner-booking-name">${b.client}</div>
        <div class="owner-booking-service">${b.service} • ${b.phone || ''}</div>
      </div>
      <div class="owner-booking-actions">
        <button class="owner-order-btn secondary" onclick="callClient('${b.phone}')">📞</button>
        <button class="owner-order-btn secondary" onclick="cancelOwnerBooking('${b.time}')">✕</button>
      </div>
    </div>
  `).join('');
}

function callClient(phone) {
  if(phone) window.open('tel:' + phone.replace(/[^\d+]/g, ''));
}

function ownerPrevDay() {
  const date = new Date(ownerScheduleDate);
  date.setDate(date.getDate() - 1);
  document.getElementById('owner-schedule-date').value = date.toISOString().split('T')[0];
  loadOwnerSchedule();
}

function ownerNextDay() {
  const date = new Date(ownerScheduleDate);
  date.setDate(date.getDate() + 1);
  document.getElementById('owner-schedule-date').value = date.toISOString().split('T')[0];
  loadOwnerSchedule();
}

function formatPrice(n) {
  if(n >= 1000000) return Math.round(n/1000000) + 'M₽';
  if(n >= 1000) return Math.round(n/1000) + 'K₽';
  return n + '₽';
}

loadGroupOrder();
checkRegistration();
</script>
</body>
</html>
